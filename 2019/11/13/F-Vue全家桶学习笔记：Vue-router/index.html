<!-- build time:Sat Nov 27 2021 16:09:55 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Focus on FE learning</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third%20party/prism.css"><link rel="stylesheet" href="/css/third%20party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third%20party/pace-theme-flash.css"><link rel="icon" href="/images/kour.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"></head><body><header class="header"><div class="header_top"><span class="theme"><a href="/">Chor's blog</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">首页</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">分类</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">归档</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">标签</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">关于</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a target="_blank" rel="noopener" href="https://github.com/Chorer/hexo-theme-PureBlue" class="logo">Focus on FE learning</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div><div class="blog-down"><a href="javascript:void(0);"><i class="fa fa-angle-double-down fa-2x"></i></a></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">Vue 全家桶学习笔记：Vue-router</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-11-13&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp4.7k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp19 mins&nbsp&nbsp&nbsp</span><div class="post-tags"></div></div><div class="post-content"><div class="figure"><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Vue-router/Vue-router-1.jpg"></div><span id="more"></span><h3 id="前端路由的两种模式">1. 前端路由的两种模式</h3><ul><li>在以前，前后端是不分离的，这个阶段通常是由服务端渲染好页面（SSR），再发送页面给前端去展示；</li><li>接着到了前后端分离的阶段，前端向静态资源服务器拿资源，再通过 js 渲染页面，此时仍然是一个 url 对应一份 html+css+js；</li><li>再后来出现了 SPA 单页面应用的概念，实际上它只有一个页面，但是能监听 url 的改变并切换不同的视图，因此给我们带来多页面的体验。</li></ul><p>SPA 的路由跳转都是在前端实现的，它需要解决两个问题：</p><ul><li>如何监听 url 的改变，进而渲染不同的视图</li><li>如何使 url 改变，但不刷新整个页面（这里如果刷新了是会真的向服务端发送请求的，而服务端路径下并没有对应的资源）</li></ul><h4 id="hash-模式">hash 模式</h4><ul><li><p>url 中带有 hash 符号（#）。url 只有改变了才会触发请求，而 hash 的改变并不在它的考虑范围，因此 hash 改变不会触发请求</p></li><li><p>每一次改变 hash 后的部分，都会在浏览器的访问历史中增加一个记录 ，这使得我们可以来回切换</p></li></ul><p>可以手动修改 url 的 hash、或者使用浏览器的前进后退按钮，或者修改 <code>location.hash</code> 的值，从而改变 hash 值。每次 hash 值改变的时候，会触发 <code>window.onhashchange</code> 事件，在这个事件处理函数里面根据不同的 hash 切换不同的视图</p><h4 id="history-模式">history 模式</h4><ul><li>HTML5 提供了新的 <code>window.history</code> API。页面导航带来的 url 改变只是视觉改变，同样不会触发请求</li><li>由于历史记录是在 history 栈压入或弹出的，这使得我们可以来回切换</li></ul><p>可以使用浏览器的前进后退按钮、或者调用 <code>history.pushState</code>、<code>history.replaceState</code>，从而改变 url。每次 url 改变的时候，必须伴随着一个出栈操作，因此会触发 <code>window.onpopstate</code> 事件，在这个事件处理函数里面根据不同的 url 切换不同的视图。</p><h4 id="如何解决刷新-404-问题">如何解决刷新 404 问题</h4><p>首先，在 history 模式下，如果只是通过页面按钮等方式进行导航，那么 url 只会有一个视觉上的变化，而这种变化触发了相关的函数去更新视图，从而带来一种多页面的错觉。</p><p>但是如果在地址栏按下回车或者点击刷新按钮，那么浏览器会将当前 url 视为一个真正的 url 并发起请求，问题是服务器这边根本没有请求路径对应的资源（因为路由控制都是在前端这里进行的），这时候就会返回 404 的错误状态码了。那么怎么解决这个问题呢？</p><p>我们知道，Nginx 的作用就是配置浏览器向服务器发出请求时，什么样的请求路径应该返回什么样的资源，所以这个问题可以让 Nginx 来解决。如果说是直接请求域名，那么我们自然返回应用的入口文件 <code>index.html</code> 即可，之后用户导航的时候，再全权由前端进行路由控制；但如果说是像上面那样请求了一个服务器实际不存在的页面路径 —— 实际上所有的页面路径在服务器这里都是不存在的，那么我们就需要在 <code>try_files</code> 里进行配置，提供一个 fallback 选项，统一返回 <code>index.html</code>。</p><h3 id="关于-vue-router">2. 关于 vue-router</h3><p>SPA 是基于路由和组件的，其中路由可以看作是它的一个路径管理器，路由和组件之间互相映射，路由的切换就是组件的切换。</p><p>Vue 的前端路由使用 vue-router 实现。实例化 vue-router 时会传入一个对象，可以给对象一个 <code>option</code>，如 <code>mode:'history'</code>，从而决定 vue-router 使用 hash 模式还是 history 模式。</p><h3 id="安装">3. 安装</h3><p>在安装 vue-cli 的时候可以顺便安装 vue-router，或者之后我们通过 <code>npm install</code> 的方式手动安装。</p><h3 id="使用">4. 使用</h3><p>如果是通过脚手架安装 vue-router，<code>src</code> 下会多出一个 <code>router</code> 文件夹，里面的 <code>index.js</code> 帮我们生成了配置的基础结构。</p><p><code>index.js</code> 大致是这样的：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 导入要使用到的组件</span>
<span class="token keyword">import</span> VueRouter <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span>     
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>                
<span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">'../components/Home.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> About <span class="token keyword">from</span> <span class="token string">'../components/About.vue'</span><span class="token punctuation">;</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>VueRouter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 安装 vue-router</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>                  <span class="token comment">// 配置路由和组件的映射关系</span>
    <span class="token punctuation">&#123;</span>
       path<span class="token operator">:</span><span class="token string">'/'</span><span class="token punctuation">,</span>
       redirect<span class="token operator">:</span> <span class="token string">'/home'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
       path<span class="token operator">:</span><span class="token string">'/home'</span><span class="token punctuation">,</span>
       component<span class="token operator">:</span> Home
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
       path<span class="token operator">:</span><span class="token string">'/about'</span><span class="token punctuation">,</span>
       component<span class="token operator">:</span> About
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>         <span class="token comment">// 实例化 VueRouter 对象</span>
	routes
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> router<span class="token punctuation">;</span>                <span class="token comment">// 导出 router 对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时，<code>main.js</code> 文件中，导入 router 并在 Vue 实例下挂载：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// main.js</span>

<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>

Vue<span class="token punctuation">.</span>config<span class="token punctuation">.</span>productionTip <span class="token operator">=</span> <span class="token boolean">false</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  router<span class="token punctuation">,</span>
  <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=></span> <span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来通过 <code>&lt;router-link&gt;</code> 和 <code>&lt;router-view&gt;</code> 使用路由：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">// App.vue

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>	    
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/about<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>关于<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="路由嵌套二级路由">5. 路由嵌套（二级路由）</h3><p>假设 <code>home</code> 路由下嵌套着两个子路由 <code>news</code> 和 <code>message</code>，即 <code>/home/news</code> 和 <code>/home/message</code>，那么首先创建两个对应的组件，之后在 <code>index.js</code> 下配置好映射关系：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> HomeNews <span class="token keyword">from</span> <span class="token string">'../components/HomeNews.vue'</span>
<span class="token keyword">import</span> HomeMessage <span class="token keyword">from</span> <span class="token string">'../components/HomeMessage.vue'</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>                  <span class="token comment">// 配置 url 和组件的映射关系</span>
    <span class="token punctuation">&#123;</span>
       path<span class="token operator">:</span><span class="token string">'/'</span><span class="token punctuation">,</span>
       redirect<span class="token operator">:</span> <span class="token string">'/home'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
       path<span class="token operator">:</span><span class="token string">'/home'</span><span class="token punctuation">,</span>
       component<span class="token operator">:</span>Home<span class="token punctuation">,</span>
       children<span class="token operator">:</span><span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
               path<span class="token operator">:</span><span class="token string">'/'</span><span class="token punctuation">,</span>                 <span class="token comment">// 默认展示 news</span>
               redirect<span class="token operator">:</span> <span class="token string">'news'</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span>
               path<span class="token operator">:</span> <span class="token string">'news'</span><span class="token punctuation">,</span>
               component<span class="token operator">:</span> HomeNews
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span>
               path<span class="token operator">:</span> <span class="token string">'message'</span><span class="token punctuation">,</span>
               component<span class="token operator">:</span> HomeMessage
            <span class="token punctuation">&#125;</span>
	   <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
       path<span class="token operator">:</span><span class="token string">'/about'</span><span class="token punctuation">,</span>
       component<span class="token operator">:</span>About
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 <code>Home.vue</code> 中使用子路由：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">// Home.vue

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>我是Home<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home/news<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>news<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/home/messaage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>message<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="动态路由匹配">5. 动态路由匹配</h3><p>有的时候，path 并不是固定的。比方 <code>/user/Tom</code>，<code>/user/Jack</code>，这些 path 根据用户不同而不同，但都是展示用户页面的，我们希望满足这种格式的 path 都映射 <code>User</code> 组件，怎么办呢？可以在 path 中使用动态路径参数。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> User <span class="token keyword">from</span> <span class="token string">'../components/User.vue'</span>

<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span><span class="token string">'/user/:userId'</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> User
	<span class="token punctuation">&#125;</span>   
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意，这里我们不再是写 <code>/user/</code>，而是写 <code>/user/:userId</code>，这是因为路径 user 后面的东西是动态的。那么，对于下面的三种 <code>&lt;router-link&gt;</code>，最后都可以成功映射到 <code>User</code> 组件：</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; App.vue

&lt;router-link to&#x3D;&quot;&#x2F;user&#x2F;Tom&quot;&gt;&lt;&#x2F;router-link&gt;           &#x2F;&#x2F; 路径：&#x2F;user&#x2F;Tom
&lt;router-link to&#x3D;&quot;&#x2F;user&#x2F;Jack&quot;&gt;&lt;&#x2F;router-link&gt;          &#x2F;&#x2F; 路径：&#x2F;user&#x2F;Jack
&lt;router-link :to&#x3D;&quot;&#96;&#x2F;user&#x2F;$&#123;userId&#125;&#96;&quot;&gt;&lt;&#x2F;router-link&gt;   &#x2F;&#x2F; 路径：&#x2F;user&#x2F;Bake
&lt;router-view&gt;&lt;&#x2F;router-view&gt;

&lt;script&gt;
    export default&#123;
        data()&#123;
            return &#123;
                userId:&#39;Bake&#39;
            &#125;
        &#125;
    &#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果想要在具体的 <code>User.vue</code> 中展示用户名，可以通过 <code>$route.params.userId</code> 获取当前路径中的用户名：</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; User.vue

&lt;div&gt;我的用户名是：&#123;&#123;$route.params.userId&#125;&#125;&lt;&#x2F;div&gt;
&lt;div&gt;我的用户名是：&#123;&#123;id&#125;&#125;&lt;&#x2F;div&gt;

&lt;script&gt;
    export default&#123;
        computed:&#123;
            id()&#123;
                return this.$route.params.userId;
            &#125;
        &#125;
    &#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="路由传参">6. 路由传参</h3><h4 id="基于动态路由">6.1 基于动态路由</h4><p>实际上，上面讲的动态路由就可以用来传递参数。上面例子的 <code>path</code> 还可以根据需要添加更多动态路径参数，如 <code>'/user/:userId/:userJob/:userEmail'</code>，首先在 App.vue 拿到数据，传给<code>&lt;router-link&gt;</code> 的 <code>to</code>，接着就可以在 User.vue 中通过 <code>$route.params</code> 去访问了。</p><h4 id="给-to-传入对象">6.2 给 <code>to</code> 传入对象</h4><p>首先要明白，<code>to</code> 除了接收字符串之外，也可以接受对象。以前面的动态路由为例：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--可以这样写（直接传字符串）--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>`/user/$&#123;userId&#125;`<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>

<span class="token comment">&lt;!--也可以这样写（传对象，直接用字符串表示完整路径）--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;path:<span class="token punctuation">'</span>`/user/$&#123;userId&#125;`<span class="token punctuation">'</span>&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>那么，我们会自然想到，对于一个普通的路由，要传参的话把参数放在给 <code>to</code> 传入的对象中不就可以了吗？</p><p>于是可能会这么写：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;path:<span class="token punctuation">'</span>/article<span class="token punctuation">'</span>,params:&#123;date:<span class="token punctuation">'</span>2020-1-1<span class="token punctuation">'</span>,title:<span class="token punctuation">'</span>A new year<span class="token punctuation">'</span>&#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然而这是<strong>错误</strong>的用法，事实上我们应该将 <code>path</code> 改为 <code>name</code>。不过在这之前，我们还是先给路由一个 <code>name</code>吧：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> Article <span class="token keyword">from</span> <span class="token string">'../components/Article.vue'</span>

<span class="token comment">// 首先给路由一个名字（命名路由）</span>
<span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span><span class="token string">'/article'</span><span class="token punctuation">,</span>
    	name<span class="token operator">:</span><span class="token string">'article'</span><span class="token punctuation">,</span>
        component<span class="token operator">:</span> Article
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接着使用路由：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;name:<span class="token punctuation">'</span>article<span class="token punctuation">'</span>,params:&#123;date:<span class="token punctuation">'</span>2020-1-1<span class="token punctuation">'</span>,title:<span class="token punctuation">'</span>A new year<span class="token punctuation">'</span>&#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>获取参数：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--Article.vue--></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>&#123;&#123;$route.params.date&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>&#123;&#123;$route.params.title&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="使用-query">6.3 使用 <code>query</code></h4><p>这和上面的是差不多的，不同的是我们不使用 <code>params</code>，而是使用 <code>query</code>。query 实际上就是 url 中的查询参数。</p><p>这种情况下，我们给 <code>to</code> 传入的对象可以使用 <code>path</code>，也可以使用 <code>name</code>：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;name:<span class="token punctuation">'</span>article<span class="token punctuation">'</span>,query:&#123;date:<span class="token punctuation">'</span>2020-1-1<span class="token punctuation">'</span>,title:<span class="token punctuation">'</span>A new year<span class="token punctuation">'</span>&#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span>
<span class="token comment">&lt;!--等价于--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-link</span> <span class="token attr-name">:to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;path:<span class="token punctuation">'</span>/article<span class="token punctuation">'</span>,query:&#123;date:<span class="token punctuation">'</span>2020-1-1<span class="token punctuation">'</span>,title:<span class="token punctuation">'</span>A new year<span class="token punctuation">'</span>&#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-link</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>获取参数：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--Article.vue--></span>
 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>&#123;&#123;$route.query.date&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>&#123;&#123;$route.query.title&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="路由跳转声明式-vs-编程式">7. 路由跳转：声明式 VS 编程式</h3><p>前面介绍的路由跳转/导航是通过<strong>声明式</strong>的 <code>&lt;router-link :to='...'&gt;</code> 实现的，我们也可以使用<strong>编程式</strong>的 <code>this.$router.push('...')</code> 实现：</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; App.vue

&lt;div id&#x3D;&quot;app&quot;&gt;
	&lt;router-link to&#x3D;&#39;&#x2F;home&#39;&gt;可以点击这里进入首页&lt;&#x2F;router-link&gt; 
    &lt;!--
	or: &lt;router-link :to&#x3D;&quot;&#123;path:&#39;&#x2F;home&#39;&#125;&quot;&gt;	
	--&gt;
    &lt;button @click&#x3D;&quot;change&quot;&gt;也可以点击这里进入首页&lt;&#x2F;button&gt;
    &lt;router-view&gt;&lt;&#x2F;router-view&gt;
&lt;&#x2F;div&gt;

&lt;script&gt;
    export default&#123;
        name:&#39;App&#39;,
        methods:&#123;
			change()&#123;
                this.$router.push(&#39;&#x2F;home&#39;);
              &#x2F;&#x2F;or: this.$router.push(&#123;path:&#39;&#x2F;home&#39;&#125;) 
            &#125;
        &#125;
    &#125;
&lt;&#x2F;script&gt;    <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>&lt;router-link :to='...'&gt;</code> 实质上也是在内部调用了 <code>push</code> 方法，从而向 history 栈压入新记录，由于是栈的数据结构，所以可以自由前进和后退。除了 <code>push</code>，还有 <code>replace</code>（注意是直接替换而不是采用入栈出栈方式），<code>go</code>，这些和 <code>window.history</code> 的 API 是类似的。</p><p><code>this.$router.push('...')</code> 同样接受字符串参数或者对象参数。</p><h3 id="router-和-route-的区别">8. <code>$router</code> 和 <code>$route</code> 的区别</h3><ul><li><p><code>$router</code> 是我们 new 出来的 VueRouter 实例，它提供了一些跳转方法（<code>push</code>，<code>replace</code>，<code>go</code>）和钩子函数（后面导航守卫部分会讲解）；</p></li><li><p><code>$route</code> 是<strong>路由信息对象</strong>，可以理解为是当前活跃的路由，包括 path，params，hash，query，fullPath，matched，name 等路由信息参数。</p></li></ul><h3 id="导航守卫">9. 导航守卫</h3><p>路由的导航守卫其实就是一些钩子函数，可以在路由跳转的流程中针对性地进行操作控制。</p><h4 id="参数说明">0. 参数说明</h4><p><code>to</code>：即将前往的路由</p><p><code>from</code>：从哪个路由过来，或者即将离开的路由</p><p><code>next()</code>：不传参数，表示正常放行，执行流程中的下一个钩子;传入 false，表示中断路由导航；传入路径，表示跳转到一个指定路由</p><h4 id="全局守卫">1. 全局守卫</h4><ul><li>全局前置守卫：<code>router.beforeEach((to,from,next) =&gt; &#123;...&#125;)</code>。可以在 <code>index.js</code> 或者路由组件中使用（通过 <code>this.$router</code>），next 必须调用。</li><li>全局解析守卫：<code>router.beforeResolve</code>。</li><li>全局后置守卫：<code>router.afterEach((to,from) =&gt; &#123;...&#125;)</code>。可以在 <code>index.js</code> 或者路由组件中使用（通过 <code>this.$router</code>），next 不需要调用。</li></ul><h4 id="路由独享守卫">2. 路由独享守卫</h4><p>单个路由独享的守卫只有 <code>beforeEnter</code> 这一个，可以在配置路由时定义。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      path<span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> Home<span class="token punctuation">,</span>
      <span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// ...</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="组件守卫">3. 组件守卫</h4><p>组件守卫只能在路由组件中定义：</p><ul><li><code>beforeRouteEnter((to,from,next) =&gt; &#123;...&#125;)</code>： 进入路由前触发，此时实例还没创建，无法获取到 this</li><li><code>beforeRouteUpdate((to,from,next) =&gt; &#123;...&#125;)</code> ：路由复用同一个组件时触发，比如 <code>/user/Tom</code> 和 <code>/user/Jack</code></li><li><code>beforeRouteLeave((to,from,next) =&gt; &#123;...&#125;)</code>： 离开路由前触发，此时可以用来提醒用户，或保存数据，或关闭定时器等等</li></ul><h4 id="导航解析流程">4. 导航解析流程</h4><p>来自官网的图：</p><div class="figure"><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Vue-router/Vue-router-2.jpg"></div><p>以页面跳转为例，导航守卫的执行顺序如下图：</p><div class="figure"><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Vue-router/Vue-router-4.jpg"></div><h4 id="应用场景">5. 应用场景</h4><p><strong>（1）离开页面前提醒用户保存数据</strong></p><p>在一些写作平台创作的时候，如果当前内容还没有保存就想跳转到其它页面，此时通常会有一个弹窗提示用户，这个可以用 <code>beforeRouteLeave</code> 来实现：</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; Edit.vue
&lt;script&gt;
	export default &#123;
        &#x2F;&#x2F; 在用户准备离开当前路由时进行拦截
        beforeRouteLeave((to,from,next) &#x3D;&gt; &#123;
        	const isSaved &#x3D; getSaveState()
            &#x2F;&#x2F; 如果已经保存了内容，则正常跳转
            if(isSaved)&#123;
                next()
            &#125;
    		&#x2F;&#x2F; 否则弹窗提示是否想要跳转
    		else &#123;
                if(window.confirm(&#39;还没有保存内容，确定要跳转吗？&#39;))&#123;
                    next()
                &#125; else &#123;
                    next(false)
                &#125;
            &#125;
    	&#125;)
    &#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>（2）路由的动态参数改变时重新请求数据</strong></p><p>像 <code>/user/Tom</code> 和 <code>/user/Jack</code> 这样的动态路由都是匹配 <code>/user/:userId</code> 的，都会复用 User 组件，而组件本身只会在创建的时候请求一次用户数据，如何实现在切换不同的动态参数时重新请求数据呢？这时候就可以使用 <code>beforeRouteUpdate</code> 钩子函数，它会在路由的动态参数改变时触发。</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;script&gt;
	export default &#123;
        &#x2F;&#x2F; 从 &#x2F;user&#x2F;Tom 切换到 &#x2F;user&#x2F;Jack 的时候触发该钩子函数
        beforeRouteUpdate((to,from,next) &#x3D;&gt; &#123;
        	&#x2F;&#x2F; 重新请求新的用户数据
        	this.getUserData(to.params.userId)
    	&#125;)
    &#125;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>（3）访问页面的权限校验</strong></p><p>用户可能在没有登录的情况下试图访问个人主页或其它需要登录才能访问的页面，此时要让页面自动跳转到登录页，这种权限校验也可以通过导航守卫来实现。因为像这样游客无法访问的页面有很多，所以用 <code>beforeEach</code> 全局钩子统一进行拦截。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// router.js</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            path<span class="token operator">:</span> <span class="token string">'/personal'</span><span class="token punctuation">,</span>
            <span class="token comment">// 添加路由元信息，表明该路由需要鉴权</span>
            meta<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                requireAuth<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
            path<span class="token operator">:</span> <span class="token string">'/setting'</span><span class="token punctuation">,</span>
            meta<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                requireAuth<span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span>from<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> hasLogin <span class="token operator">=</span> <span class="token function">getLoginState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 如果没有登录，并且访问的页面需要鉴权，则跳转到登录页</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>hasLogin <span class="token operator">&amp;&amp;</span> to<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requireAuth<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
            <span class="token comment">// 跳转到登录页的时候顺便携带参数，这样用户登录成功后可以通过这个参数跳转到本来想要访问的目标页面</span>
            query<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                redirect<span class="token operator">:</span> to<span class="token punctuation">.</span>path
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> 
    <span class="token comment">// 如果已经登录了，则阻止用户访问登录页</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>hasLogin <span class="token operator">&amp;&amp;</span> to<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>    
    <span class="token comment">// 其它情况正常跳转</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果一级路由需要权限校验，那么二级或者三级路由也同样需要，此时我们不得不给一级路由底下的每个子路由声明 <code>requireAuth</code>，这是非常麻烦的。不过还好，路由信息对象提供了一个 <code>matched</code> 数组，里面包含了与当前路由信息对象相关联的各个路由的记录。举个例子：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// 如果当前路由信息对象是 '/a'，则：</span>
matched <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> path<span class="token operator">:</span> <span class="token string">'/a'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
<span class="token comment">// 如果当前路由信息对象是 '/a/b'，则：</span>
matched <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> <span class="token string">'/a'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> <span class="token string">'/a/b'</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span>
<span class="token comment">// 如果当前路由信息对象是 '/a/b/c'，则：</span>
matched <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> <span class="token string">'/a'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> <span class="token string">'/a/b'</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        path<span class="token operator">:</span> <span class="token string">'/a/b/c'</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这意味着，我们可以只给一级路由声明 <code>requireAuth</code>，之后检测 <code>to.matched</code>中是否包含 <code>requireAuth</code> 为 true 的路由记录即可。只要包含这样的路由记录，则 <code>to</code> 一定属于需要鉴权的一级路由下面的子路由。</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    routes<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            path<span class="token operator">:</span> <span class="token string">'/setting'</span><span class="token punctuation">,</span>
            requireAuth<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            children<span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">&#123;</span>
                    path<span class="token operator">:</span> <span class="token string">'/setting/changeAccount'</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span>from<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> hasLogin <span class="token operator">=</span> <span class="token function">getLoginState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 没有登录，且打算访问的页面需要鉴权，则跳转到登录页</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>hasLogin <span class="token operator">&amp;&amp;</span> to<span class="token punctuation">.</span>matched<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token parameter">record</span> <span class="token operator">=></span> record<span class="token punctuation">.</span>meta<span class="token punctuation">.</span>requireAuth<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            path<span class="token operator">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span>
            query<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                redirect<span class="token operator">:</span> to<span class="token punctuation">.</span>path
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="路由懒加载">10. 路由懒加载</h3><p>懒加载也叫延迟加载，即<strong>在需要的时候进行加载</strong>，随用随载。在单页应用中，如果没有应用懒加载，运用 webpack 打包后的文件将会异常的大，导致进入首页时，需要加载的内容过多，延时过长，不利于用户体验；而运用懒加载则可以将页面进行划分，需要的时候加载页面，可以有效的分担首页所承担的加载压力，减少首页加载用时。</p><p>要使用路由懒加载，只需要将原来的 <code>import</code> 静态导入改为 <code>import()</code> 动态异步导入即可：</p><pre class="line-numbers language-js" data-language="js"><code class="language-js"><span class="token comment">// import Home from '../components/Home';</span>
<span class="token comment">// import About from '../components/About';</span>

<span class="token keyword">const</span> <span class="token function-variable function">Home</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/Home'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">About</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'../components/About'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="keep-alive">11. keep-alive</h3><p>路由跳转的时候，比如 <code>home -&gt; about -&gt; home</code>，<code>home</code> 路由组件实际上是在不断地创建和销毁，我们可以用生命周期钩子函数证明这一点：</p><div class="figure"><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Vue-router/Vue-router-3.jpg"></div><p>上图中，每次跳转的时候都会经历一次生命周期。但大部分时候，这种重新渲染是没有必要的，所以 Vue 提供了一个内置组件 <code>keep-alive</code> 来 <strong>缓存组件内部状态，避免重新渲染</strong> 。</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-view</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>被 <code>keep-alive</code> 包裹的路由/组件，状态会得到缓存。以上图为例，从 home 跳转到 about，home 不会被销毁，同样的，从 about 跳转到 home，about 不会被销毁，home 也不会被重新创建，而是用之前缓存好的组件。</p><ul><li>keep-alive 提供了 <code>activated</code> 和 <code>deactivated</code> 两个钩子函数（在路由组件中定义），前者在当前路由组件激活时调用，后者在当前路由组件失活时调用。</li><li>keep-alive 提供了 3 个属性定义具体的缓存情况：</li><li><code>include</code> 包含的组件(可以是字符串，数组，以及正则表达式,只有匹配的组件会被缓存)</li><li><code>exclude</code> 排除的组件(可以是字符串，数组，以及正则表达式,任何匹配的组件都不会被缓存)</li><li><code>max</code> 缓存组件的最大值(类型为字符或者数字,可以控制缓存组件的个数)</li></ul><p>参考：</p><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5b0281b851882542845257e7">从头开始学习vue-router</a></p><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5b82bcfcf265da4345153343">可能比文档还详细--VueRouter完全指北</a></p></div><div class="post-nav"><div class="post-nav-prev"><a href="/2019/11/21/F-Vue%E5%85%A8%E5%AE%B6%E6%A1%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AVuex/" rel="prev" title="Vue 全家桶学习笔记：Vuex"><i class="fa fa-angle-double-left"></i>&nbspVue 全家桶学习笔记：Vuex</a></div><div class="post-nav-next"><a href="/2019/11/09/F-AJAX%E4%B8%8E%E8%B7%A8%E5%9F%9F%E9%80%9A%E4%BF%A1%EF%BC%88%E4%B8%89%EF%BC%89/" rel="next" title="AJAX 与跨域通信（三）：跨域解决方案">AJAX 与跨域通信（三）：跨域解决方案&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top">Contents</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-text">1. 前端路由的两种模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#hash-%E6%A8%A1%E5%BC%8F"><span class="toc-text">hash 模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#history-%E6%A8%A1%E5%BC%8F"><span class="toc-text">history 模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%88%B7%E6%96%B0-404-%E9%97%AE%E9%A2%98"><span class="toc-text">如何解决刷新 404 问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-vue-router"><span class="toc-text">2. 关于 vue-router</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-text">3. 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-text">4. 使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%B5%8C%E5%A5%97%E4%BA%8C%E7%BA%A7%E8%B7%AF%E7%94%B1"><span class="toc-text">5. 路由嵌套（二级路由）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D"><span class="toc-text">5. 动态路由匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82"><span class="toc-text">6. 路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1"><span class="toc-text">6.1 基于动态路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%99-to-%E4%BC%A0%E5%85%A5%E5%AF%B9%E8%B1%A1"><span class="toc-text">6.2 给 to 传入对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-query"><span class="toc-text">6.3 使用 query</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%B7%B3%E8%BD%AC%E5%A3%B0%E6%98%8E%E5%BC%8F-vs-%E7%BC%96%E7%A8%8B%E5%BC%8F"><span class="toc-text">7. 路由跳转：声明式 VS 编程式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#router-%E5%92%8C-route-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">8. $router 和 $route 的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB"><span class="toc-text">9. 导航守卫</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-text">0. 参数说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%AE%88%E5%8D%AB"><span class="toc-text">1. 全局守卫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%8B%AC%E4%BA%AB%E5%AE%88%E5%8D%AB"><span class="toc-text">2. 路由独享守卫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%AE%88%E5%8D%AB"><span class="toc-text">3. 组件守卫</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA%E8%A7%A3%E6%9E%90%E6%B5%81%E7%A8%8B"><span class="toc-text">4. 导航解析流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">5. 应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD"><span class="toc-text">10. 路由懒加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#keep-alive"><span class="toc-text">11. keep-alive</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"retro",pageSize:10,visitor:!0})</script></section></main><script>var user=[1,2,3,4]</script><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - <span>2021</span> My Blog</p><p class="a">Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a target="_blank" rel="noopener" href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/search.js"></script><script src="/js/post-except.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script></body></html><!-- rebuild by neat -->