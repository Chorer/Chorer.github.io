<!-- build time:Fri May 10 2019 19:04:04 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Chor&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="icon" href="/images/me.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-coy.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism-coy.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><header class="header"><span><i class="fa fa-bars"></i> <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></span><div class="blog-title"><a href="/" class="logo">Chor&#39;s Blog</a></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link">Home</a></li><li class="menu-item"><a href="/categories" class="menu-item-link">Categories</a></li><li class="menu-item"><a href="/archives" class="menu-item-link">Archives</a></li><li class="menu-item"><a href="/tags" class="menu-item-link">Tags</a></li><li class="menu-item"><a href="/about" class="menu-item-link">About</a></li></ul></nav><i id="homelink" data-link="https://chorer.github.io/"></i></header><main class="main"><section class="posts"><article class="post"><div class="post-title"><a class="post-title-link" href="/2019/05/10/Trs-Javascript 究竟是如何工作的？/">「译」JavaScript 究竟是如何工作的？（第一部分）</a></div><div class="post-sub_title">什么是 V8？JavaScript运行的背后发生了什么？</div><div class="post-date"><span class="date-text"><i class="fa fa-calendar"></i>Date:&nbsp&nbsp2019-05-10</span></div><div class="post-tags"></div><div class="post-statistic"><span class="post-words"><i class="fa fa-pencil-square-o"></i> <span class="text_words">Count: </span><span>1.2k words</span> </span>&nbsp| &nbsp<span class="post-time"> <i class="fa fa-clock-o"></i> <span class="text_time">Time: </span><span>7 mins</span></span></div><div class="post-content"><blockquote><ul><li>原文地址：<a href="https://blog.bitsrc.io/how-does-javascript-really-work-part-1-7681dd54a36d" target="_blank" rel="noopener">How Does JavaScript Really Work? (Part 1)</a></li><li>原文作者：<a href="https://blog.bitsrc.io/@priyeshp18" target="_blank" rel="noopener">Priyesh Patel</a></li><li>译者：Chor<a id="more"></a></li></ul></blockquote><p><img src="https://cdn-images-1.medium.com/max/1000/1*qk4FdlK-l_gk57eNPGRjdg.jpeg" alt=""></p><p>If you are a JS developer or a student learning the language, there is a very high chance that you came across the two-letter word ‘V8’’. In this article, I will give you a brief overview of different JS engines and then dive deeper into how the V8 engine works. The second part of this article will contain memory management concepts and will be released soon.</p><p>This post is brought to you by <a href="https://bit.dev" target="_blank" rel="noopener"><strong>Bit</strong></a> (<a href="https://github.com/teambit/bit" target="_blank" rel="noopener">GitHub</a>): the platform for shared components. Bit helps everyone build modular JavaScript applications, easily share components between projects and team, and build better &amp; faster. <a href="https://bit.dev" target="_blank" rel="noopener">Try it</a>.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*hYwQPI1QjCqXT-5YuNEfnA.gif" alt=""></p><p>Bit: easily share components between projects and teams.</p><h3 id="How-do-programming-languages-work"><a href="#How-do-programming-languages-work" class="headerlink" title="How do programming languages work?"></a>How do programming languages work?</h3><p>Before we start with JavaScript, let’s understand the basic working of any programming language. The computer is made of microprocessors and we write code to instruct this tiny but powerful machines. But what is the language that the microprocessors understand? They don’t understand Java, Python, etc., but only machine code.</p><p>Writing enterprise level code in machine or assembly language is not feasible, so we need High-level languages like Java, Python along with a compiler or an interpreter to convert it to machine code.</p><h4 id="Compilers-and-Interpreters"><a href="#Compilers-and-Interpreters" class="headerlink" title="Compilers and Interpreters"></a>Compilers and Interpreters</h4><p>Compiler/interpreter can be written the same language that it processes or any other language too.</p><p><strong>Interpreter:</strong> Reads and translates the file line by line on the fly. Initially, this is how JavaScript worked.</p><p><strong>Compiler:</strong> A compiler works ahead of time and creates a new file which contains the machine code translation for your input file.</p><p>There are two ways in which we could translate the JavaScript code to machine code. When the code is compiled, the machine has a better understanding of what is going to happen before the code starts to run which makes the execution faster later on, but it takes some time up front for this process.</p><p>On the other hand, when the code is interpreted, the execution starts immediately and hence faster, but lack of optimizations makes it really slow with large applications.</p><p>People making the ECMAScript engines are really smart, so they use the best of both worlds and make a JIT(Just-in-time) compiler. JavaScript is compiled as well as interpreted but the actual implementation and order depend on the engine. We will see what is the strategy employed by the team at V8.</p><h3 id="JavaScript-to-Machine-code"><a href="#JavaScript-to-Machine-code" class="headerlink" title="JavaScript to Machine code"></a>JavaScript to Machine code</h3><p>In the case of JavaScript, there is an engine to convert it to machine code. Similar to other languages, this engine can be built using any language and hence there is not just one engine.</p><ul><li>V8 is Google’s implementation of the engine for its Chrome browser.</li><li>SpiderMonkey was the first engine built for Netscape Navigator and now powers FireFox.</li><li>JavaScriptCore is what Apple uses for the Safari browser.</li></ul><p>This list is quite big and if you want to know the engine behind Internet Explorer, visit <a href="https://en.wikipedia.org/wiki/JavaScript_engine" target="_blank" rel="noopener">this Wikipedia page</a>.</p><h4 id="ECMAScript"><a href="#ECMAScript" class="headerlink" title="ECMAScript"></a>ECMAScript</h4><p>One question arises from the huge list of engines; Can I make my own engine? Yes, just follow the ECMAScript standard.</p><p>If we are making a translator, we need to know the valid words from both the languages. We already know what is valid in machine language, but what is valid in JavaScript needs to be standardized.</p><p>This standardization of JavaScript is handled by an organization called Ecma International in a specification called the ECMAScript or ES. So now when you come across an article/video “What’s new in ES7?”, you know that it refers to the newly added features to JS by the ECMAScript standard.</p><h3 id="The-V8-engine"><a href="#The-V8-engine" class="headerlink" title="The V8 engine"></a>The V8 engine</h3><h4 id="Some-history"><a href="#Some-history" class="headerlink" title="Some history"></a>Some history</h4><p>Google created Google Maps for the browser which required a lot of processing power. The JavaScript implementation at that time was not good enough to run maps fast. Google wants to bring more users to their services so that they can sell more advertisements and make money. For this, the service needs to be fast and robust. So Google built its own engine called the V8 in C++ which was launched in 2008 and quite fast or as some say the fastest.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*ab5fIXSXiqsOJ7i5ztkoUg.jpeg" alt=""></p><h4 id="Parsing-and-building-the-tree"><a href="#Parsing-and-building-the-tree" class="headerlink" title="Parsing and building the tree"></a>Parsing and building the tree</h4><p>The JavaScript file enters the engine and the parser does lexical analysis which breaks the code into tokens to identify their meaning. These tokens make the <strong>AST(Abstract Syntax Tree).</strong></p><p><img src="https://cdn-images-1.medium.com/max/1000/1*OYiEF_Ww7vPwBZHCSUMc9g.png" alt=""></p><p>The ASTs play a critical role in the semantic analysis where the compiler validates the correct usage of the language elements and keywords. Later on, the ASTs are used to generate the actual bytecode or machine code.</p><p><img src="https://cdn-images-1.medium.com/max/1000/1*53x9GFuVvXzJCBGpIq2NTA.png" alt=""></p><p>JavaScript to AST using <a href="https://astexplorer.net/" target="_blank" rel="noopener">astexplorer.net</a></p><h4 id="Heart-of-the-engine"><a href="#Heart-of-the-engine" class="headerlink" title="Heart of the engine"></a>Heart of the engine</h4><p><img src="https://cdn-images-1.medium.com/max/1000/1*40bGOSBZybO2iZMUNGxoJQ.jpeg" alt=""></p><ul><li>As we discussed earlier, JavaScript is interpreted by an interpreter named <strong>Ignition</strong> as well as compiled by a JIT optimizing compiler named <strong>TurboFan</strong>.</li><li>Initially, the ASTs generated in the previous step are given to the interpreter which generates non-optimized machine code quickly and the execution can start with no delay.</li><li><strong>Profiler</strong> watches the code as it runs and identifies areas where optimizations can be performed. For example, a ‘for’ loop running 100 times but producing the same result in each iteration.</li><li>Using this profiler, any unoptimized code is passed to the compiler to perform optimizations and generate machine code which eventually replaces its counterpart in the previously generated non-optimized code by the interpreter.</li><li>As the profiler and compiler constantly make changes to the bytecode, the JavaScript execution performance gradually improves.</li></ul><h4 id="Some-more-history"><a href="#Some-more-history" class="headerlink" title="Some more history"></a>Some more history</h4><p>Before the release of version 5.9 of the V8, it used two optimizing compilers and a baseline compiler.</p><ul><li>The Baseline compiler named full-codegen produced machine code quickly which was not optimized.</li><li>The two optimizing compilers named Crankshaft and TurboFan were employed in the optimization of the code.</li></ul><p>With new features added to JavaScript, it became difficult for the V8 team to maintain the same pipeline because of increasing architectural complexity. If you want to read more about the old approach and the reasons for the switch to a new pipeline, visit <a href="https://v8.dev/blog" target="_blank" rel="noopener">their site here</a>.</p><h4 id="Into-the-future"><a href="#Into-the-future" class="headerlink" title="Into the future"></a>Into the future</h4><p>This working of the V8 engine may change in the future as more research is done to further improve performance. Moreover, as <a href="https://webassembly.org" target="_blank" rel="noopener">Webassembly</a> starts to take shape, an additional step may be added to the pipeline.</p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>There are a lot of implementations of the ECMAScript engines and V8 by Google is the most famous one. I hope this article succeeded in giving you a brief overview of not only how JavaScript works, but also in general how a programming language works. If you want to know what are the future plans of the V8 team or want even more details on the engine, they have a wonderful blog <a href="https://v8.dev/blog" target="_blank" rel="noopener">here</a>.</p><p>Part 2 of this article will be released soon in which I will talk about memory heap, stack, event loop and may more concepts related to the execution of JavaScript code. So stay tuned!</p><p>If you are confused where Node.js fits in all these, I have accidentally written a very good article.</p><p><a href="https://medium.freecodecamp.org/what-exactly-is-node-js-ae36e97449f5" title="https://medium.freecodecamp.org/what-exactly-is-node-js-ae36e97449f5" target="_blank" rel="noopener"><strong>What exactly is Node.js?</strong><br>_Node.js is a JavaScript runtime environment. Sounds great, but what does that mean? How does that work?_medium.freecodecamp.org</a><a href="https://medium.freecodecamp.org/what-exactly-is-node-js-ae36e97449f5" target="_blank" rel="noopener"></a></p></div></article><div class="post-toc"><div id="post-catalog-text" data-catalog="Article Catalog"></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#How-do-programming-languages-work"><span class="toc-text">How do programming languages work?</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Compilers-and-Interpreters"><span class="toc-text">Compilers and Interpreters</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JavaScript-to-Machine-code"><span class="toc-text">JavaScript to Machine code</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ECMAScript"><span class="toc-text">ECMAScript</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#The-V8-engine"><span class="toc-text">The V8 engine</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Some-history"><span class="toc-text">Some history</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Parsing-and-building-the-tree"><span class="toc-text">Parsing and building the tree</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Heart-of-the-engine"><span class="toc-text">Heart of the engine</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Some-more-history"><span class="toc-text">Some more history</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Into-the-future"><span class="toc-text">Into the future</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Conclusion"><span class="toc-text">Conclusion</span></a></li></ol><div id="post-toTop-text" data-totop="To the Top"></div></div><div id="vcomments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue/tree/master/PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="/js/navbar.js"></script><script src="/js/code.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c5ffe9669609061"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/tororo.model.json"},display:{position:"left",width:150,height:300,vOffset:-120,hOffset:-5},mobile:{show:!1},react:{opacityDefault:1e3,opacityOnHover:1e3},log:!1})</script></body></html><!-- rebuild by neat -->