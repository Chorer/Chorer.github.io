<!-- build time:Tue Oct 22 2019 13:51:48 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Chor&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third party/pace-theme-flash.css"><link rel="icon" href="/images/me.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><header class="header"><div class="header_top"><span class="theme"><i class="fa fa-bars"></i> <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">HOME</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">CATEGORIES</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">ARCHIVES</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">TAGS</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">ABOUT</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a href="/" class="logo">Chor&#39;s Blog</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">「译」创建一个Hexo主题-Part3 :评论、分析和小部件</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-06-05&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp2k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp8 mins&nbsp&nbsp&nbsp</span><div class="post-tags"><i class="fa fa-tags"></i> <a href="/tags/hexo-theme/">hexo theme</a></div></div><div class="post-content"><blockquote><ul><li>原文地址：<a href="http://www.codeblocq.com/2016/03/Create-an-Hexo-Theme-Part-3-Comments-Analytics-and-Widgets/" target="_blank" rel="noopener">Create an Hexo Theme - Part 3: Comments, Analytics and Widgets</a></li><li>原文作者：Jonathan Klughertz</li><li>译者：Chor<a id="more"></a></li></ul></blockquote><p>在这个系列教程中，你将学习怎么从零开始制作一个 Hexo 主题。<br>在 <a href="https://chorer.github.io/%2F2019%2F03%2F27%2FTrs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart1%2F">part1</a> 和 <a href="https://chorer.github.io/%2F2019%2F03%2F27%2FTrs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart2%2F">part2</a> 中，我们已经创建了博客的所有页面。在这篇文章中，我们将给博客添加 <a href="https://disqus.com/" target="_blank" rel="noopener">Disqus 评论系统</a>，实现 <a href="https://www.google.com.sg/analytics/" target="_blank" rel="noopener">谷歌分析</a>以及完成侧边栏的小部件。</p><h2 id="其它文章的链接："><a href="#其它文章的链接：" class="headerlink" title="其它文章的链接："></a>其它文章的链接：</h2><ul><li><a href="https://chorer.github.io/%2F2019%2F03%2F27%2FTrs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart1%2F">创建一个Hexo主题-Part1:首页</a></li><li><a href="https://chorer.github.io/%2F2019%2F03%2F27%2FTrs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart2%2F">创建一个Hexo主题-Part2:其他页面</a></li><li><a href="https://chorer.github.io/2019/06/05/Trs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart3/">创建一个Hexo主题-Part3:评论、分析和小部件</a></li></ul><h2 id="Disqus-评论系统"><a href="#Disqus-评论系统" class="headerlink" title="Disqus 评论系统"></a>Disqus 评论系统</h2><p>我已经写了一篇关于<a href="http://www.codeblocq.com/2015/12/Add-Disqus-comments-in-Hexo/" target="_blank" rel="noopener">如何在 Hexo 中使用 Disqus 评论系统</a>的文章。请前往查看以了解更多信息，这里我只简单介绍一下怎么使用：</p><p>第一步是获取 Disqus UID 来测试评论功能，可以利用你的账号在这里获取：<br><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/blog-2019-6-21/QQ%E5%9B%BE%E7%89%8720190621145305.jpg" alt=""><br>接下来需要完成三个部分：主题文件的 disqus 配置、评论占位区、Disqus 脚本。事不宜迟，我们开始吧。</p><h3 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h3><p>我们希望 Disqus UID 是可以配置的，因此给主题的 <code>config.yml</code> 文件添加一个条目：</p><pre><code class="js"># Disqus Comments Shortname
disqus_shortname: klugjoTest
</code></pre><h3 id="评论占位区"><a href="#评论占位区" class="headerlink" title="评论占位区"></a>评论占位区</h3><p>接下来我们给页面和文章详情页添加评论系统。和之前一样，创建一个局部视图文件 <code>layout/_partial/comments.ejs</code>，之后打开 <code>layout/_partial/article-full.ejs</code> 文件，把它插入到末尾。</p><pre><code class="js">/* layout/_partial/comments.ejs */
&lt;div class=&quot;blog-post&quot;&gt;
   [...]
    &lt;!-- Comments --&gt;
    &lt;%- partial(&#39;comments&#39;) %&gt;
&lt;/div&gt;
</code></pre><p>Disqus 需要 ID 为 <code>disqus_thread</code> 的 div 元素，因此我们这里复制官方文档提供的代码：</p><pre><code class="html">&lt;div id=&quot;disqus_thread&quot;&gt;
    &lt;noscript&gt;Please enable JavaScript to view the &lt;a href=&quot;//disqus.com/?ref_noscript&quot;&gt;comments powered by Disqus.&lt;/a&gt;&lt;/noscript&gt;
&lt;/div&gt;
</code></pre><p>将上面的代码合并到 <code>comments</code> 文件中：</p><pre><code class="js">/* layout/_partial/comments.ejs */
&lt;% if(page.comments &amp;&amp; theme.disqus_shortname){ %&gt;
    &lt;div class=&quot;blog-post-comments&quot;&gt;
        &lt;h3&gt;Comments:&lt;/h3&gt;
        &lt;div id=&quot;disqus_thread&quot;&gt;
            &lt;noscript&gt;Please enable JavaScript to view the &lt;a href=&quot;//disqus.com/?ref_noscript&quot;&gt;comments powered by Disqus.&lt;/a&gt;&lt;/noscript&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;% } %&gt;
</code></pre><p>首先我们检查是否开启了评论功能和设置了 disqus UID，之后将 Disqus 标记代码放到容器里。<br>以下是容器的 CSS 样式代码：</p><pre><code class="css">/* source/css/blog.css */
.blog-post-comments {
    margin-top: 50px;
}
</code></pre><h3 id="Disqus-脚本"><a href="#Disqus-脚本" class="headerlink" title="Disqus 脚本"></a>Disqus 脚本</h3><p>在测试之前，我们还需要添加 Disqus 的脚本，这是一切生效的关键。将它和其他脚本一起放在 <code>layout/_partial/after-footer.ejs</code> 的末尾</p><pre><code class="js">/* layout/_partial/after-footer.ejs */
&lt;!-- Disqus Comments --&gt;
&lt;% if (theme.disqus_shortname){ %&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        var disqus_shortname = &#39;&lt;%= theme.disqus_shortname %&gt;&#39;;
        (function(){
            var dsq = document.createElement(&#39;script&#39;);
            dsq.type = &#39;text/javascript&#39;;
            dsq.async = true;
            dsq.src = &#39;//&#39; + disqus_shortname + &#39;.disqus.com/&lt;% if (page.comments){ %&gt;embed.js&lt;% } else { %&gt;count.js&lt;% } %&gt;&#39;;
            (document.getElementsByTagName(&#39;head&#39;)[0] || document.getElementsByTagName(&#39;body&#39;)[0]).appendChild(dsq);
        }());
    &lt;/script&gt;
&lt;% } %&gt;
</code></pre><p>脚本来自于<a href="https://help.disqus.com/customer/portal/articles/472097-universal-embed-code" target="_blank" rel="noopener">官方文档</a>,并且我们在这里将 Disqus UID 参数化。<br>接着就可以测试一切是否正常工作了。</p><h2 id="谷歌分析"><a href="#谷歌分析" class="headerlink" title="谷歌分析"></a>谷歌分析</h2><p>谷歌分析的实现和 Disqus 差不多，所以这里我只简单提一下。具体步骤可以看我的<a href="http://www.codeblocq.com/2015/12/Add-Google-Analytics-to-your-hexo-blog/" target="_blank" rel="noopener">另一篇博客</a>。</p><h3 id="在主题配置文件中设置-tracking-ID"><a href="#在主题配置文件中设置-tracking-ID" class="headerlink" title="在主题配置文件中设置 tracking ID"></a>在主题配置文件中设置 tracking ID</h3><p>从你的账号中获取谷歌分析的 tracking ID，之后再配置文件中新增条目。</p><pre><code class="js"># Google Analytics Tracking ID
google_analytics: UA-83746351-2
</code></pre><h3 id="创建一个新的局部文件"><a href="#创建一个新的局部文件" class="headerlink" title="创建一个新的局部文件"></a>创建一个新的局部文件</h3><p>创建一个新的局部视图文件 <code>layout/_partial/google-analytic.ejs</code></p><pre><code class="js">/* layout/_partial/google-analytic.ejs */
&lt;% if (theme.google_analytics){ %&gt;
    &lt;script&gt;
        (function(i,s,o,g,r,a,m){i[&#39;GoogleAnalyticsObject&#39;]=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,&#39;script&#39;,&#39;//www.google-analytics.com/analytics.js&#39;,&#39;ga&#39;);
        ga(&#39;create&#39;, &#39;&lt;%= theme.google_analytics %&gt;&#39;, &#39;auto&#39;);
        ga(&#39;send&#39;, &#39;pageview&#39;);
    &lt;/script&gt;
&lt;% } %&gt;
</code></pre><p>这是从<a href="https://support.google.com/analytics/answer/1008080?hl=en" target="_blank" rel="noopener">谷歌分析跟踪代码</a>复制粘贴过来的，其中包括一个参数化的 ID。</p><h3 id="合并到局部文件中"><a href="#合并到局部文件中" class="headerlink" title="合并到局部文件中"></a>合并到局部文件中</h3><p>我们希望可以在任何页面中获取到跟踪代码，而页面上又没有合适的位置来存放，因此我们选择把它添加到 <code>&lt;head&gt;&lt;/head&gt;</code> 的末尾：</p><pre><code class="js">/* layout/_partial/head.ejs */
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    [...]
    &lt;!-- Google Analytics --&gt;
    &lt;%- partial(&#39;google-analytics&#39;) %&gt;
&lt;/head&gt;
</code></pre><p>大功告成！</p><h2 id="小部件"><a href="#小部件" class="headerlink" title="小部件"></a>小部件</h2><p>此时，<code>sidebar.ejs</code> 文件中的小部件还只是一堆采用硬编码的静态 HTML。我们来修复这个问题。</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>先从配置开始吧。<br>我们准备创建两个小部件，一个是“关于”，一个是“标签”。相关配置如果以 JavaScript 对象的形式来书写，大概是下面这样：</p><pre><code class="js">{
    widgets: {
        about: &quot;Here goes the about text&quot;,
        tags: true // Or any additional configuration the widget needs
    }
}
</code></pre><p>这是它在我们的主题配置文件中转换成 YML 的形式：</p><pre><code class="js"># Widgets List
widgets:
  about: This blog is based off the official bootstrap blog template. Checkout the corresponding tutorial at &lt;a href=&quot;http://www.codeblocq.com&quot;&gt;http://www.codeblocq.com&lt;/a
  tags: true
</code></pre><h3 id="侧边栏代码"><a href="#侧边栏代码" class="headerlink" title="侧边栏代码"></a>侧边栏代码</h3><p>作为所有小部件的占位区，我们的侧边栏需要遍历配置文件中的所有小部件并将其渲染出来：<br>侧边栏的 EJS 模板如下：</p><pre><code class="js">/* layout/_partial/sidebar.ejs */
&lt;% for(var widget in theme.widgets){ %&gt;
    &lt;%- partial(&#39;widget/&#39; + widget) %&gt;
&lt;% }; %&gt;
</code></pre><h3 id="第一个小部件：“关于”"><a href="#第一个小部件：“关于”" class="headerlink" title="第一个小部件：“关于”"></a>第一个小部件：“关于”</h3><p>新建一个局部文件 <code>layout/_partial/widget/about.ejs</code>，之后在里面创建第一个小部件。<br>代码是从原先的 bootstrap 模板中复制过来的，文本则来自于配置文件。</p><pre><code class="js">/* layout/_partial/widget/about.ejs */
&lt;% if(theme.widgets.about){ %&gt;
    &lt;div class=&quot;sidebar-module sidebar-module-inset&quot;&gt;
        &lt;h4&gt;About&lt;/h4&gt;
        &lt;p&gt;&lt;%- theme.widgets.about %&gt;&lt;/p&gt;
    &lt;/div&gt;
&lt;% } %&gt;
</code></pre><h3 id="第二个小部件：“标签”"><a href="#第二个小部件：“标签”" class="headerlink" title="第二个小部件：“标签”"></a>第二个小部件：“标签”</h3><p>我们给这个部件做一些略微高级的改动。设置一个段落用于存放博客中用过的所有标签。它们互相之间用空格隔开，并且字体大小与标签使用次数成比例。<br>这是 <code>layout/_partial/widget/tags.ejs</code> 的代码：</p><pre><code class="js">/* layout/_partial/widget/tags.ejs */
&lt;% if (theme.widgets.tags &amp;&amp; site.tags.length){ %&gt;
    &lt;div class=&quot;sidebar-module&quot;&gt;
        &lt;h4&gt;Tags&lt;/h4&gt;
        &lt;p&gt;
            &lt;% site.tags.sort(&#39;name&#39;).each(function(item){ %&gt;
                &lt;a href=&quot;&lt;%- config.root %&gt;&lt;%- item.path %&gt;&quot; style=&quot;font-size: &lt;%- Math.min(item.posts.length * 2 + 13, 30) %&gt;px&quot;&gt;&lt;%= item.name %&gt;&lt;/a&gt;
            &lt;% }); %&gt;
        &lt;/p&gt;
    &lt;/div&gt;
&lt;% } %&gt;
</code></pre><ul><li><code>site.tags</code> 让我们可以获取所有标签</li><li><code>site.tags.sort(&#39;name)</code> 按照字母表的顺序对所有标签进行排序</li><li><code>item.path</code> 对应标签归档页的相对 URL</li><li><code>item.posts.length</code> 表示标签的使用次数</li><li><code>item.name</code> 是标签的名字</li></ul><p>我这里选择 <code>13+（标签使用次数 *2）px</code> 作为字体大小的计算方式，并且最大不超过 <code>30px</code>。当然，你可以根据自己的喜好来。</p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>教程到这里就结束了，我希望你从中可以学到不少有趣的东西。<br>如果你想进一步打磨主题，可以考虑下面这些事情：</p><ul><li>通过参数化 <code>&lt;title&gt;</code> 和所有 <a href="http://ogp.me/" target="_blank" rel="noopener">Open Graph</a> 属性完善 <code>head</code> 部分</li><li>添加更多小部件，例如<a href="https://github.com/hexojs/hexo-theme-light/blob/master/layout/_widget/search.ejs" target="_blank" rel="noopener">搜索小部件</a> 或者是一个 <a href="https://github.com/hexojs/hexo-theme-light/blob/master/layout/_widget/recent_posts.ejs" target="_blank" rel="noopener">近期文章小部件</a></li><li>将你的主题提交到 <a href="https://hexo.io/themes/" target="_blank" rel="noopener">Hexo官方主题站点</a></li><li>查看我的其他 <a href="http://www.codeblocq.com/tags/" target="_blank" rel="noopener">Hexo 教程</a>来改进你的博客</li><li>查看<a href="https://github.com/cgmartin/hexo-theme-bootstrap-blog" target="_blank" rel="noopener">hexo-theme-bootstrap-blog</a>,这个主题同样是基于 bootstrap 模板实现的</li><li>从零开始打造你自己的主题</li></ul><p>感谢阅读！欢迎在评论区留下你的评论、指正和意见。</p></div><div class="post-nav"><div class="post-nav-prev"><a href="/2019/06/06/F-CSS 基础系列：flex 布局/" rel="prev" title="CSS 基础系列：flex 布局"><i class="fa fa-angle-double-left"></i>&nbspCSS 基础系列：flex 布局</a></div><div class="post-nav-next"><a href="/2019/05/31/F-CSS 基础系列：常见布局方式/" rel="next" title="CSS 基础系列：常见布局方式">CSS 基础系列：常见布局方式&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top"><i class="fa fa-th-large"></i>Catalog</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#其它文章的链接："><span class="toc-text">其它文章的链接：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Disqus-评论系统"><span class="toc-text">Disqus 评论系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主题配置"><span class="toc-text">主题配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#评论占位区"><span class="toc-text">评论占位区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Disqus-脚本"><span class="toc-text">Disqus 脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#谷歌分析"><span class="toc-text">谷歌分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在主题配置文件中设置-tracking-ID"><span class="toc-text">在主题配置文件中设置 tracking ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建一个新的局部文件"><span class="toc-text">创建一个新的局部文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#合并到局部文件中"><span class="toc-text">合并到局部文件中</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小部件"><span class="toc-text">小部件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#侧边栏代码"><span class="toc-text">侧边栏代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第一个小部件：“关于”"><span class="toc-text">第一个小部件：“关于”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二个小部件：“标签”"><span class="toc-text">第二个小部件：“标签”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后"><span class="toc-text">最后</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/search.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/tororo.model.json"},display:{position:"left",width:150,height:300,vOffset:-120,hOffset:-5},mobile:{show:!1},react:{opacityDefault:1e3,opacityOnHover:1e3},log:!1})</script></body></html><!-- rebuild by neat -->