<!-- build time:Sun Sep 05 2021 16:01:26 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Focus on FE learning</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third%20party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third%20party/pace-theme-flash.css"><link rel="icon" href="/images/kour.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head><body><header class="header"><div class="header_top"><span class="theme"><a href="/">Chor's blog</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">首页</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">分类</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">归档</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">标签</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">关于</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a target="_blank" rel="noopener" href="https://github.com/Chorer/hexo-theme-PureBlue" class="logo">Focus on FE learning</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div><div class="blog-down"><a href="javascript:void(0);"><i class="fa fa-angle-double-down fa-2x"></i></a></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">在项目中使用 vue-awesome-swiper 遇到的问题</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2020-03-08&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp1.8k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp7 mins&nbsp&nbsp&nbsp</span><div class="post-tags"></div></div><div class="post-content"><div class="figure"><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8%20vue-awesome-swiper%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8%20vue-awesome-swiper%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98-0.jpg"></div><span id="more"></span><h3 id="问题复现">问题复现</h3><p>最近做的商城项目需要在首页展示一个轮播图，秉承着“有现成轮子就绝不自己写”（其实是懒和菜）的想法，在网上搜索了一下，最后选择使用 <a target="_blank" rel="noopener" href="https://github.com/surmon-china/vue-awesome-swiper">vue-awesome-swiper</a>。安装和使用就不说了，可以直接看 GitHub 的文档。按照文档写完基础结构后，实际使用的时候遇到了几个问题：</p><ul><li><p>图片轮播到最后一张时自动停止，无法循环播放</p></li><li><p>分页器不显示</p></li><li><p>无法修改分页器样式</p></li></ul><p>前两个其实是一样的问题，我这里轮播图的数据放在 <code>banners</code> 里，一开始没赋值的时候默认是空数组，没有数据，所以这时候会导致轮播图运行不正常。解决这个问题只需要在 <code>swiper</code> 加一个判断就好：<code>v-if=&quot;banners.length != 0&quot;</code>。第三个问题则是因为 <code>style</code> 标签使用了 <code>scoped</code> 声明，导致无法修改第三方组件库的样式。之前写单文件组件都是习惯性地加 <code>scoped</code>，没有考虑太多。这次遇到了问题，所以花时间研究了一下这个东西，然后查找了一些合适的解决方案，在这里做一个记录。</p><h3 id="为什么需要-scoped">为什么需要 <code>scoped</code></h3><p>官方文档的介绍： https://vue-loader.vuejs.org/guide/scoped-css.html</p><p>为了实现样式的模块化、私有化，防止全局样式污染，我们可以给单文件组件中的 <code>style</code> 标签添加 <code>scoped</code>属性，这样，里面书写的 CSS 样式就只能应用于当前的组件。其原理是通过 PostCSS 实现的，经过编译后，<code>template</code> 中手写的元素会与 <code>style</code> 中的样式通过自定义属性 <code>data-v-xxx</code> 形成对应。也就是说，我们写的样式实际上只对<strong>具有对应自定义属性的元素</strong>生效，而由于这样的元素只存在于组件模板中，所以确保了样式只对当前组件生效。例如：</p><div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html">// test.vue
<span class="kw">&lt;template&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;test&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;a&gt;&lt;img&gt;&lt;/a&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;/template&gt;</span>
<span class="kw">&lt;style</span><span class="ot"> scoped</span><span class="kw">&gt;</span>
    div img<span class="kw">&#123;</span>
        <span class="kw">width:</span><span class="dt">100%</span><span class="kw">;</span>
    <span class="kw">&#125;</span>
<span class="kw">&lt;/style&gt;</span></code></pre></div><p>上面的代码经过编译后，实际上会变成：</p><div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html">// test.vue
<span class="kw">&lt;template&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;test&quot;</span><span class="ot"> data-v-1a0c5ce5</span><span class="kw">&gt;</span>
        <span class="kw">&lt;a</span><span class="ot"> data-v-1a0c5ce5</span><span class="kw">&gt;</span>
            <span class="kw">&lt;img</span><span class="ot"> data-v-1a0c5ce5</span><span class="kw">&gt;</span>
        <span class="kw">&lt;/a&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;/template&gt;</span>
<span class="kw">&lt;style</span><span class="ot"> scoped</span><span class="kw">&gt;</span>
    div img<span class="at">[data-v-1a0c5ce5]</span><span class="kw">&#123;</span>
        <span class="kw">width:</span><span class="dt">100%</span><span class="kw">;</span>
    <span class="kw">&#125;</span>
<span class="kw">&lt;/style&gt;</span></code></pre></div><p>如果没有加 <code>scoped</code> ，那么宽度 100% 这个样式会作用于所有的图片；由于使用了 <code>scoped</code>，所以这个样式只对当前组件生效。</p><p>同样的，如果是父子组件：</p><div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html">// 父组件
<span class="kw">&lt;template&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;parent&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;son&gt;</span>
        <span class="kw">&lt;span&gt;</span>我是插槽<span class="kw">&lt;/span&gt;</span>  
      <span class="kw">&lt;/son&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;/template&gt;</span>

<span class="kw">&lt;style</span><span class="ot"> scoped</span><span class="kw">&gt;</span>
    <span class="fl">.parent</span> <span class="fl">.son</span><span class="kw">&#123;</span>
        <span class="kw">border:</span><span class="dt">2px</span> <span class="dt">solid</span> <span class="dt">red</span>
    <span class="kw">&#125;</span>
    <span class="fl">.parent</span> <span class="fl">.son</span> h1<span class="kw">&#123;</span>
        <span class="kw">color:</span> <span class="dt">green</span>
    <span class="kw">&#125;</span>
    span<span class="kw">&#123;</span>
        <span class="kw">color:</span><span class="dt">yellow</span>
    <span class="kw">&#125;</span>
<span class="kw">&lt;/style&gt;</span>

//子组件
<span class="kw">&lt;template&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;son&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;h1&gt;</span>我是子组件<span class="kw">&lt;/h1&gt;</span>
        <span class="kw">&lt;slot&gt;&lt;/slot&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;/template&gt;</span></code></pre></div><p>我们会发现，可以在父组件中修改子组件根元素（<code>div.son</code>）以及子组件插槽的样式，但是无法修改子组件子元素（<code>h1</code>）的样式。在控制台中可以看到，代码编译后是这样的：</p><div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;parent&quot;</span><span class="ot"> data-v-1a0c5ce5</span><span class="kw">&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;son&quot;</span><span class="ot"> data-v-1a0c5ce5</span><span class="kw">&gt;</span>
        <span class="kw">&lt;h1&gt;</span>我是子组件<span class="kw">&lt;/h1&gt;</span>
        <span class="kw">&lt;span</span><span class="ot"> data-v-1a0c5ce5</span><span class="kw">&gt;</span>我是插槽<span class="kw">&lt;/span&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
<span class="kw">&lt;/div&gt;</span>

<span class="kw">&lt;style&gt;</span>
    <span class="fl">.parent</span> <span class="fl">.son</span><span class="at">[data-v-1a0c5ce5]</span><span class="kw">&#123;</span>
        <span class="kw">border:</span><span class="dt">2px</span> <span class="dt">solid</span> <span class="dt">red</span>
    <span class="kw">&#125;</span>
    h1<span class="kw">&#123;</span>
        <span class="kw">color:</span> <span class="dt">green</span>
    <span class="kw">&#125;</span>
    span<span class="at">[data-v-1a0c5ce5]</span><span class="kw">&#123;</span>
        <span class="kw">color:</span><span class="dt">yellow</span>
    <span class="kw">&#125;</span>
<span class="kw">&lt;/style&gt;</span></code></pre></div><p>这是因为，不管是子组件根元素还是子组件的插槽，最终都是实际书写在父组件的 <code>template</code> 中的，所以父组件中书写的样式能够对应地在父组件模板中找到 DOM；而子组件的子元素（比如上面的 <code>h1</code>），它实际上是<strong>在子组件模板书写</strong>的，此时没法通过自定义属性建立样式与 DOM 的对应关系。因此这个样式不生效，这样也就防止了在父组件的层面上修改子组件的样式。</p><h3 id="回到一开始的问题">回到一开始的问题</h3><p>再回到一开始的问题，轮播图的结构大概是这样的：</p><div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;template&gt;</span>
  <span class="kw">&lt;swiper&gt;</span>  
      <span class="kw">&lt;swiper-slide</span><span class="ot"> v-for=</span><span class="st">&quot;item in banners&quot;</span><span class="kw">&gt;</span>  
        <span class="co">&lt;!--渲染部分--&gt;</span>
      <span class="kw">&lt;/swiper-slide&gt;</span>  
      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;swiper-pagination&quot;</span><span class="ot"> v-for=</span><span class="st">&quot;item in banners&quot;</span><span class="ot"> slot=</span><span class="st">&quot;pagination&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>  
  <span class="kw">&lt;/swiper&gt;</span>  
<span class="kw">&lt;/template&gt;</span></code></pre></div><p><code>div.swiper-pagination</code> 只是包裹每个圆点 <code>span.swiper-pagination-bullets</code> 的容器，实际上没有在 <code>template</code> 中直接书写 <code>span.swiper-pagination-bullets</code> 。这里我看了下源文件，还是没有找到这几个圆点是怎么来的，但可以肯定是动态生成的，所以猜测可能是组件样式的 <code>scoped</code> 为样式和 DOM 建立对应关系的时候，此时这些圆点还没有生成，也就是说，圆点“错过了”添加自定义属性的过程。当然这个只是猜测，如果有大佬知道这里面的具体过程，也欢迎在下面评论区指出。</p><h3 id="如何修改第三方组件库的样式">如何修改第三方组件库的样式</h3><p>虽然 <code>scoped</code> 可以防止全局样式污染，但是给我们修改第三方组件库的样式带来了困难 —— 就像上面的问题一样，这些第三方插件通常都是项目中的子组件，而我们又需要根据项目需求修改组件样式。那么怎么办呢？这里记录一些<strong>可能的</strong>解决方案：</p><ul><li><p>去掉 <code>scoped</code>：破坏样式的封装，不推荐</p></li><li><p>在 <code>App.vue</code> 中书写全局样式，不推荐，理由同上</p></li><li><p>新建一个 <code>css</code> 样式文件，在里面书写需要覆盖的样式，并在 <code>main,js</code> 引入该文件</p></li><li><p>同时使用带 <code>scoped</code> 与不带 <code>scoped</code> 的 <code>script</code> 标签，在后者书写需要覆盖的样式</p></li><li><p>使用<strong>深度作用选择器</strong>实现样式穿透：</p></li></ul><p>对于 CSS 或者 stylus，使用 <code>&gt;&gt;&gt;</code>。以上面代码为例，如果要实现样式穿透，可以这么写：</p>```css<style scoped>.swiper-pagination>>>.swiper-pagination-bullet-active{background-color:var(--color-tint)}</style><style lang="stylus" scoped></style><p>```</p><p>对于 sass / scss / less / stylus 等预处理器 ，则使用 <code>/deep/</code>：</p><p><code>css &lt;style lang=&quot;xxxx&quot; scoped&gt; .swiper-pagination &#123; /deep/ .swiper-pagination-bullet-active &#123; background-color: var(--color-tint); &#125; &#125; &lt;/style&gt;</code></p><p>不过，如果 <code>.swiper-pagination</code> 中还有其它子元素需要修改样式，难道每次都要在子元素前面声明 <code>/deep/</code> 或者 <code>&gt;&gt;&gt;</code> 吗？其实不用，我们只需要给最外层的元素套用深度选择器即可：</p><p><code>css &lt;style lang=&quot;xxxx&quot; scoped&gt; /deep/ .swiper-pagination &#123; .swiper-pagination-bullet-active &#123; background-color: var(--color-tint); &#125; .anotherClass &#123; xxxxxxxx &#125; &#125; &lt;/style&gt;</code></p><p>在使用 <code>/deep/</code> 的时候可能会遇到编译报错的问题（虽然我没遇到过），为了避免这种情况，以及为了提高编译速度，我们可以用更加统一的 <code>::v-deep</code>：</p><p><code>css &lt;style lang=&quot;xxxx&quot; scoped&gt; .swiper-pagination &#123; ::v-deep .swiper-pagination-bullet-active &#123; background-color: var(--color-tint); &#125; &#125; &lt;/style&gt;</code></p><p>这种方式是普适的，无论 CSS 还是预处理器都可以使用。</p></div><div class="post-nav"><div class="post-nav-prev"><a href="/2020/03/10/OS-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-1%EF%BC%9A%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" rel="prev" title="操作系统学习笔记-1：基础概念"><i class="fa fa-angle-double-left"></i>&nbsp操作系统学习笔记-1：基础概念</a></div><div class="post-nav-next"><a href="/2020/03/06/F-ES6%E7%9A%84Set%E4%B8%8EMap/" rel="next" title="ES6的Set与Map">ES6的Set与Map&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top">Contents</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%A4%8D%E7%8E%B0"><span class="toc-text">问题复现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-scoped"><span class="toc-text">为什么需要 scoped</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E5%88%B0%E4%B8%80%E5%BC%80%E5%A7%8B%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">回到一开始的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BB%84%E4%BB%B6%E5%BA%93%E7%9A%84%E6%A0%B7%E5%BC%8F"><span class="toc-text">如何修改第三方组件库的样式</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"retro",pageSize:10,visitor:!0})</script></section></main><script>var user=[1,2,3,4]</script><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - <span>2021</span> My Blog</p><p class="a">Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a target="_blank" rel="noopener" href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/search.js"></script><script src="/js/post-except.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script></body></html><!-- rebuild by neat -->