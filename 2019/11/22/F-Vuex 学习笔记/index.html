<!-- build time:Sun Nov 24 2019 12:28:46 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>PureBlue</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third party/pace-theme-flash.css"><link rel="icon" href="/images/me.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script><script src="/js/prism-line-numbers.min.js"></script><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head><body><header class="header"><div class="header_top"><span class="theme"><a href="/">Chor's blog</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">首页</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">分类</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">归档</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">标签</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">关于</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a href="https://github.com/Chorer/hexo-theme-PureBlue" class="logo">PureBlue</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">Vue 全家桶学习笔记：Vuex</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-11-22&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp978&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp4 mins&nbsp&nbsp&nbsp</span><div class="post-tags"></div></div><div class="post-content"><p>![(<a href="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Vue-router/Vue-router-1.jpg" target="_blank" rel="noopener">https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Vue-router/Vue-router-1.jpg</a>)</p><a id="more"></a><h3 id="1-state"><a href="#1-state" class="headerlink" title="1. state"></a>1. state</h3><p>存放数据</p><h3 id="2-getters"><a href="#2-getters" class="headerlink" title="2. getters"></a>2. getters</h3><ul><li><p>相当于组件里的 computed。</p></li><li><p>接受 state 参数和 getters 参数。</p></li><li>由于 getters 里面的函数只接受两个参数，如果要传参，可以考虑让函数返回一个闭包</li></ul><h3 id="3-Commit"><a href="#3-Commit" class="headerlink" title="3. Commit"></a>3. Commit</h3><h4 id="commit-传参"><a href="#commit-传参" class="headerlink" title="commit 传参"></a>commit 传参</h4><p>commit 的时候可以传字符串类型的事件类型和一个 payload ，这个 payload 最后会作为相应事件的参数；也可以在 commit 的时候传一个对象，对象里指定事件类型和 payload，这个对象最后会作为相应事件的参数。</p><h3 id="4-action"><a href="#4-action" class="headerlink" title="4. action"></a>4. action</h3><p>mutations 中的方法必须是同步的，这样 devtools 才可以进行追踪；异步的方法写在 action 中。</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// App.vue</span>
<span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"change"</span><span class="token operator">></span>点击修改属性<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'Achange'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 也接受 payload 参数 </span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// store.js</span>

state<span class="token punctuation">:</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">:</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'Jack'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
mutations<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">Mchange</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'James'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
actions<span class="token punctuation">:</span><span class="token punctuation">{</span>
   <span class="token function">Achange</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
           context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'Mchange'</span><span class="token punctuation">)</span>
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为是异步操作，所以我们很可能需要回调一个函数告知我们异步操作的结果，这时候可以用 Promise。也就是，将 actions 中的异步操作包裹在 Promise 中，并返回这个 Promise，之后在 dispatch 后调用 then（因为 dispatch 后返回的是一个 Promise 实例）</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// store.js</span>

state<span class="token punctuation">:</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">:</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'Jack'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
mutations<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">Mchange</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'James'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
actions<span class="token punctuation">:</span><span class="token punctuation">{</span>
   <span class="token function">Achange</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>payload<span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
           <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
              context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'Mchange'</span><span class="token punctuation">)</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
              <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// App.vue</span>
<span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"change"</span><span class="token operator">></span>点击修改属性<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$store
              <span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'Achange'</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'异步操作成功'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>     
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-module"><a href="#5-module" class="headerlink" title="5. module"></a>5. module</h3><p>由于使用单一状态树（单一状态源），应用的所有状态会集中到一个比较大的对象。当应用变得非常复杂时，store 对象就有可能变得相当臃肿。</p><p>为了解决以上问题，Vuex 允许我们将 store 分割成若干个 module，每个 module 都拥有自己的 state、mutations、actions、getters。</p><h4 id="5-1-state"><a href="#5-1-state" class="headerlink" title="5.1 state"></a>5.1 state</h4><p>单个 module （假定是a）最终会挂载到 store 的 state 上，所以通过 <code>$store.state.a</code>访问 module 上的 state :</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">// store.js</span>
<span class="token keyword">const</span> moduleA <span class="token operator">=</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">:</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'Jack'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
modules<span class="token punctuation">:</span><span class="token punctuation">{</span>
    a<span class="token punctuation">:</span>moduleA
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-html"><code class="language-html"><span class="token comment" spellcheck="true">&lt;!--App.vue--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>{{$store.state.a.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="5-2-getters"><a href="#5-2-getters" class="headerlink" title="5.2 getters"></a>5.2 getters</h4><p>用法和之前一致，首先会到 store 的 getters 下找对应方法，找不到再去单个 module 下的 getters 寻找。getters 中的方法接受的参数，一个是当前 module 下的 state，一个是当前 module 下的 getters</p><h4 id="5-3-mutations"><a href="#5-3-mutations" class="headerlink" title="5.3 mutations"></a>5.3 mutations</h4><p>用法与之前一致，commit 的时候首先会到 store 的 mutations 下找对应方法，找不到再去单个 module 下的 mutations 寻找。</p><h4 id="5-5-actions"><a href="#5-5-actions" class="headerlink" title="5.5 actions"></a>5.5 actions</h4><p>用法和之前类似，依然是直接 dispatch，不过 actions 中的方法的参数 context 不再指向 store ，而是指向单个 module。</p><h3 id="6-Vuex-的响应式"><a href="#6-Vuex-的响应式" class="headerlink" title="6. Vuex 的响应式"></a>6. Vuex 的响应式</h3><p>以下情况，数据不会响应式：</p><ol><li>属性没有事先初始化。比如：</li></ol><pre class="line-numbers language-js"><code class="language-js">state<span class="token punctuation">:</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">:</span><span class="token punctuation">{</span>
        name<span class="token punctuation">:</span><span class="token string">'Jack'</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> <span class="token number">12</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
mutations<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">123</span>     <span class="token comment" spellcheck="true">// id此前没有初始化</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>id</code> 此前并没有初始化，所以事件触发的时候，数据改变，但不会实时响应到界面上，也就是说，不是响应式的。可以采用下面的方法：</p><pre class="line-numbers language-js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>通过 delete 删除属性</li></ol><pre class="line-numbers language-js"><code class="language-js">Vue<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>key<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="7-类型常量"><a href="#7-类型常量" class="headerlink" title="7. 类型常量"></a>7. 类型常量</h3><p>mutations 中的方法名实际上是一个字符串，也就是说，下面两种写法是等效的：</p><pre class="line-numbers language-js"><code class="language-js">mutations<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">// 等价于</span>
    <span class="token punctuation">[</span><span class="token string">'change'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以将所有的方法名各自用一个常量表示，并将它们写在一个统一的文件中，之后在 mutations 和 commit 中表示方法名字的时候，都用这个常量表示。</p><h3 id="8-项目结构"><a href="#8-项目结构" class="headerlink" title="8. 项目结构"></a>8. 项目结构</h3><p>如果把所有的 mutations、getters、actions 等都放在 store.js 文件中，代码会变得很臃肿，所以我们可以进行分离。state 仍然保留在 store.js 文件中，actions、getters、mutations 分离到对应的文件中，各个 module 分离到 modules 文件夹对应的文件中。</p></div><div class="post-nav"><div class="post-nav-prev"></div><div class="post-nav-next"><a href="/2019/11/21/F-Vue 全家桶学习笔记：Vuex /" rel="next" title="Vue 全家桶学习笔记：Vuex">Vue 全家桶学习笔记：Vuex&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top">Contents</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-state"><span class="toc-text">1. state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-getters"><span class="toc-text">2. getters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Commit"><span class="toc-text">3. Commit</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#commit-传参"><span class="toc-text">commit 传参</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-action"><span class="toc-text">4. action</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-module"><span class="toc-text">5. module</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-state"><span class="toc-text">5.1 state</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-getters"><span class="toc-text">5.2 getters</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-mutations"><span class="toc-text">5.3 mutations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-actions"><span class="toc-text">5.5 actions</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Vuex-的响应式"><span class="toc-text">6. Vuex 的响应式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-类型常量"><span class="toc-text">7. 类型常量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-项目结构"><span class="toc-text">8. 项目结构</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/search.js"></script><script src="/js/post-except.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script></body></html><!-- rebuild by neat -->