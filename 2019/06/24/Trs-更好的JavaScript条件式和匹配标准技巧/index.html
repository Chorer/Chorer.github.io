<!-- build time:Sun Sep 05 2021 14:32:52 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Focus on FE learning</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third%20party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third%20party/pace-theme-flash.css"><link rel="icon" href="/images/kour.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head><body><header class="header"><div class="header_top"><span class="theme"><a href="/">Chor's blog</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">首页</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">分类</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">归档</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">标签</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">关于</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a target="_blank" rel="noopener" href="https://github.com/Chorer/hexo-theme-PureBlue" class="logo">Focus on FE learning</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div><div class="blog-down"><a href="javascript:void(0);"><i class="fa fa-angle-double-down fa-2x"></i></a></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">「译」编写更好的 JavaScript 条件式和匹配条件的技巧</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-06-24&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp3.5k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp14 mins&nbsp&nbsp&nbsp</span><div class="post-tags"></div></div><div class="post-content"><blockquote><ul><li>原文地址：<a target="_blank" rel="noopener" href="https://devinduct.com/blogpost/35/tips-and-tricks-for-better-javascript-conditionals-and-match-criteria">Tips and Tricks for Better JavaScript Conditionals and Match Criteria</a></li><li>原文作者：Milos Protic</li><li>译者：Chor <span id="more"></span></li></ul></blockquote><h2 id="介绍">介绍</h2><p>如果你像我一样乐于见到整洁的代码，那么你会尽可能地减少代码中的条件语句。通常情况下，面向对象编程让我们得以避免条件式，并代之以继承和多态。我认为我们应当尽可能地遵循这些原则。</p><p>正如我在另一篇文章 <a target="_blank" rel="noopener" href="https://devinduct.com/blogpost/22/javascript-clean-code-best-practices">JavaScript 整洁代码的最佳实践</a>里提到的，你写的代码不单单是给机器看的，还是给“<strong>未来的自己</strong>”以及“<strong>其他人</strong>”看的。</p><p>从另一方面来说，由于各式各样的原因，可能我们的代码最终还是会有条件式。也许是修复 bug 的时间很紧，也许是不使用条件语句会对我们的代码库造成大的改动，等等。本文将会解决这些问题，同时帮助你组织所用的条件语句。</p><h2 id="技巧">技巧</h2><p>以下是关于如何构造 <code>if...else</code> 语句以及如何用更少的代码实现更多功能的技巧。阅读愉快！</p><h3 id="要事第一小细节但很重要">1. 要事第一。小细节，但很重要</h3><p>不要使用否定条件式（这可能会让人感到疑惑）。同时，使用条件式简写来表示 <code>boolean</code> 值。这个无须再强调了，尤其是否定条件式，这不符合正常的思维方式。</p><p>不好的：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> isEmailNotVerified <span class="op">=</span> (email) <span class="op">=&gt;</span> <span class="op">&#123;</span>
    <span class="co">// 实现</span>
<span class="op">&#125;</span>

<span class="cf">if</span> (<span class="op">!</span><span class="at">isEmailNotVerified</span>(email)) <span class="op">&#123;</span>
    <span class="co">// 做一些事...</span>
<span class="op">&#125;</span>

<span class="cf">if</span> (isVerified <span class="op">===</span> <span class="kw">true</span>) <span class="op">&#123;</span>
    <span class="co">// 做一些事...</span>
<span class="op">&#125;</span></code></pre></div><p>好的：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> isEmailVerified <span class="op">=</span> (email) <span class="op">=&gt;</span> <span class="op">&#123;</span>
    <span class="co">// 实现</span>
<span class="op">&#125;</span>

<span class="cf">if</span> (<span class="at">isEmailVerified</span>(email)) <span class="op">&#123;</span>
    <span class="co">// 做一些事...</span>
<span class="op">&#125;</span>

<span class="cf">if</span> (isVerified) <span class="op">&#123;</span>
    <span class="co">// 做一些事...</span>
<span class="op">&#125;</span></code></pre></div><p>现在，理清了上面的事情后，我们就可以开始了。</p><h3 id="对于多个条件使用-array.includes">2. 对于多个条件，使用 <code>Array.includes</code></h3><p>假设我们想要在函数中检查汽车模型是 <code>renault</code> 还是 <code>peugeot</code>。那么代码可能是这样的：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> checkCarModel <span class="op">=</span> (model) <span class="op">=&gt;</span> <span class="op">&#123;</span>
    <span class="cf">if</span>(model <span class="op">===</span> <span class="st">&#39;renault&#39;</span> <span class="op">||</span> model <span class="op">===</span> <span class="st">&#39;peugeot&#39;</span>) <span class="op">&#123;</span> 
    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;model valid&#39;</span>)<span class="op">;</span>
    <span class="op">&#125;</span>
<span class="op">&#125;</span>

<span class="at">checkCarModel</span>(<span class="st">&#39;renault&#39;</span>)<span class="op">;</span> <span class="co">// 输出 &#39;model valid&#39;</span></code></pre></div><p>考虑到我们只有两个模型，这么做似乎也还能接受，但如果我们还想要检查另一个或者是几个模型呢？如果我们增加更多 <code>or</code> 语句，那么代码将变得难以维护，且不够整洁。为了让它更加简洁，我们可以像这样重写函数：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> checkCarModel <span class="op">=</span> (model) <span class="op">=&gt;</span> <span class="op">&#123;</span>
    <span class="cf">if</span>([<span class="st">&#39;peugeot&#39;</span><span class="op">,</span> <span class="st">&#39;renault&#39;</span>].<span class="at">includes</span>(model)) <span class="op">&#123;</span> 
    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;model valid&#39;</span>)<span class="op">;</span>
    <span class="op">&#125;</span>
<span class="op">&#125;</span>

<span class="at">checkCarModel</span>(<span class="st">&#39;renault&#39;</span>)<span class="op">;</span> <span class="co">// 输出 &#39;model valid&#39;</span></code></pre></div><p>上面的代码看起来已经很漂亮了。为了更进一步改善它，我们可以创建一个变量来存放汽车模型：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> checkCarModel <span class="op">=</span> (model) <span class="op">=&gt;</span> <span class="op">&#123;</span>
    <span class="kw">const</span> models <span class="op">=</span> [<span class="st">&#39;peugeot&#39;</span><span class="op">,</span> <span class="st">&#39;renault&#39;</span>]<span class="op">;</span>

    <span class="cf">if</span>(<span class="va">models</span>.<span class="at">includes</span>(model)) <span class="op">&#123;</span> 
    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;model valid&#39;</span>)<span class="op">;</span>
    <span class="op">&#125;</span>
<span class="op">&#125;</span>

<span class="at">checkCarModel</span>(<span class="st">&#39;renault&#39;</span>)<span class="op">;</span> <span class="co">// 输出 &#39;model valid&#39;</span></code></pre></div><p>现在，如果我们想要检查更多模型，只需要添加一个新的数组元素即可。此外，如果它很重要的话，我们还可以将 <code>models</code> 变量定义在函数作用域外，并在需要的地方重用。这种方式可以让我们集中管理，并使维护变得轻而易举，因为我们只需在代码中更改一个位置。</p><h3 id="匹配所有条件使用-array.every-或者-array.find">3. 匹配所有条件，使用 <code>Array.every</code> 或者 <code>Array.find</code></h3><p>在本例中，我们想要检查每个汽车模型是否都是传入函数的那一个。为了以更加命令式的方式实现，我们会这么做：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> cars <span class="op">=</span> [
  <span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;renault&#39;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1956</span> <span class="op">&#125;,</span>
  <span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;peugeot&#39;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1968</span> <span class="op">&#125;,</span>
  <span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;ford&#39;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1977</span> <span class="op">&#125;</span>
]<span class="op">;</span>

<span class="kw">const</span> checkEveryModel <span class="op">=</span> (model) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="kw">let</span> isValid <span class="op">=</span> <span class="kw">true</span><span class="op">;</span>

  <span class="cf">for</span> (<span class="kw">let</span> car of cars) <span class="op">&#123;</span>
    <span class="cf">if</span> (<span class="op">!</span>isValid) <span class="op">&#123;</span>
      <span class="cf">break</span><span class="op">;</span>
    <span class="op">&#125;</span>
    isValid <span class="op">=</span> <span class="va">car</span>.<span class="at">model</span> <span class="op">===</span> model<span class="op">;</span>
  <span class="op">&#125;</span>

  <span class="cf">return</span> isValid<span class="op">;</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkEveryModel</span>(<span class="st">&#39;renault&#39;</span>))<span class="op">;</span> <span class="co">// 输出 false</span></code></pre></div><p>如果你更喜欢以命令式的风格行事，上面的代码或许还不错。另一方面，如果你不关心其背后发生了什么，那么你可以重写上面的函数并使用 <code>Array.every</code> 或者 <code>Array.find</code> 来达到相同的结果。</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> checkEveryModel <span class="op">=</span> (model) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="cf">return</span> <span class="va">cars</span>.<span class="at">every</span>(car <span class="op">=&gt;</span> <span class="va">car</span>.<span class="at">model</span> <span class="op">===</span> model)<span class="op">;</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkEveryModel</span>(<span class="st">&#39;renault&#39;</span>))<span class="op">;</span> <span class="co">// 输出 false</span></code></pre></div><p>通过使用 <code>Array.find</code> 并做轻微的调整，我们可以达到相同的结果。两者的表现是一致的，因为两个函数都为数组中的每一个元素执行了回调，并且在找到一个 <strong>falsy</strong> 项时立即返回 <code>false</code>。</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> checkEveryModel <span class="op">=</span> (model) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="cf">return</span> <span class="va">cars</span>.<span class="at">find</span>(car <span class="op">=&gt;</span> <span class="va">car</span>.<span class="at">model</span> <span class="op">!==</span> model) <span class="op">===</span> <span class="kw">undefined</span><span class="op">;</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkEveryModel</span>(<span class="st">&#39;renault&#39;</span>))<span class="op">;</span> <span class="co">// 输出 false</span></code></pre></div><h3 id="匹配部分条件使用-array.some">4. 匹配部分条件，使用 <code>Array.some</code></h3><p><code>Array.every</code> 匹配所有条件， <code>Array.some</code> 则可以轻松地检查我们的数组是否包含某一个或某几个元素。为此，我们需要提供一个回调并基于条件返回一个布尔值。</p><p>我们可以通过编写一个类似的 <code>for...loop</code> 语句来实现相同的结果，就像之前写的一样。但幸运的是，有很酷的 JavaScript 函数可以来帮助我们完成这件事。</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> cars <span class="op">=</span> [
  <span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;renault&#39;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1956</span> <span class="op">&#125;,</span>
  <span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;peugeot&#39;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1968</span> <span class="op">&#125;,</span>
  <span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;ford&#39;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1977</span> <span class="op">&#125;</span>
]<span class="op">;</span>

<span class="kw">const</span> checkForAnyModel <span class="op">=</span> (model) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="cf">return</span> <span class="va">cars</span>.<span class="at">some</span>(car <span class="op">=&gt;</span> <span class="va">car</span>.<span class="at">model</span> <span class="op">===</span> model)<span class="op">;</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkForAnyModel</span>(<span class="st">&#39;renault&#39;</span>))<span class="op">;</span> <span class="co">// 输出 true</span></code></pre></div><h3 id="提前返回而不是使用-if...else-分支">5. 提前返回而不是使用 <code>if...else</code> 分支</h3><p>当我还是学生的时候，就有人教过我：一个函数应该只有一个返回语句，并且只从一个地方返回。如果细心处理，这个方法倒也还好。我这么说也就意味着，我们应该意识到它在某些情况下可能会引起条件式嵌套地狱。如果不受控制，多个分支和 <code>if...else</code> 嵌套将会让我们感到很痛苦。</p><p>另一方面，如果代码库很大且包含很多行代码，位于深层的一个返回语句可能会带来问题。现在我们都实行关注点分离和 SOLID 原则，因此，代码行过多这种情况挺罕见的。</p><p>举例来解释这个问题。假设我们想要显示所给车辆的模型和生产年份：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> checkModel <span class="op">=</span> (car) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="kw">let</span> result<span class="op">;</span> <span class="co">// 首先，定义一个 result 变量</span>
  
  <span class="co">// 检查是否有车</span>
  <span class="cf">if</span>(car) <span class="op">&#123;</span>

    <span class="co">// 检查是否有车的模型</span>
    <span class="cf">if</span> (<span class="va">car</span>.<span class="at">model</span>) <span class="op">&#123;</span>

      <span class="co">// 检查是否有车的年份</span>
      <span class="cf">if</span>(<span class="va">car</span>.<span class="at">year</span>) <span class="op">&#123;</span>
        result <span class="op">=</span> <span class="vs">`Car model: </span><span class="sc">$&#123;</span><span class="va">car</span>.<span class="at">model</span><span class="sc">&#125;</span><span class="vs">; Manufacturing year: </span><span class="sc">$&#123;</span><span class="va">car</span>.<span class="at">year</span><span class="sc">&#125;</span><span class="vs">;`</span><span class="op">;</span>
      <span class="op">&#125;</span> <span class="cf">else</span> <span class="op">&#123;</span>
        result <span class="op">=</span> <span class="st">&#39;No car year&#39;</span><span class="op">;</span>
      <span class="op">&#125;</span>
    
    <span class="op">&#125;</span> <span class="cf">else</span> <span class="op">&#123;</span>
      result <span class="op">=</span> <span class="st">&#39;No car model&#39;</span>
    <span class="op">&#125;</span>   

  <span class="op">&#125;</span> <span class="cf">else</span> <span class="op">&#123;</span>
    result <span class="op">=</span> <span class="st">&#39;No car&#39;</span><span class="op">;</span>
  <span class="op">&#125;</span>

  <span class="cf">return</span> result<span class="op">;</span> <span class="co">// 我们的单独的返回语句</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkModel</span>())<span class="op">;</span> <span class="co">// 输出 &#39;No car&#39;</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkModel</span>(<span class="op">&#123;</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1988</span> <span class="op">&#125;</span>))<span class="op">;</span> <span class="co">// 输出 &#39;No car model&#39;</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkModel</span>(<span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;ford&#39;</span> <span class="op">&#125;</span>))<span class="op">;</span> <span class="co">// 输出 &#39;No car year&#39;</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkModel</span>(<span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;ford&#39;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1988</span> <span class="op">&#125;</span>))<span class="op">;</span> <span class="co">// 输出 &#39;Car model: ford; Manufacturing year: 1988;&#39;</span></code></pre></div><p>正如你所看到的，即使本例的问题很简单，上面的代码也实在太长了。可以想象一下，如果我们有更加复杂的逻辑会发生什么事。大量的 <code>if...else</code> 语句。</p><p>我们可以重构上面的函数，分解成多个步骤并稍做改善。例如，使用三元操作符，包括 <code>&amp;&amp;</code> 条件式等。不过，这里我直接跳到最后，向你展示借助现代 JavaScript 特性和多个返回语句，代码可以有多简洁。</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> checkModel <span class="op">=</span> (<span class="op">&#123;</span>model<span class="op">,</span> year<span class="op">&#125;</span> <span class="op">=</span> <span class="op">&#123;&#125;</span>) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="cf">if</span>(<span class="op">!</span>model <span class="op">&amp;&amp;</span> <span class="op">!</span>year) <span class="cf">return</span> <span class="st">&#39;No car&#39;</span><span class="op">;</span>
  <span class="cf">if</span>(<span class="op">!</span>model) <span class="cf">return</span> <span class="st">&#39;No car model&#39;</span><span class="op">;</span>
  <span class="cf">if</span>(<span class="op">!</span>year) <span class="cf">return</span> <span class="st">&#39;No car year&#39;</span><span class="op">;</span>

  <span class="co">// 这里可以任意操作模型或年份</span>
  <span class="co">// 确保它们存在</span>
  <span class="co">// 无需更多检查</span>

  <span class="co">// doSomething(model);</span>
  <span class="co">// doSomethingElse(year);</span>
  
  <span class="cf">return</span> <span class="vs">`Car model: </span><span class="sc">$&#123;</span>model<span class="sc">&#125;</span><span class="vs">; Manufacturing year: </span><span class="sc">$&#123;</span>year<span class="sc">&#125;</span><span class="vs">;`</span><span class="op">;</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkModel</span>())<span class="op">;</span> <span class="co">// 输出 &#39;No car&#39;</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkModel</span>(<span class="op">&#123;</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1988</span> <span class="op">&#125;</span>))<span class="op">;</span> <span class="co">// 输出 &#39;No car model&#39;</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkModel</span>(<span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;ford&#39;</span> <span class="op">&#125;</span>))<span class="op">;</span> <span class="co">// 输出 &#39;No car year&#39;</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">checkModel</span>(<span class="op">&#123;</span> <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;ford&#39;</span><span class="op">,</span> <span class="dt">year</span><span class="op">:</span> <span class="dv">1988</span> <span class="op">&#125;</span>))<span class="op">;</span> <span class="co">// 输出 &#39;Car model: ford; Manufacturing year: 1988;&#39;</span></code></pre></div><p>在重构版本中，我们包含了解构和默认参数。默认参数确保我们在传入 <code>undefined</code> 时有可用于解构的值。注意，如果传入 <code>null</code> ，函数将会抛出错误。这也是之前那个方法的优点所在，因为那个方法在传入 <code>null</code> 的时候会输出 <code>'No car'</code>。</p><p>对象解构确保函数只取所需。例如，如果我们在给定车辆对象中包含额外属性，则该属性在我们的函数中是无法获取的。</p><p>根据偏好，开发者会选择其中一种方式。实践中，编写的代码通常介于两者之间。很多人觉得 <code>if...else</code> 语句更容易理解，并且有助于他们更为轻松地遵循程序流程。</p><h3 id="使用索引或者映射而不是-switch-语句">6. 使用索引或者映射，而不是 <code>switch</code> 语句</h3><p>假设我们想要基于给定的国家获取汽车模型。</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> getCarsByState <span class="op">=</span> (state) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="cf">switch</span> (state) <span class="op">&#123;</span>
    <span class="cf">case</span> <span class="st">&#39;usa&#39;</span><span class="op">:</span>
      <span class="cf">return</span> [<span class="st">&#39;Ford&#39;</span><span class="op">,</span> <span class="st">&#39;Dodge&#39;</span>]<span class="op">;</span>
    <span class="cf">case</span> <span class="st">&#39;france&#39;</span><span class="op">:</span>
      <span class="cf">return</span> [<span class="st">&#39;Renault&#39;</span><span class="op">,</span> <span class="st">&#39;Peugeot&#39;</span>]<span class="op">;</span>
    <span class="cf">case</span> <span class="st">&#39;italy&#39;</span><span class="op">:</span>
      <span class="cf">return</span> [<span class="st">&#39;Fiat&#39;</span>]<span class="op">;</span>
    <span class="dt">default</span><span class="op">:</span>
      <span class="cf">return</span> []<span class="op">;</span>
  <span class="op">&#125;</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>())<span class="op">;</span> <span class="co">// 输出 []</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>(<span class="st">&#39;usa&#39;</span>))<span class="op">;</span> <span class="co">// 输出 [&#39;Ford&#39;, &#39;Dodge&#39;]</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>(<span class="st">&#39;italy&#39;</span>))<span class="op">;</span> <span class="co">// 输出 [&#39;Fiat&#39;]</span></code></pre></div><p>上诉代码可以重构，完全去除 <code>switch</code> 语句。</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> cars <span class="op">=</span> <span class="kw">new</span> <span class="at">Map</span>()
  .<span class="at">set</span>(<span class="st">&#39;usa&#39;</span><span class="op">,</span> [<span class="st">&#39;Ford&#39;</span><span class="op">,</span> <span class="st">&#39;Dodge&#39;</span>])
  .<span class="at">set</span>(<span class="st">&#39;france&#39;</span><span class="op">,</span> [<span class="st">&#39;Renault&#39;</span><span class="op">,</span> <span class="st">&#39;Peugeot&#39;</span>])
  .<span class="at">set</span>(<span class="st">&#39;italy&#39;</span><span class="op">,</span> [<span class="st">&#39;Fiat&#39;</span>])<span class="op">;</span>

<span class="kw">const</span> getCarsByState <span class="op">=</span> (state) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="cf">return</span> <span class="va">cars</span>.<span class="at">get</span>(state) <span class="op">||</span> []<span class="op">;</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>())<span class="op">;</span> <span class="co">// 输出 []</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>(<span class="st">&#39;usa&#39;</span>))<span class="op">;</span> <span class="co">//输出 [&#39;Ford&#39;, &#39;Dodge&#39;]</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>(<span class="st">&#39;italy&#39;</span>))<span class="op">;</span> <span class="co">// 输出 [&#39;Fiat&#39;]</span></code></pre></div><p>或者，我们还可以为包含可用汽车列表的每个国家创建一个类，并在需要的时候使用。不过这个就是题外话了，本文的主题是关于条件句的。更恰当的修改是使用对象字面量。</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> carState <span class="op">=</span> <span class="op">&#123;</span>
  <span class="dt">usa</span><span class="op">:</span> [<span class="st">&#39;Ford&#39;</span><span class="op">,</span> <span class="st">&#39;Dodge&#39;</span>]<span class="op">,</span>
  <span class="dt">france</span><span class="op">:</span> [<span class="st">&#39;Renault&#39;</span><span class="op">,</span> <span class="st">&#39;Peugeot&#39;</span>]<span class="op">,</span>
  <span class="dt">italy</span><span class="op">:</span> [<span class="st">&#39;Fiat&#39;</span>]
<span class="op">&#125;;</span>

<span class="kw">const</span> getCarsByState <span class="op">=</span> (state) <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="cf">return</span> carState[state] <span class="op">||</span> []<span class="op">;</span>
<span class="op">&#125;</span>

<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>())<span class="op">;</span> <span class="co">// 输出 []</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>(<span class="st">&#39;usa&#39;</span>))<span class="op">;</span> <span class="co">// 输出 [&#39;Ford&#39;, &#39;Dodge&#39;]</span>
<span class="va">console</span>.<span class="at">log</span>(<span class="at">getCarsByState</span>(<span class="st">&#39;france&#39;</span>))<span class="op">;</span> <span class="co">// 输出 [&#39;Renault&#39;, &#39;Peugeot&#39;]</span></code></pre></div><h3 id="使用自判断链接optional-chaining和空合并nullish-coalescing">7. 使用自判断链接（optional-chaining）和空合并（nullish-coalescing）</h3><p>到了这一小节，我终于可以说“<strong>最后</strong>”了。在我看来，这两个功能对于 JavaScript 语言来说是非常有用的。作为一个来自 C# 世界的人，可以说我经常使用它们。</p><p>在写这篇文章的时候，这些还没有得到完全的支持。因此，对于以这种方式编写的代码，你需要使用 Babel 进行编译。你可以在<a target="_blank" rel="noopener" href="https://github.com/tc39/proposal-optional-chaining">自判断链接</a>这里以及在<a target="_blank" rel="noopener" href="https://github.com/tc39/proposal-nullish-coalescing">空合并</a>这里查阅。</p><p>自判断链接允许我们在没有显式检查中间节点是否存在的时候处理树形结构，空合并可以确保节点不存在时会有一个默认值，配合自判断链接使用会有不错的效果。</p><p>让我们用一些例子来支撑上面的结论。一开始，我们还是用以前的老方法：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> car <span class="op">=</span> <span class="op">&#123;</span>
  <span class="dt">model</span><span class="op">:</span> <span class="st">&#39;Fiesta&#39;</span><span class="op">,</span>
  <span class="dt">manufacturer</span><span class="op">:</span> <span class="op">&#123;</span>
    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Ford&#39;</span><span class="op">,</span>
    <span class="dt">address</span><span class="op">:</span> <span class="op">&#123;</span>
      <span class="dt">street</span><span class="op">:</span> <span class="st">&#39;Some Street Name&#39;</span><span class="op">,</span>
      <span class="dt">number</span><span class="op">:</span> <span class="st">&#39;5555&#39;</span><span class="op">,</span>
      <span class="dt">state</span><span class="op">:</span> <span class="st">&#39;USA&#39;</span>
    <span class="op">&#125;</span>
  <span class="op">&#125;</span>
<span class="op">&#125;</span>

<span class="co">// 获取汽车模型</span>
<span class="kw">const</span> model <span class="op">=</span> car <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="at">model</span> <span class="op">||</span> <span class="st">&#39;default model&#39;</span><span class="op">;</span>
<span class="co">// 获取厂商地址</span>
<span class="kw">const</span> street <span class="op">=</span> car <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="at">manufacturer</span> <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="va">manufacturer</span>.<span class="at">address</span> <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="va">manufacturer</span>.<span class="va">address</span>.<span class="at">street</span> <span class="op">||</span> <span class="st">&#39;default street&#39;</span><span class="op">;</span>
<span class="co">// 请求一个不存在的属性</span>
<span class="kw">const</span> phoneNumber <span class="op">=</span> car <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="at">manufacturer</span> <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="va">manufacturer</span>.<span class="at">address</span> <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="va">manufacturer</span>.<span class="at">phoneNumber</span><span class="op">;</span>

<span class="va">console</span>.<span class="at">log</span>(model) <span class="co">// 输出 &#39;Fiesta&#39;</span>
<span class="va">console</span>.<span class="at">log</span>(street) <span class="co">// 输出 &#39;Some Street Name&#39;</span>
<span class="va">console</span>.<span class="at">log</span>(phoneNumber) <span class="co">// 输出 undefined</span></code></pre></div><p>因此，如果我们想要知道厂商是否来自 USA 并将结果打印，那么代码是这样的：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> checkCarManufacturerState <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="cf">if</span>(car <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="at">manufacturer</span> <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="va">manufacturer</span>.<span class="at">address</span> <span class="op">&amp;&amp;</span> <span class="va">car</span>.<span class="va">manufacturer</span>.<span class="va">address</span>.<span class="at">state</span> <span class="op">===</span> <span class="st">&#39;USA&#39;</span>) <span class="op">&#123;</span>
    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Is from USA&#39;</span>)<span class="op">;</span>
  <span class="op">&#125;</span>
<span class="op">&#125;</span>

<span class="at">checkCarManufacturerState</span>() <span class="co">// 输出 &#39;Is from USA&#39;</span></code></pre></div><p>我无需再赘述如果对象结构更加复杂的话，代码会多么混乱了。许多库，例如 lodash，有自己的函数作为替代方案。不过这不是我们想要的，我们想要的是在原生 js 中也能做同样的事。我们来看一下新的方法：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript">    <span class="co">// 获取汽车模型</span>
    <span class="kw">const</span> model <span class="op">=</span> car<span class="op">?</span>.<span class="at">model</span> <span class="op">??</span> <span class="st">&#39;default model&#39;</span><span class="op">;</span>
    <span class="co">// 获取厂商地址</span>
    <span class="kw">const</span> street <span class="op">=</span> car<span class="op">?</span>.<span class="at">manufacturer</span><span class="op">?</span>.<span class="at">address</span><span class="op">?</span>.<span class="at">street</span> <span class="op">??</span> <span class="st">&#39;default street&#39;</span><span class="op">;</span>
    
    <span class="co">// 检查汽车厂商是否来自 USA</span>
    <span class="kw">const</span> checkCarManufacturerState <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">&#123;</span>
      <span class="cf">if</span>(car<span class="op">?</span>.<span class="at">manufacturer</span><span class="op">?</span>.<span class="at">address</span><span class="op">?</span>.<span class="at">state</span> <span class="op">===</span> <span class="st">&#39;USA&#39;</span>) <span class="op">&#123;</span>
        <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Is from USA&#39;</span>)<span class="op">;</span>
      <span class="op">&#125;</span>
    &#125;</code></pre></div><p>这看起来更加漂亮和简洁，对我来说，非常符合逻辑。如果你想知道为什么应该使用 <code>??</code> 而不是 <code>||</code> ，只需想一想什么值会被当做 <code>true</code> 或者 <code>false</code> 从而得到意料之外的输出。</p><p>顺便说句题外话。自判断链接同样支持 DOM API，这非常酷，意味着你可以这么做：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> value <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;input#user-name&#39;</span>)<span class="op">?</span>.<span class="at">value</span><span class="op">;</span></code></pre></div><h2 id="结论">结论</h2><p>好了，这就是全部内容了。如果你喜欢这篇文章的话，可以<a target="_blank" rel="noopener" href="https://ko-fi.com/milosprotic">送一杯咖啡给我</a>，让我提提神，还可以订阅文章或者在 <a target="_blank" rel="noopener" href="https://twitter.com/protic_milos">twitter</a> 上关注我。</p><p>感谢阅读，下篇文章见。</p><hr><p>译者注： 关于最后一个例子的空合并为什么使用 <code>??</code> 而不是 <code>||</code>，作者可能解释得不是很清楚，这里摘抄一下 <a target="_blank" rel="noopener" href="https://github.com/tc39/proposal-nullish-coalescing">tc39:proposal-nullish-coalescing</a> 的例子：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> headerText <span class="op">=</span> <span class="va">response</span>.<span class="at">settings</span><span class="op">?</span>.<span class="at">headerText</span> <span class="op">||</span> <span class="st">&#39;Hello, world!&#39;</span><span class="op">;</span> <span class="co">// &#39;&#39; 会被当作 false，输出： &#39;Hello, world!&#39;</span>
<span class="kw">const</span> animationDuration <span class="op">=</span> <span class="va">response</span>.<span class="at">settings</span><span class="op">?</span>.<span class="at">animationDuration</span> <span class="op">||</span> <span class="dv">300</span><span class="op">;</span> <span class="co">// 0 会被当作 false，输出： 300</span>
<span class="kw">const</span> showSplashScreen <span class="op">=</span> <span class="va">response</span>.<span class="at">settings</span><span class="op">?</span>.<span class="at">showSplashScreen</span> <span class="op">||</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// False 会被当作 false，输出： true</span></code></pre></div><p>照理来说，使用 <code>||</code> 是可以的，但是在上面代码中会有点小问题。比如我们想要获取的 animationDuration 的值为 0，那么由于 0 被当作 false，导致我们最后得到的是默认值 300，这显然不是我们想要的结果。而 <code>??</code> 就是用来解决这个问题的。 目前 optional-chaining 和 nullish-coalescing 还在 ecma 标准草案的 stage2 阶段，不过 babel 针对前者已有相关插件实现，更多相关文章可以看： https://segmentfault.com/a/1190000013409955 https://zhuanlan.zhihu.com/p/29296692 https://www.npmjs.com/package/babel-plugin-transform-optional-chaining</p></div><div class="post-nav"><div class="post-nav-prev"><a href="/2019/06/30/T-%E5%85%B3%E4%BA%8E%E5%A4%A7%E4%B8%80%E4%B8%8B%E7%9A%84%E6%80%BB%E7%BB%93/" rel="prev" title="关于大一下的总结"><i class="fa fa-angle-double-left"></i>&nbsp关于大一下的总结</a></div><div class="post-nav-next"><a href="/2019/06/18/Trs-%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%20CSS%20%E9%97%AE%E9%A2%98/" rel="next" title="「译」前端项目中常见的 CSS 问题">「译」前端项目中常见的 CSS 问题&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7"><span class="toc-text">技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A6%81%E4%BA%8B%E7%AC%AC%E4%B8%80%E5%B0%8F%E7%BB%86%E8%8A%82%E4%BD%86%E5%BE%88%E9%87%8D%E8%A6%81"><span class="toc-text">1. 要事第一。小细节，但很重要</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E5%A4%9A%E4%B8%AA%E6%9D%A1%E4%BB%B6%E4%BD%BF%E7%94%A8-array.includes"><span class="toc-text">2. 对于多个条件，使用 Array.includes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E6%89%80%E6%9C%89%E6%9D%A1%E4%BB%B6%E4%BD%BF%E7%94%A8-array.every-%E6%88%96%E8%80%85-array.find"><span class="toc-text">3. 匹配所有条件，使用 Array.every 或者 Array.find</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E9%83%A8%E5%88%86%E6%9D%A1%E4%BB%B6%E4%BD%BF%E7%94%A8-array.some"><span class="toc-text">4. 匹配部分条件，使用 Array.some</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E5%89%8D%E8%BF%94%E5%9B%9E%E8%80%8C%E4%B8%8D%E6%98%AF%E4%BD%BF%E7%94%A8-if...else-%E5%88%86%E6%94%AF"><span class="toc-text">5. 提前返回而不是使用 if...else 分支</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E6%88%96%E8%80%85%E6%98%A0%E5%B0%84%E8%80%8C%E4%B8%8D%E6%98%AF-switch-%E8%AF%AD%E5%8F%A5"><span class="toc-text">6. 使用索引或者映射，而不是 switch 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%88%A4%E6%96%AD%E9%93%BE%E6%8E%A5optional-chaining%E5%92%8C%E7%A9%BA%E5%90%88%E5%B9%B6nullish-coalescing"><span class="toc-text">7. 使用自判断链接（optional-chaining）和空合并（nullish-coalescing）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-text">结论</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"retro",pageSize:10,visitor:!0})</script></section></main><script>var user=[1,2,3,4]</script><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - <span>2021</span> My Blog</p><p class="a">Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a target="_blank" rel="noopener" href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/search.js"></script><script src="/js/post-except.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script></body></html><!-- rebuild by neat -->