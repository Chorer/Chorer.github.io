<!-- build time:Fri Feb 21 2020 15:14:40 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Focus on FE learning</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third party/pace-theme-flash.css"><link rel="icon" href="/images/kour.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script><script src="/js/prism-line-numbers.min.js"></script><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head><body><header class="header"><div class="header_top"><span class="theme"><a href="/">Chor's blog</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">首页</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">分类</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">归档</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">标签</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">关于</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a href="https://github.com/Chorer/hexo-theme-PureBlue" class="logo">Focus on FE learning</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div><div class="blog-down"><a href="javascript:void(0);"><i class="fa fa-angle-double-down fa-2x"></i></a></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">Webpack（三）：使用 plugin 以及本地服务器搭建</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-10-22&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp1.7k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp6 mins&nbsp&nbsp&nbsp</span><div class="post-tags"></div></div><div class="post-content"><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Webpack%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA-0-1.png" alt=""></p><a id="more"></a><h2 id="使用-Plugin"><a href="#使用-Plugin" class="headerlink" title="使用 Plugin"></a>使用 Plugin</h2><h3 id="banner-plugin"><a href="#banner-plugin" class="headerlink" title="banner-plugin"></a>banner-plugin</h3><p>webpack 自带 BannerPlugin，我们只需要在 <code>webpack.config.js</code> 中配置即可：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//引入</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span><span class="token operator">...</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    resolve<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>BannerPlugin</span><span class="token punctuation">(</span><span class="token string">'Created by xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="headerlink" title="html-webpack-plugin"></a>html-webpack-plugin</h3><p>之前我们的 <code>index.html</code> 都是在项目的根目录下的，这个文件最后也要打包到 <code>dist</code> 文件夹中。</p><p>HtmlWebpackPlugin 可以自动生成一个 已经引入<code>bundle.js</code> 的<code>index.html</code> 到 <code>dist</code> 文件夹中。</p><pre class="line-numbers language-cmd"><code class="language-cmd">npm install html-webpack-plugin --save -dev
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>不过这个生成的文件默认是没有模板的（只有引入的 js），所以我们要配置一下：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 引入</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span><span class="token operator">...</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    modules<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    resolve<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token punctuation">:</span><span class="token string">'./index.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这之后，webpack 将会去 <code>webpack.config.js</code> 所在的文件夹寻找 <code>index.html</code>文件（最初的入口文件），并将其 html 结构作为新 <code>index.html</code> 的模板。也就是说，最初的入口文件仅提供一个模板。</p><p><strong>Note</strong>：</p><p>另外还要注意，前面我们说过，webpack 认为 <code>index.html</code> 位于 <code>dist</code> 中，所以导致了路径出错，我们是通过配置 <code>output.publicPath</code> 或者 <code>url-loader.options.publicPath</code> 来修正这个问题的。但是现在 <code>index.html</code> 确实位于 <code>dist</code> 中了，所以我们也可以把这两个配置改回来了。</p><h3 id="uglifyjs-webpack-plugin"><a href="#uglifyjs-webpack-plugin" class="headerlink" title="uglifyjs-webpack-plugin"></a>uglifyjs-webpack-plugin</h3><p>压缩 js 文件：</p><pre class="line-numbers language-cmd"><code class="language-cmd">npm install uglifyjs-webpack-plugin@1 --save -dev
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>进行配置：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> UglifyjsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglifyjs-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//引入</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span><span class="token operator">...</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    modules<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    resolve<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">UglifyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里又因为版本不匹配的问题报错了，原因是 webpack@3 对应的 plugin 版本是 @1，所以如果 npm 安装的时候不指定版本，默认会安装最新的 @2 版本，后面打包就会报错了。</p><h2 id="Webapck-搭建本地服务器"><a href="#Webapck-搭建本地服务器" class="headerlink" title="Webapck 搭建本地服务器"></a>Webapck 搭建本地服务器</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>Webpack 提供了一个可选的本地开发服务器，基于 node.js 搭建，内部使用 express 框架，可以实现热更新。</p><p>文件暂缓到内存中，内存中读取速度要比磁盘快很多，之后执行打包命令的时候才输出到磁盘。</p><p>首先安装一下：</p><pre class="line-numbers language-cmd"><code class="language-cmd">npm install webpack-dev-server@2.9.3 --save -dev
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Note：这里也要注意和 webpack 的版本对应。</p><p>之后配置一下：</p><pre class="line-numbers language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span><span class="token operator">...</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    modules<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    resolve<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>
           contentBase<span class="token punctuation">:</span><span class="token string">'./dist'</span> <span class="token comment" spellcheck="true">// 为哪个文件夹提供本地服务</span>
        inline<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 开启热更新</span>
        port<span class="token punctuation">:</span>  <span class="token number">8080</span>           <span class="token comment" spellcheck="true">// 默认8080端口号</span>
        open<span class="token punctuation">:</span><span class="token boolean">true</span>            <span class="token comment" spellcheck="true">// 开启服务器后自动打开浏览器</span>
        historyApiFallback<span class="token punctuation">:</span><span class="token operator">...</span>    <span class="token comment" spellcheck="true">// 在 SPA 页面中依赖 HTML5 的 history 模式     </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="处理报错"><a href="#处理报错" class="headerlink" title="处理报错"></a>处理报错</h3><p>这时候直接运行 <code>webpack-dev-server</code> ，会报错：</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Webpack%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA-1.png" alt=""></p><p>这里的操作，其实是试图在项目根目录下执行 <code>webpack-dev-server.cmd</code>，但当前目录并没有这个这个东西，所以报错了。这时候可能会有如下思路：</p><p><strong>（1）</strong></p><p>首先，<code>webpack-dev-server.cmd</code> 其实就位于 <code>node_modules/.bin</code> 文件夹中，我可以选择直接执行 <code>node_modules/.bin/webpack-dev-server</code> 或者是 cd 进目录后执行，如下图：</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Webpack%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA-2-1.jpg" alt=""></p><p>这个思路应该是没问题的，但是我实际这么做的时候报错了：</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Webpack%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA-3.png" alt=""></p><p>经过苦苦思索。。。好吧，犯了一个很傻逼的错误：</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/Webpack%EF%BC%88%E4%B8%89%EF%BC%89%EF%BC%9A%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/%E4%BD%BF%E7%94%A8%20plugin%20%E4%BB%A5%E5%8F%8A%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA-4.png" alt=""></p><p>注意看上图！！！路径是用 <code>\</code> 而不是<code>/</code>。。。改用 <code>\</code>之后就正常了。当然，是看到这个贴子 <a href="https://www.cnblogs.com/mqfblog/p/6444753.html" target="_blank" rel="noopener">https://www.cnblogs.com/mqfblog/p/6444753.html</a> 突然想到的。</p><p><strong>（2）</strong></p><p>第二个方法，全局安装 <code>webpack-dev-server</code>。这个当然没问题了，这样的话我不管在哪个路径下运行指令，这个指令总能被找到。<strong>但是这个方法不推荐，因为有版本冲突问题</strong>。</p><p><strong>（3）</strong></p><p>第三个方法就是来到 <code>package.json</code>配置一下命令：</p><pre class="line-numbers language-json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"webpack"</span><span class="token punctuation">,</span>
    <span class="token property">"dev"</span><span class="token operator">:</span><span class="token string">"webpack-dev-server"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这之后执行 <code>npm run dev</code> ，那么 npm script 的底层其实会做一些相应处理，自动到 <code>node_modules/.bin</code> 文件夹下寻找对应的 cmd 并执行。</p><h3 id="更新缓慢"><a href="#更新缓慢" class="headerlink" title="更新缓慢"></a>更新缓慢</h3><p>开启本地服务器，修改代码之后会发现可以自动刷新了。不过。。。</p><p>我进行到这一步的时候发现刷新大概需要 4 到 5 秒，对比使用 live server 时那种即时刷新的感觉，完全不是一个量级的好吗！然后把前面安装的 <code>uglifyjs-webpack-plugin</code> 去掉就正常了，看来是被这个插件影响到了。</p><p>这里也可以发现，实际上我们是在<strong>开发完成后</strong>才需要用到这个插件去压缩代码；相反地，<code>webpack-dev-server</code>则是在<strong>开发过程中</strong>要用到，也就是说，这两个东西的使用情境是不同的。那么，有没有方法可以依照使用情境把它们进行分离呢？</p><h2 id="配置分离"><a href="#配置分离" class="headerlink" title="配置分离"></a>配置分离</h2><ul><li>抽取公共配置</li><li>分离开发环境配置和生产环境配置</li></ul><p>在我们前面安装的 plugin 里，<code>webpack-dev-server</code> 只有开发的时候用得到，<code>uglifyjs-webpack-plugin</code>只有开发后用得到，其他的则是开发/生产时都要用到的，据此，我们可以在根目录新建 <code>build</code> 文件夹，并将这些配置分别写进三种类型的文件里：</p><p><code>dev.config.js / prod.config.js / base.config.js</code></p><p>形式上分离后，我们管理起来就方便了，之后借助插件进行配置的合并：</p><pre class="line-numbers language-cmd"><code class="language-cmd">npm install webpack-merge --save -dev
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>dev.config.js</code>:</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> webpackMerge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpackMerge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> baseConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./base.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">webpackMerge</span><span class="token punctuation">(</span>baseConfig<span class="token punctuation">,</span><span class="token punctuation">{</span>
  devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>
    contentBase<span class="token punctuation">:</span><span class="token string">'./dist'</span><span class="token punctuation">,</span>
    inline<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    open<span class="token punctuation">:</span><span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>prod.config.js</code>:</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> UglifyjsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglifyjs-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackMerge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> baseConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./base.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">webpackMerge</span><span class="token punctuation">(</span>baseConfig<span class="token punctuation">,</span><span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">UglifyjsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>base.config.js</code>:</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span><span class="token operator">...</span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
       resolve<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这之后我们要解决两个问题：</p><p>首先，现在的 config 文件已经分离了，所以原先的 <code>webpack.config.js</code>可以删掉了，这里会发现删掉之后，原先配置的 npm script 指令失效了，所以来到 <code>package.json</code>配置一下：</p><pre class="line-numbers language-json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"webpack   --config ./build/base.config.js"</span><span class="token punctuation">,</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack-dev-server  --config ./build/base.config.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>加上 <code>--config ./build/base.config.js</code>，也就是现在以 <code>base.config.js</code> 这个配置文件为准。</p><p>第二个问题，如果我们直接打包，会发现在 <code>build</code> 下输出了 <code>dist</code> 文件夹，这是因为我们之前是这样配置 <code>output.path</code> 的：</p><pre class="line-numbers language-js"><code class="language-js">output<span class="token punctuation">:</span><span class="token punctuation">{</span>
    path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token punctuation">:</span><span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>之前， <code>__dirname</code> 指向 <code>webpack.config.js</code>所在的目录，即根目录，后面跟着 <code>dist</code>，意思是打包到根目录下的 <code>dist</code> 文件夹。而现在，<code>__dirname</code> 指向的是 <code>base.config.js</code>所在的目录，即 <code>build</code> 文件夹，后面跟着 <code>dist</code>，意思是打包到 <code>build</code>下的 <code>dist</code> 文件夹。</p><p>所以要修正一下路径，改为 ：</p><pre class="line-numbers language-js"><code class="language-js">output<span class="token punctuation">:</span><span class="token punctuation">{</span>
    path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'../dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token punctuation">:</span><span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>之后就可以正常打包了。当然，对于小型项目的话，一个配置文件也完全足够了。</p><blockquote><p>我的博客即将同步至腾讯云+社区，邀请大家一同入驻：<a href="https://cloud.tencent.com/developer/support-plan?invite_code=188s4s5t1gb7g" target="_blank" rel="noopener">https://cloud.tencent.com/developer/support-plan?invite_code=188s4s5t1gb7g</a></p></blockquote></div><div class="post-nav"><div class="post-nav-prev"><a href="/2019/10/26/T-《如何成为优秀的用户体验设计师》/" rel="prev" title="《如何成为优秀的用户体验设计师》"><i class="fa fa-angle-double-left"></i>&nbsp《如何成为优秀的用户体验设计师》</a></div><div class="post-nav-next"><a href="/2019/10/20/F-Webpack（二）：使用 loader/" rel="next" title="Webpack（二）：使用 loader">Webpack（二）：使用 loader&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Plugin"><span class="toc-text">使用 Plugin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#banner-plugin"><span class="toc-text">banner-plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#html-webpack-plugin"><span class="toc-text">html-webpack-plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uglifyjs-webpack-plugin"><span class="toc-text">uglifyjs-webpack-plugin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webapck-搭建本地服务器"><span class="toc-text">Webapck 搭建本地服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#处理报错"><span class="toc-text">处理报错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#更新缓慢"><span class="toc-text">更新缓慢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置分离"><span class="toc-text">配置分离</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/search.js"></script><script src="/js/post-except.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script></body></html><!-- rebuild by neat -->