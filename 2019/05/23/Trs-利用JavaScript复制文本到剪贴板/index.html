<!-- build time:Sun Sep 05 2021 16:01:26 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Focus on FE learning</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third%20party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third%20party/pace-theme-flash.css"><link rel="icon" href="/images/kour.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head><body><header class="header"><div class="header_top"><span class="theme"><a href="/">Chor's blog</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">首页</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">分类</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">归档</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">标签</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">关于</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a target="_blank" rel="noopener" href="https://github.com/Chorer/hexo-theme-PureBlue" class="logo">Focus on FE learning</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div><div class="blog-down"><a href="javascript:void(0);"><i class="fa fa-angle-double-down fa-2x"></i></a></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">「译」利用 JavaScript 复制文本到剪贴板</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-05-23&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp1k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp4 mins&nbsp&nbsp&nbsp</span><div class="post-tags"><i class="fa fa-tags"></i> <a href="/tags/30-seconds-of-code/">30 seconds of code</a></div></div><div class="post-content"><p>一个小小的诀窍。实现主题的复制代码功能时，思路刚好和这篇文章差不多，不过这篇文章的代码要更加合理。</p><blockquote><ul><li>原文地址：<a target="_blank" rel="noopener" href="https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f">Copying text to clipboard with JavaScript</a></li><li>原文作者：<a target="_blank" rel="noopener" href="https://hackernoon.com/@chalarangelo?source=post_header_lockup">Angelos Chalaris</a></li><li>译者：Chor <span id="more"></span></li></ul></blockquote><p>本文将会深入介绍 <a target="_blank" rel="noopener" href="https://github.com/Chalarangelo/30-seconds-of-code">30 秒代码</a> 中 <strong><code>copyToClipboard</code></strong> 代码块的工作原理。你可以在项目仓库中找到它的源代码以及更多其他的实用方法。</p><div class="figure"><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/%E3%80%8C%E8%AF%91%E3%80%8D%E5%88%A9%E7%94%A8%20JavaScript%20%E5%A4%8D%E5%88%B6%E6%96%87%E6%9C%AC%E5%88%B0%E5%89%AA%E8%B4%B4%E6%9D%BF/%E5%88%A9%E7%94%A8JavaScript%E5%A4%8D%E5%88%B6%E6%96%87%E6%9C%AC%E5%88%B0%E5%89%AA%E8%B4%B4%E6%9D%BF-1.png"></div><center style="font-size:14px;color:#999">30 秒代码：可以在 30 秒或更短时间内理解的 JavaScript 代码块</center><h3 id="核心功能">核心功能</h3><p><a target="_blank" rel="noopener" href="https://hackernoon.com/tagged/web-development">搭建网站</a>时经常会遇到一个需求，那就是在用户没有选中或者使用键盘组合键的情况下，复制文本到剪贴板。<a target="_blank" rel="noopener" href="https://hackernoon.com/tagged/javascript">JavaScript</a> 可以用短短五步轻松解决这个问题：</p><p>1.创建一个稍后将插入到文档中的 <code>&lt;textarea&gt;</code> 元素。将我们想要复制到剪贴板的字符串设置为它的 <code>value</code> 。 2.将上诉 <code>&lt;textarea&gt;</code> 元素插入到当前的 HTML 文档中。 3.使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/select"><code>HTMLInputElement.select()</code></a> 选中 <code>&lt;textarea&gt;</code> 元素的内容。 4.使用 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand#Commands"><code>Document.execCommand('copy')</code></a> 复制 <code>&lt;textarea&gt;</code> 元素的内容到剪贴板。 5.从文档中移除 <code>&lt;textarea&gt;</code> 元素。</p><p>这个方法的最简版本大概如下：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> copyToClipboard <span class="op">=</span> str <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="kw">const</span> el <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;textarea&#39;</span>)<span class="op">;</span>
  <span class="va">el</span>.<span class="at">value</span> <span class="op">=</span> str<span class="op">;</span>
  <span class="va">document</span>.<span class="va">body</span>.<span class="at">appendChild</span>(el)<span class="op">;</span>
  <span class="va">el</span>.<span class="at">select</span>()<span class="op">;</span>
  <span class="va">document</span>.<span class="at">execCommand</span>(<span class="st">&#39;copy&#39;</span>)<span class="op">;</span>
  <span class="va">document</span>.<span class="va">body</span>.<span class="at">removeChild</span>(el)<span class="op">;</span>
<span class="op">&#125;;</span></code></pre></div><center style="font-size:14px;color:#999">copyToClipboard 方法的基本实现</center><p>记住，这个方法不是在任何情况下都可以使用的。因为 <code>Document.execCommand()</code> 的工作方式，它必须作为用户操作的响应结果。</p><h3 id="让插入的元素不可见">让插入的元素不可见</h3><p>如果你试用了上面的方法，你可能会在 <code>&lt;textarea&gt;</code> 元素插入或者移除时看到闪烁。这对使用屏幕阅读器的人来说很糟糕，因为它会导致一些非常烦人的问题。因此，下一步合理的操作就是使用 CSS 让元素不可见，同时设置只读，以防止用户的试图干扰。</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> copyToClipboard <span class="op">=</span> str <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="kw">const</span> el <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;textarea&#39;</span>)<span class="op">;</span>
  <span class="va">el</span>.<span class="at">value</span> <span class="op">=</span> str<span class="op">;</span>
  <span class="va">el</span>.<span class="at">setAttribute</span>(<span class="st">&#39;readonly&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span>
  <span class="va">el</span>.<span class="va">style</span>.<span class="at">position</span> <span class="op">=</span> <span class="st">&#39;absolute&#39;</span><span class="op">;</span>
  <span class="va">el</span>.<span class="va">style</span>.<span class="at">left</span> <span class="op">=</span> <span class="st">&#39;-9999px&#39;</span><span class="op">;</span>
  <span class="va">document</span>.<span class="va">body</span>.<span class="at">appendChild</span>(el)<span class="op">;</span>
  <span class="va">el</span>.<span class="at">select</span>()<span class="op">;</span>
  <span class="va">document</span>.<span class="at">execCommand</span>(<span class="st">&#39;copy&#39;</span>)<span class="op">;</span>
  <span class="va">document</span>.<span class="va">body</span>.<span class="at">removeChild</span>(el)<span class="op">;</span>
<span class="op">&#125;;</span></code></pre></div><center style="font-size:14px;color:#999">隐藏文本域的 copyToClipboard 实现</center><h3 id="保存和恢复原先的文档选中">保存和恢复原先的文档选中</h3><p>最后需要考虑的问题是，用户可能已经在 HTML 文档中选中了一些内容，明智之举是不移除他们选中的这些内容。幸运的是，我们可以使用诸如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentOrShadowRoot/getSelection"><code>DocumentOrShadowRoot.getSelection()</code></a>,<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Selection/rangeCount"><code>Selection.rangeCount</code></a>, <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Selection/getRangeAt"><code>Selection.getRangeAt()</code></a>, <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Selection/removeAllRanges"><code>Selection.removeAllRanges()</code></a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Selection/addRange"><code>Selection.addRange()</code></a> 等现成的 JavaScript 方法和属性来保存和恢复原先的文档选中。这是最终的带注释的改良代码：</p><div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">const</span> copyToClipboard <span class="op">=</span> str <span class="op">=&gt;</span> <span class="op">&#123;</span>
  <span class="kw">const</span> el <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;textarea&#39;</span>)<span class="op">;</span>  <span class="co">// 创建一个 &lt;textarea&gt; 元素</span>
  <span class="va">el</span>.<span class="at">value</span> <span class="op">=</span> str<span class="op">;</span>                                 <span class="co">// 设置它的值为你想复制的字符串</span>
  <span class="va">el</span>.<span class="at">setAttribute</span>(<span class="st">&#39;readonly&#39;</span><span class="op">,</span> <span class="st">&#39;&#39;</span>)<span class="op">;</span>                <span class="co">// 设置为只读以防止干扰</span>
  <span class="va">el</span>.<span class="va">style</span>.<span class="at">position</span> <span class="op">=</span> <span class="st">&#39;absolute&#39;</span><span class="op">;</span>                 
  <span class="va">el</span>.<span class="va">style</span>.<span class="at">left</span> <span class="op">=</span> <span class="st">&#39;-9999px&#39;</span><span class="op">;</span>                      <span class="co">// 移出屏幕外以使其不可见</span>
  <span class="va">document</span>.<span class="va">body</span>.<span class="at">appendChild</span>(el)<span class="op">;</span>                  <span class="co">// 插入 &lt;textarea&gt; 元素到 HTML 文档中</span>
  <span class="kw">const</span> selected <span class="op">=</span>            
    <span class="va">document</span>.<span class="at">getSelection</span>().<span class="at">rangeCount</span> <span class="op">&gt;</span> <span class="dv">0</span>        <span class="co">// 检查是否之前曾选中过内容</span>
      <span class="op">?</span> <span class="va">document</span>.<span class="at">getSelection</span>().<span class="at">getRangeAt</span>(<span class="dv">0</span>)     <span class="co">// 如果找到，则保存选中</span>
      : <span class="kw">false</span><span class="op">;</span>                                    <span class="co">// 标记为  false 以表示不存在之前选中的内容</span>
  <span class="va">el</span>.<span class="at">select</span>()<span class="op">;</span>                                    <span class="co">// 选中 &lt;textarea&gt; 的内容</span>
  <span class="va">document</span>.<span class="at">execCommand</span>(<span class="st">&#39;copy&#39;</span>)<span class="op">;</span>                   <span class="co">// 复制 - 仅当作为用户操作的响应结果时才可以工作(比如，点击事件)</span>
  <span class="va">document</span>.<span class="va">body</span>.<span class="at">removeChild</span>(el)<span class="op">;</span>                  <span class="co">// 移除 &lt;textarea&gt; 元素</span>
  <span class="cf">if</span> (selected) <span class="op">&#123;</span>                                 <span class="co">// 如果在复制前已存在选中的内容</span>
    <span class="va">document</span>.<span class="at">getSelection</span>().<span class="at">removeAllRanges</span>()<span class="op">;</span>    <span class="co">// 取消 HTML 文档中所有的选中部分</span>
    <span class="va">document</span>.<span class="at">getSelection</span>().<span class="at">addRange</span>(selected)<span class="op">;</span>   <span class="co">// 恢复原来的选中</span>
  <span class="op">&#125;</span>
<span class="op">&#125;;</span></code></pre></div><center style="font-size:14px;color:#999">最终形式的 copyToClipboard，可以保存选中</center><p>这就是全部的内容。仅用了不到 20 行代码，我们已经创建了前端开发中最常用的方法之一。</p><p>如果喜欢这篇文章，给一个 clap（或者 fifty）。记得查看 <a target="_blank" rel="noopener" href="https://github.com/Chalarangelo/30-seconds-of-code">30 秒代码</a> ，为你的 JavaScript 项目找到更多实用的代码块！</p></div><div class="post-nav"><div class="post-nav-prev"><a href="/2019/05/24/F-ES6%20%E5%8F%82%E6%95%B0%E4%BD%9C%E7%94%A8%E5%9F%9F/" rel="prev" title="ES6 参数默认值引起的中间作用域"><i class="fa fa-angle-double-left"></i>&nbspES6 参数默认值引起的中间作用域</a></div><div class="post-nav-next"><a href="/2019/05/22/T-%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/" rel="next" title="前端学习知识体系">前端学习知识体系&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top">Contents</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-text">核心功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A9%E6%8F%92%E5%85%A5%E7%9A%84%E5%85%83%E7%B4%A0%E4%B8%8D%E5%8F%AF%E8%A7%81"><span class="toc-text">让插入的元素不可见</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E5%92%8C%E6%81%A2%E5%A4%8D%E5%8E%9F%E5%85%88%E7%9A%84%E6%96%87%E6%A1%A3%E9%80%89%E4%B8%AD"><span class="toc-text">保存和恢复原先的文档选中</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"retro",pageSize:10,visitor:!0})</script></section></main><script>var user=[1,2,3,4]</script><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - <span>2021</span> My Blog</p><p class="a">Powered by <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a target="_blank" rel="noopener" href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/search.js"></script><script src="/js/post-except.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script></body></html><!-- rebuild by neat -->