<!-- build time:Sun Nov 24 2019 12:31:45 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>PureBlue</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third party/pace-theme-flash.css"><link rel="icon" href="/images/me.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script><script src="/js/prism-line-numbers.min.js"></script><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><script src="/js/prism.js"></script>
<script src="/js/prism-line-numbers.min.js"></script></head><body><header class="header"><div class="header_top"><span class="theme"><a href="/">Chor's blog</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">首页</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">分类</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">归档</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">标签</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">关于</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a href="https://github.com/Chorer/hexo-theme-PureBlue" class="logo">PureBlue</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">「译」创建一个Hexo主题-Part3 :评论、分析和小部件</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-06-05&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp1.8k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp7 mins&nbsp&nbsp&nbsp</span><div class="post-tags"><i class="fa fa-tags"></i> <a href="/tags/hexo-theme/">hexo theme</a></div></div><div class="post-content"><blockquote><ul><li>原文地址：<a href="http://www.codeblocq.com/2016/03/Create-an-Hexo-Theme-Part-3-Comments-Analytics-and-Widgets/" target="_blank" rel="noopener">Create an Hexo Theme - Part 3: Comments, Analytics and Widgets</a></li><li>原文作者：Jonathan Klughertz</li><li>译者：Chor<a id="more"></a></li></ul></blockquote><p>在这个系列教程中，你将学习怎么从零开始制作一个 Hexo 主题。<br>在 <a href="https://chorer.github.io/%2F2019%2F03%2F27%2FTrs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart1%2F">part1</a> 和 <a href="https://chorer.github.io/%2F2019%2F03%2F27%2FTrs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart2%2F">part2</a> 中，我们已经创建了博客的所有页面。在这篇文章中，我们将给博客添加 <a href="https://disqus.com/" target="_blank" rel="noopener">Disqus 评论系统</a>，实现 <a href="https://www.google.com.sg/analytics/" target="_blank" rel="noopener">谷歌分析</a>以及完成侧边栏的小部件。</p><h2 id="其它文章的链接："><a href="#其它文章的链接：" class="headerlink" title="其它文章的链接："></a>其它文章的链接：</h2><ul><li><a href="https://chorer.github.io/%2F2019%2F03%2F27%2FTrs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart1%2F">创建一个Hexo主题-Part1:首页</a></li><li><a href="https://chorer.github.io/%2F2019%2F03%2F27%2FTrs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart2%2F">创建一个Hexo主题-Part2:其他页面</a></li><li><a href="https://chorer.github.io/2019/06/05/Trs-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98%E4%B9%8BPart3/">创建一个Hexo主题-Part3:评论、分析和小部件</a></li></ul><h2 id="Disqus-评论系统"><a href="#Disqus-评论系统" class="headerlink" title="Disqus 评论系统"></a>Disqus 评论系统</h2><p>我已经写了一篇关于<a href="http://www.codeblocq.com/2015/12/Add-Disqus-comments-in-Hexo/" target="_blank" rel="noopener">如何在 Hexo 中使用 Disqus 评论系统</a>的文章。请前往查看以了解更多信息，这里我只简单介绍一下怎么使用：</p><p>第一步是获取 Disqus UID 来测试评论功能，可以利用你的账号在这里获取：<br><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/%E3%80%8C%E8%AF%91%E3%80%8D%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAHexo%E4%B8%BB%E9%A2%98-Part3%20%E8%AF%84%E8%AE%BA%E3%80%81%E5%88%86%E6%9E%90%E5%92%8C%E5%B0%8F%E9%83%A8%E4%BB%B6/add-disqus-comments-hexo-unique-name.jpg" alt=""><br>接下来需要完成三个部分：主题文件的 disqus 配置、评论占位区、Disqus 脚本。事不宜迟，我们开始吧。</p><h3 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h3><p>我们希望 Disqus UID 是可以配置的，因此给主题的 <code>config.yml</code> 文件添加一个条目：</p><pre class="line-numbers language-js"><code class="language-js"># Disqus Comments Shortname
disqus_shortname<span class="token punctuation">:</span> klugjoTest
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="评论占位区"><a href="#评论占位区" class="headerlink" title="评论占位区"></a>评论占位区</h3><p>接下来我们给页面和文章详情页添加评论系统。和之前一样，创建一个局部视图文件 <code>layout/_partial/comments.ejs</code>，之后打开 <code>layout/_partial/article-full.ejs</code> 文件，把它插入到末尾。</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* layout/_partial/comments.ejs */</span>
<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"blog-post"</span><span class="token operator">></span>
   <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Comments <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token function">partial</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Disqus 需要 ID 为 <code>disqus_thread</code> 的 div 元素，因此我们这里复制官方文档提供的代码：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>disqus_thread<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>noscript</span><span class="token punctuation">></span></span>Please enable JavaScript to view the <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>//disqus.com/?ref_noscript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>comments powered by Disqus.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>noscript</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>将上面的代码合并到 <code>comments</code> 文件中：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* layout/_partial/comments.ejs */</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>comments <span class="token operator">&amp;&amp;</span> theme<span class="token punctuation">.</span>disqus_shortname<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"blog-post-comments"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h3<span class="token operator">></span>Comments<span class="token punctuation">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
        <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"disqus_thread"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>noscript<span class="token operator">></span>Please enable JavaScript to view the <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"//disqus.com/?ref_noscript"</span><span class="token operator">></span>comments powered by Disqus<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>noscript<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先我们检查是否开启了评论功能和设置了 disqus UID，之后将 Disqus 标记代码放到容器里。<br>以下是容器的 CSS 样式代码：</p><pre class="line-numbers language-css"><code class="language-css"><span class="token comment" spellcheck="true">/* source/css/blog.css */</span>
<span class="token selector"><span class="token class">.blog-post-comments</span> </span><span class="token punctuation">{</span>
    <span class="token property">margin-top</span><span class="token punctuation">:</span> <span class="token number">50</span>px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Disqus-脚本"><a href="#Disqus-脚本" class="headerlink" title="Disqus 脚本"></a>Disqus 脚本</h3><p>在测试之前，我们还需要添加 Disqus 的脚本，这是一切生效的关键。将它和其他脚本一起放在 <code>layout/_partial/after-footer.ejs</code> 的末尾</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* layout/_partial/after-footer.ejs */</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Disqus Comments <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>disqus_shortname<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>
        <span class="token keyword">var</span> disqus_shortname <span class="token operator">=</span> <span class="token string">'&lt;%= theme.disqus_shortname %>'</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> dsq <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dsq<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span><span class="token punctuation">;</span>
            dsq<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            dsq<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'//'</span> <span class="token operator">+</span> disqus_shortname <span class="token operator">+</span> <span class="token string">'.disqus.com/&lt;% if (page.comments){ %>embed.js&lt;% } else { %>count.js&lt;% } %>'</span><span class="token punctuation">;</span>
            <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dsq<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>脚本来自于<a href="https://help.disqus.com/customer/portal/articles/472097-universal-embed-code" target="_blank" rel="noopener">官方文档</a>,并且我们在这里将 Disqus UID 参数化。<br>接着就可以测试一切是否正常工作了。</p><h2 id="谷歌分析"><a href="#谷歌分析" class="headerlink" title="谷歌分析"></a>谷歌分析</h2><p>谷歌分析的实现和 Disqus 差不多，所以这里我只简单提一下。具体步骤可以看我的<a href="http://www.codeblocq.com/2015/12/Add-Google-Analytics-to-your-hexo-blog/" target="_blank" rel="noopener">另一篇博客</a>。</p><h3 id="在主题配置文件中设置-tracking-ID"><a href="#在主题配置文件中设置-tracking-ID" class="headerlink" title="在主题配置文件中设置 tracking ID"></a>在主题配置文件中设置 tracking ID</h3><p>从你的账号中获取谷歌分析的 tracking ID，之后再配置文件中新增条目。</p><pre class="line-numbers language-js"><code class="language-js"># Google Analytics Tracking ID
google_analytics<span class="token punctuation">:</span> UA<span class="token number">-83746351</span><span class="token operator">-</span><span class="token number">2</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="创建一个新的局部文件"><a href="#创建一个新的局部文件" class="headerlink" title="创建一个新的局部文件"></a>创建一个新的局部文件</h3><p>创建一个新的局部视图文件 <code>layout/_partial/google-analytic.ejs</code></p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* layout/_partial/google-analytic.ejs */</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>google_analytics<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>script<span class="token operator">></span>
        <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>s<span class="token punctuation">,</span>o<span class="token punctuation">,</span>g<span class="token punctuation">,</span>r<span class="token punctuation">,</span>a<span class="token punctuation">,</span>m<span class="token punctuation">)</span><span class="token punctuation">{</span>i<span class="token punctuation">[</span><span class="token string">'GoogleAnalyticsObject'</span><span class="token punctuation">]</span><span class="token operator">=</span>r<span class="token punctuation">;</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token operator">||</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token punctuation">(</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>q<span class="token operator">=</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>q<span class="token operator">||</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>i<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span>l<span class="token operator">=</span><span class="token number">1</span><span class="token operator">*</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">,</span>
                m<span class="token operator">=</span>s<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token keyword">async</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span>src<span class="token operator">=</span>g<span class="token punctuation">;</span>m<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span>document<span class="token punctuation">,</span><span class="token string">'script'</span><span class="token punctuation">,</span><span class="token string">'//www.google-analytics.com/analytics.js'</span><span class="token punctuation">,</span><span class="token string">'ga'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ga</span><span class="token punctuation">(</span><span class="token string">'create'</span><span class="token punctuation">,</span> <span class="token string">'&lt;%= theme.google_analytics %>'</span><span class="token punctuation">,</span> <span class="token string">'auto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ga</span><span class="token punctuation">(</span><span class="token string">'send'</span><span class="token punctuation">,</span> <span class="token string">'pageview'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是从<a href="https://support.google.com/analytics/answer/1008080?hl=en" target="_blank" rel="noopener">谷歌分析跟踪代码</a>复制粘贴过来的，其中包括一个参数化的 ID。</p><h3 id="合并到局部文件中"><a href="#合并到局部文件中" class="headerlink" title="合并到局部文件中"></a>合并到局部文件中</h3><p>我们希望可以在任何页面中获取到跟踪代码，而页面上又没有合适的位置来存放，因此我们选择把它添加到 <code>&lt;head&gt;&lt;/head&gt;</code> 的末尾：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* layout/_partial/head.ejs */</span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1"</span><span class="token operator">></span>
    <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> Google Analytics <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token function">partial</span><span class="token punctuation">(</span><span class="token string">'google-analytics'</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>大功告成！</p><h2 id="小部件"><a href="#小部件" class="headerlink" title="小部件"></a>小部件</h2><p>此时，<code>sidebar.ejs</code> 文件中的小部件还只是一堆采用硬编码的静态 HTML。我们来修复这个问题。</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>先从配置开始吧。<br>我们准备创建两个小部件，一个是“关于”，一个是“标签”。相关配置如果以 JavaScript 对象的形式来书写，大概是下面这样：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token punctuation">{</span>
    widgets<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        about<span class="token punctuation">:</span> <span class="token string">"Here goes the about text"</span><span class="token punctuation">,</span>
        tags<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment" spellcheck="true">// Or any additional configuration the widget needs</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是它在我们的主题配置文件中转换成 YML 的形式：</p><pre class="line-numbers language-js"><code class="language-js"># Widgets List
widgets<span class="token punctuation">:</span>
  about<span class="token punctuation">:</span> This blog is based off the official bootstrap blog template<span class="token punctuation">.</span> Checkout the corresponding tutorial at <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://www.codeblocq.com"</span><span class="token operator">></span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>codeblocq<span class="token punctuation">.</span>com<span class="token operator">&lt;</span><span class="token operator">/</span>a
  tags<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="侧边栏代码"><a href="#侧边栏代码" class="headerlink" title="侧边栏代码"></a>侧边栏代码</h3><p>作为所有小部件的占位区，我们的侧边栏需要遍历配置文件中的所有小部件并将其渲染出来：<br>侧边栏的 EJS 模板如下：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* layout/_partial/sidebar.ejs */</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> widget <span class="token keyword">in</span> theme<span class="token punctuation">.</span>widgets<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> <span class="token function">partial</span><span class="token punctuation">(</span><span class="token string">'widget/'</span> <span class="token operator">+</span> widget<span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="第一个小部件：“关于”"><a href="#第一个小部件：“关于”" class="headerlink" title="第一个小部件：“关于”"></a>第一个小部件：“关于”</h3><p>新建一个局部文件 <code>layout/_partial/widget/about.ejs</code>，之后在里面创建第一个小部件。<br>代码是从原先的 bootstrap 模板中复制过来的，文本则来自于配置文件。</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* layout/_partial/widget/about.ejs */</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span><span class="token punctuation">(</span>theme<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>about<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sidebar-module sidebar-module-inset"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h4<span class="token operator">></span>About<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">-</span> theme<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>about <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="第二个小部件：“标签”"><a href="#第二个小部件：“标签”" class="headerlink" title="第二个小部件：“标签”"></a>第二个小部件：“标签”</h3><p>我们给这个部件做一些略微高级的改动。设置一个段落用于存放博客中用过的所有标签。它们互相之间用空格隔开，并且字体大小与标签使用次数成比例。<br>这是 <code>layout/_partial/widget/tags.ejs</code> 的代码：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token comment" spellcheck="true">/* layout/_partial/widget/tags.ejs */</span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>widgets<span class="token punctuation">.</span>tags <span class="token operator">&amp;&amp;</span> site<span class="token punctuation">.</span>tags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sidebar-module"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h4<span class="token operator">></span>Tags<span class="token operator">&lt;</span><span class="token operator">/</span>h4<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">%</span> site<span class="token punctuation">.</span>tags<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token operator">%</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"&lt;%- config.root %>&lt;%- item.path %>"</span> style<span class="token operator">=</span><span class="token string">"font-size: &lt;%- Math.min(item.posts.length * 2 + 13, 30) %>px"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">=</span> item<span class="token punctuation">.</span>name <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token punctuation">}</span> <span class="token operator">%</span><span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>site.tags</code> 让我们可以获取所有标签</li><li><code>site.tags.sort(&#39;name)</code> 按照字母表的顺序对所有标签进行排序</li><li><code>item.path</code> 对应标签归档页的相对 URL</li><li><code>item.posts.length</code> 表示标签的使用次数</li><li><code>item.name</code> 是标签的名字</li></ul><p>我这里选择 <code>13+（标签使用次数 *2）px</code> 作为字体大小的计算方式，并且最大不超过 <code>30px</code>。当然，你可以根据自己的喜好来。</p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>教程到这里就结束了，我希望你从中可以学到不少有趣的东西。<br>如果你想进一步打磨主题，可以考虑下面这些事情：</p><ul><li>通过参数化 <code>&lt;title&gt;</code> 和所有 <a href="http://ogp.me/" target="_blank" rel="noopener">Open Graph</a> 属性完善 <code>head</code> 部分</li><li>添加更多小部件，例如<a href="https://github.com/hexojs/hexo-theme-light/blob/master/layout/_widget/search.ejs" target="_blank" rel="noopener">搜索小部件</a> 或者是一个 <a href="https://github.com/hexojs/hexo-theme-light/blob/master/layout/_widget/recent_posts.ejs" target="_blank" rel="noopener">近期文章小部件</a></li><li>将你的主题提交到 <a href="https://hexo.io/themes/" target="_blank" rel="noopener">Hexo官方主题站点</a></li><li>查看我的其他 <a href="http://www.codeblocq.com/tags/" target="_blank" rel="noopener">Hexo 教程</a>来改进你的博客</li><li>查看<a href="https://github.com/cgmartin/hexo-theme-bootstrap-blog" target="_blank" rel="noopener">hexo-theme-bootstrap-blog</a>,这个主题同样是基于 bootstrap 模板实现的</li><li>从零开始打造你自己的主题</li></ul><p>感谢阅读！欢迎在评论区留下你的评论、指正和意见。</p></div><div class="post-nav"><div class="post-nav-prev"><a href="/2019/06/06/F-CSS 基础系列：flex 布局/" rel="prev" title="CSS 基础系列：flex 布局"><i class="fa fa-angle-double-left"></i>&nbspCSS 基础系列：flex 布局</a></div><div class="post-nav-next"><a href="/2019/05/31/F-CSS 基础系列：常见布局方式/" rel="next" title="CSS 基础系列：常见布局方式">CSS 基础系列：常见布局方式&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#其它文章的链接："><span class="toc-text">其它文章的链接：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Disqus-评论系统"><span class="toc-text">Disqus 评论系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#主题配置"><span class="toc-text">主题配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#评论占位区"><span class="toc-text">评论占位区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Disqus-脚本"><span class="toc-text">Disqus 脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#谷歌分析"><span class="toc-text">谷歌分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在主题配置文件中设置-tracking-ID"><span class="toc-text">在主题配置文件中设置 tracking ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#创建一个新的局部文件"><span class="toc-text">创建一个新的局部文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#合并到局部文件中"><span class="toc-text">合并到局部文件中</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小部件"><span class="toc-text">小部件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置"><span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#侧边栏代码"><span class="toc-text">侧边栏代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第一个小部件：“关于”"><span class="toc-text">第一个小部件：“关于”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二个小部件：“标签”"><span class="toc-text">第二个小部件：“标签”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最后"><span class="toc-text">最后</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/search.js"></script><script src="/js/post-except.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script></body></html><!-- rebuild by neat -->