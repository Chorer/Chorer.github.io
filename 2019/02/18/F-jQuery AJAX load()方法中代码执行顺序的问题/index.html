<!-- build time:Sun May 26 2019 20:27:19 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=1" name="viewport"><title>Chor&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="icon" href="/images/me.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><header class="header"><span class="theme"><i class="fa fa-bars"></i> <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></span><div class="blog-title"><a href="/" class="logo">Chor&#39;s Blog</a><div class="descr">个人博客</div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link">HOME</a></li><li class="menu-item"><a href="/categories" class="menu-item-link">CATEGORIES</a></li><li class="menu-item"><a href="/archives" class="menu-item-link">ARCHIVES</a></li><li class="menu-item"><a href="/tags" class="menu-item-link">TAGS</a></li><li class="menu-item"><a href="/about" class="menu-item-link">ABOUT</a></li></ul></nav><i id="homelink" data-link="https://chorer.github.io/"></i></header><main class="main"><section class="posts"><article class="post"><div class="post-title"><a class="post-title-link" href="/2019/02/18/F-jQuery AJAX load()方法中代码执行顺序的问题/">jQuery AJAX load()方法中代码执行顺序的问题</a></div><div class="post-sub_title"></div><div class="post-date"><span class="date-text"><i class="fa fa-calendar"></i>Date:&nbsp&nbsp2019-02-18</span></div><div class="post-tags"><span class="post-tags-list"><i class="fa fa-bookmark"></i> Tags:&nbsp&nbsp&nbsp </span><a href="/tags/JavaScript/"><i class="fa fa-tag"></i> JavaScript</a> <a href="/tags/AJAX/"><i class="fa fa-tag"></i> AJAX</a> <a href="/tags/浏览器渲染/"><i class="fa fa-tag"></i> 浏览器渲染</a></div><div class="post-statistic"><span class="post-words"><i class="fa fa-pencil-square-o"></i> <span class="text_words">Count: </span><span>682 words</span> </span>&nbsp| &nbsp<span class="post-time"> <i class="fa fa-clock-o"></i> <span class="text_time">Time: </span><span>2 mins</span></span></div><div class="post-content"><p>问题来源于菜鸟教程介绍 jQuery <code>load()</code> 方法时用的一个实例：<br><a id="more"></a><br><strong>JS：</strong></p><pre class="line-numbers language-js"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#div1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"demo_test.txt"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>responseTxt<span class="token punctuation">,</span>statusTxt<span class="token punctuation">,</span>xhr<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>statusTxt<span class="token operator">==</span><span class="token string">"success"</span><span class="token punctuation">)</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"外部内容加载成功!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>statusTxt<span class="token operator">==</span><span class="token string">"error"</span><span class="token punctuation">)</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Error: "</span><span class="token operator">+</span>xhr<span class="token punctuation">.</span>status<span class="token operator">+</span><span class="token string">": "</span><span class="token operator">+</span>xhr<span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>HTML：</strong></p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>使用 jQuery AJAX 修改该文本<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>获取外部内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这里作为load方法参数的函数是一个回调函数。什么是回调函数呢？我们先来看看回调的英文定义：</p><blockquote><p>A callback is a function that is passed as an argument to another function and is executed after its parent function has completed。</p></blockquote><p>字面上的理解，回调函数就是一个参数，将这个函数作为参数传到另一个函数里面，当那个函数执行完之后，再执行传进去的这个函数。这个过程就叫做回调。那么根据这个解释，这段代码应该是先执行 <code>load(&quot;demo_test.txt&quot;)</code> 加载外部内容，之后再执行回调函数弹出 alert。但是实际运行后发现和预想的不一样：</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/myblog/1.png" alt="在这里插入图片描述"><br><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/myblog/2.png" alt="在这里插入图片描述"><br>从结果来看，是先弹出 alert 再改变文本内容。那么，为什么会这样呢？难道上面的说法有误？为了进一步验证，修改代码如下：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#div1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"demo_test.txt"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>responseTxt<span class="token punctuation">,</span>statusTxt<span class="token punctuation">,</span>xhr<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token function">alert</span><span class="token punctuation">(</span>responseTxt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>statusTxt<span class="token operator">==</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>运行：</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/myblog/3.png" alt="在这里插入图片描述"><br>很明显文本内容已经改变，说明前面关于回调函数最后执行的说法是没问题的。接着猜想，之所以先弹出 alert 再改变文本内容，可能是因为必须等回调函数执行完后才能把文本渲染到浏览器上。<br>为了进一步验证，修改代码如下：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#div1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"demo_test.txt"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>responseTxt<span class="token punctuation">,</span>statusTxt<span class="token punctuation">,</span>xhr<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>statusTxt<span class="token operator">==</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">debugger</span>；
           console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行：</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/myblog/4.png" alt="在这里插入图片描述"><br>控制台中没有打印出1，且程序中断，说明此时回调函数还在执行当中，但是文本内容却已经改变了。这说明上面的猜想错误—–即文本渲染到浏览器上不需要等到回调函数执行结束。<br>但是，那只是一般情况！！问题就在于，<strong>alert是可以阻塞浏览器的渲染工作的！</strong></p><p>重新运行最初的代码，可以看到还是先弹出 alert，文本没变，但是这时候点开控制台的 elements，可以看到图中红框显示这时候文本的内容其实已经改变了。</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/myblog/5.png" alt="在这里插入图片描述"><br>虽然文本内容看上去不变——但是实际情况是文本内容已经改变了，也就是 <code>load()</code> 方法已经生效了，只是 alert 阻塞了浏览器将它渲染出来。<br>在这里还要注意，alert 可以阻塞浏览器的渲染，而 debugger 是没办法的。</p></div></article><div class="post-toc"><div id="post-catalog-text" data-catalog="Article Catalog"></div><div id="post-toTop-text" data-totop="To the Top"></div></div><div id="vcomments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="/js/navbar.js"></script><script src="/js/BgPic.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/search.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/tororo.model.json"},display:{position:"left",width:150,height:300,vOffset:-120,hOffset:-5},mobile:{show:!1},react:{opacityDefault:1e3,opacityOnHover:1e3},log:!1})</script></body></html><!-- rebuild by neat -->