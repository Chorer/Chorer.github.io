<!-- build time:Sat Jun 01 2019 23:47:42 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Chor&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third party/pace-theme-flash.css"><link rel="icon" href="/images/me.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><header class="header"><span class="theme"><i class="fa fa-bars"></i> <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></span><div class="blog-title"><a href="/" class="logo">Chor&#39;s Blog</a><div class="descr">个人博客</div></div><nav class="navbar"><ul class="menu"><li class="menu-item"><a href="/" class="menu-item-link">HOME</a></li><li class="menu-item"><a href="/categories" class="menu-item-link">CATEGORIES</a></li><li class="menu-item"><a href="/archives" class="menu-item-link">ARCHIVES</a></li><li class="menu-item"><a href="/tags" class="menu-item-link">TAGS</a></li><li class="menu-item"><a href="/about" class="menu-item-link">ABOUT</a></li><li class="menu-item"><a href="#" id="menu-item-search" class="popup-trigger">SEARCH</a></li></ul></nav><i id="homelink" data-link="https://chorer.github.io/"></i><div class="site-search"><div class="algolia-popup popup"><div class="algolia-search"><div class="algolia-search-input-icon"><i class="fa fa-search"></i></div><div class="algolia-search-input" id="algolia-search-input"></div></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div></div></header><main class="main"><section class="posts"><article class="post"><div class="post-title"><a class="post-title-link" href="/2019/05/23/Trs-利用JavaScript复制文本到剪贴板/">「译」利用 JavaScript 复制文本到剪贴板</a></div><div class="post-sub_title"></div><div class="post-date"><span class="date-text"><i class="fa fa-calendar"></i>Date:&nbsp&nbsp2019-05-23</span></div><div class="post-tags"><span class="post-tags-list"><i class="fa fa-bookmark"></i> Tags:&nbsp&nbsp&nbsp </span><a href="/tags/30-seconds-of-code/"><i class="fa fa-tag"></i> 30 seconds of code</a></div><div class="post-statistic"><span class="post-words"><i class="fa fa-pencil-square-o"></i> <span class="text_words">Count: </span><span>975 words</span> </span>&nbsp| &nbsp<span class="post-time"> <i class="fa fa-clock-o"></i> <span class="text_time">Time: </span><span>3 mins</span></span></div><div class="post-content"><p>一个小小的诀窍。实现主题的复制代码功能时，思路刚好和这篇文章差不多，不过这篇文章的代码要更加合理。</p><hr><blockquote><ul><li>原文地址：<a href="https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f" target="_blank" rel="noopener">Copying text to clipboard with JavaScript</a></li><li>原文作者：<a href="https://hackernoon.com/@chalarangelo?source=post_header_lockup" target="_blank" rel="noopener">Angelos Chalaris</a></li><li>译者：Chor<a id="more"></a></li></ul></blockquote><p>本文将会深入介绍 <a href="https://github.com/Chalarangelo/30-seconds-of-code" target="_blank" rel="noopener">30 秒代码</a> 中 <strong><code>copyToClipboard</code></strong> 代码块的工作原理。你可以在项目仓库中找到它的源代码以及更多其他的实用方法。</p><p><img src="https://myblog-1258623898.cos.ap-chengdu.myqcloud.com/1_f2eZ4JeqO2TMkuNwwVN4gg.png" alt=""></p><center style="font-size:14px;color:#999">30 秒代码：可以在 30 秒或更短时间内理解的 JavaScript 代码块</center><h3 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h3><p><a href="https://hackernoon.com/tagged/web-development" target="_blank" rel="noopener">搭建网站</a>时经常会遇到一个需求，那就是在用户没有选中或者使用键盘组合键的情况下，复制文本到剪贴板。<a href="https://hackernoon.com/tagged/javascript" target="_blank" rel="noopener">JavaScript</a> 可以用短短五步轻松解决这个问题：</p><p>1.创建一个稍后将插入到文档中的 <code>&lt;textarea&gt;</code> 元素。将我们想要复制到剪贴板的字符串设置为它的 <code>value</code> 。<br>2.将上诉 <code>&lt;textarea&gt;</code> 元素插入到当前的 HTML 文档中。<br>3.使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/select" target="_blank" rel="noopener"><code>HTMLInputElement.select()</code></a> 选中 <code>&lt;textarea&gt;</code> 元素的内容。<br>4.使用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand#Commands" target="_blank" rel="noopener"><code>Document.execCommand(&#39;copy&#39;)</code></a> 复制 <code>&lt;textarea&gt;</code> 元素的内容到剪贴板。<br>5.从文档中移除 <code>&lt;textarea&gt;</code> 元素。</p><p>这个方法的最简版本大概如下：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> copyToClipboard <span class="token operator">=</span> str <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'textarea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span>value <span class="token operator">=</span> str<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">'copy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><center style="font-size:14px;color:#999">copyToClipboard 方法的基本实现</center><p>记住，这个方法不是在任何情况下都可以使用的。因为 <code>Document.execCommand()</code> 的工作方式，它必须作为用户操作的响应结果。</p><h3 id="让插入的元素不可见"><a href="#让插入的元素不可见" class="headerlink" title="让插入的元素不可见"></a>让插入的元素不可见</h3><p>如果你试用了上面的方法，你可能会在 <code>&lt;textarea&gt;</code> 元素插入或者移除时看到闪烁。这对使用屏幕阅读器的人来说很糟糕，因为它会导致一些非常烦人的问题。因此，下一步合理的操作就是使用 CSS 让元素不可见，同时设置只读，以防止用户的试图干扰。</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> copyToClipboard <span class="token operator">=</span> str <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'textarea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span>value <span class="token operator">=</span> str<span class="token punctuation">;</span>
  el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'readonly'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">'-9999px'</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  el<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">'copy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><center style="font-size:14px;color:#999">隐藏文本域的 copyToClipboard 实现</center><h3 id="保存和恢复原先的文档选中"><a href="#保存和恢复原先的文档选中" class="headerlink" title="保存和恢复原先的文档选中"></a>保存和恢复原先的文档选中</h3><p>最后需要考虑的问题是，用户可能已经在 HTML 文档中选中了一些内容，明智之举是不移除他们选中的这些内容。幸运的是，我们可以使用诸如 <a href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentOrShadowRoot/getSelection" target="_blank" rel="noopener"><code>DocumentOrShadowRoot.getSelection()</code></a>,<a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection/rangeCount" target="_blank" rel="noopener"><code>Selection.rangeCount</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection/getRangeAt" target="_blank" rel="noopener"><code>Selection.getRangeAt()</code></a>, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection/removeAllRanges" target="_blank" rel="noopener"><code>Selection.removeAllRanges()</code></a> 和 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Selection/addRange" target="_blank" rel="noopener"><code>Selection.addRange()</code></a> 等现成的 JavaScript 方法和属性来保存和恢复原先的文档选中。这是最终的带注释的改良代码：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">const</span> copyToClipboard <span class="token operator">=</span> str <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'textarea'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 创建一个 &lt;textarea> 元素</span>
  el<span class="token punctuation">.</span>value <span class="token operator">=</span> str<span class="token punctuation">;</span>                                 <span class="token comment" spellcheck="true">// 设置它的值为你想复制的字符串</span>
  el<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'readonly'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">// 设置为只读以防止干扰</span>
  el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">'absolute'</span><span class="token punctuation">;</span>                 
  el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token string">'-9999px'</span><span class="token punctuation">;</span>                      <span class="token comment" spellcheck="true">// 移出屏幕外以使其不可见</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment" spellcheck="true">// 插入 &lt;textarea> 元素到 HTML 文档中</span>
  <span class="token keyword">const</span> selected <span class="token operator">=</span>            
    document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rangeCount <span class="token operator">></span> <span class="token number">0</span>        <span class="token comment" spellcheck="true">// 检查是否之前曾选中过内容</span>
      <span class="token operator">?</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">// 如果找到，则保存选中</span>
      <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                                    <span class="token comment" spellcheck="true">// 标记为  false 以表示不存在之前选中的内容</span>
  el<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token comment" spellcheck="true">// 选中 &lt;textarea> 的内容</span>
  document<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">'copy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment" spellcheck="true">// 复制 - 仅当作为用户操作的响应结果时才可以工作(比如，点击事件)</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment" spellcheck="true">// 移除 &lt;textarea> 元素</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                 <span class="token comment" spellcheck="true">// 如果在复制前已存在选中的内容</span>
    document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 取消 HTML 文档中所有的选中部分</span>
    document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>selected<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">// 恢复原来的选中</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><center style="font-size:14px;color:#999">最终形式的 copyToClipboard，可以保存选中</center><p>这就是全部的内容。仅用了不到 20 行代码，我们已经创建了前端开发中最常用的方法之一。</p><p>如果喜欢这篇文章，给一个 clap（或者 fifty）。记得查看 <a href="https://github.com/Chalarangelo/30-seconds-of-code" target="_blank" rel="noopener">30 秒代码</a> ，为你的 JavaScript 项目找到更多实用的代码块！</p></div><div class="post-nav"><div class="post-nav-prev"><a href="/2019/05/24/F-ES6 参数作用域/" rel="prev" title="ES6 参数默认值引起的中间作用域"><i class="fa fa-chevron-left"></i>ES6 参数默认值引起的中间作用域</a></div><div class="post-nav-next"><a href="/2019/05/22/T-前端学习知识体系/" rel="next" title="前端学习知识体系">前端学习知识体系<i class="fa fa-chevron-right"></i></a></div></div></article><div class="post-toc"><div id="post-catalog-text" data-catalog="Article Catalog"></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#核心功能"><span class="toc-text">核心功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#让插入的元素不可见"><span class="toc-text">让插入的元素不可见</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#保存和恢复原先的文档选中"><span class="toc-text">保存和恢复原先的文档选中</span></a></li></ol><div id="post-toTop-text" data-totop="To the Top"></div></div><div id="vcomments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="http://cdn.bootcss.com/instantsearch.js/1.5.1/instantsearch.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/search.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/Algolia-search.js"></script><script type="text/javascript" id="hexo.configuration">var CONFIG={root:"/",algolia:{applicationID:RBAA6VWZZ8,apiKey:f138a7bd05242d220d80f6401641f957,indexName:blog,hits:{per_page:10},labels:{input_placeholder:"搜索...",hits_empty:"未发现与 「${query}」相关的内容",hits_stats:"${hits} 条相关条目，使用了 ${time} 毫秒"}}}</script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script><script src="/js/BgPic.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/tororo.model.json"},display:{position:"left",width:150,height:300,vOffset:-120,hOffset:-5},mobile:{show:!1},react:{opacityDefault:1e3,opacityOnHover:1e3},log:!1})</script></body></html><!-- rebuild by neat -->