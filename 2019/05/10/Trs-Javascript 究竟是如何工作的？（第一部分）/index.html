<!-- build time:Fri Oct 18 2019 21:46:18 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Chor&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third party/pace-theme-flash.css"><link rel="icon" href="/images/me.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><header class="header"><div class="header_top"><span class="theme"><i class="fa fa-bars"></i> <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">HOME</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">CATEGORIES</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">ARCHIVES</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">TAGS</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">ABOUT</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a href="/" class="logo">Chor&#39;s Blog</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">「译」JavaScript 究竟是如何工作的？（第一部分）</div></h1><div class="post-sub_title">什么是 V8？JavaScript运行的背后发生了什么？</div><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-05-10&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp1.8k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp6 mins&nbsp&nbsp&nbsp</span><div class="post-tags"></div></div><div class="post-content"><blockquote><ul><li>原文地址：<a href="https://blog.bitsrc.io/how-does-javascript-really-work-part-1-7681dd54a36d" target="_blank" rel="noopener">How Does JavaScript Really Work? (Part 1)</a></li><li>原文作者：<a href="https://blog.bitsrc.io/@priyeshp18" target="_blank" rel="noopener">Priyesh Patel</a></li><li>译文地址：<a href="https://juejin.im/post/5cef7f1be51d45777811732c" target="_blank" rel="noopener">[译] JavaScript 究竟是如何工作的？（第一部分）</a></li><li>译者：Chor<a id="more"></a></li></ul></blockquote><p><img src="https://raw.githubusercontent.com/Chorer/MyBlog-Pic/master/Myblogs/1.jpg" alt=""></p><p>如果你是一个 JS 开发者或者是正在学习这门语言的学生，很大概率上你会遇到双字母词”V8”。在这篇文章中，我将会为你简述不同的 JS 引擎并深入探究 V8 引擎的工作机制。文章的第二部分涵盖了内存管理的概念，不久后将发布。</p><p>这篇文章是由 <a href="https://bit.dev" target="_blank" rel="noopener"><strong>Bit</strong></a> (<a href="https://github.com/teambit/bit" target="_blank" rel="noopener">GitHub</a>) 带来的。作为一个共享组件的平台，Bit 帮助每个人构建模块化的 JavaScript 应用程序，在项目和团队之间轻松地共享组件，同时实现更好&amp;更快的构建。<a href="https://bit.dev" target="_blank" rel="noopener">试试看</a>。</p><p><img src="https://raw.githubusercontent.com/Chorer/MyBlog-Pic/master/Myblogs/2.gif" alt=""></p><h3 id="1-编程语言是如何工作的？"><a href="#1-编程语言是如何工作的？" class="headerlink" title="1.编程语言是如何工作的？"></a>1.编程语言是如何工作的？</h3><p>在开始讲解 JavaScript 之前，我们首先要理解任意一门编程语言的基本工作方式。电脑是由微处理器构成的，我们通过书写代码来命令这台小巧但功能强大的机器。但是微处理器能理解什么语言？它们无法理解 Java，Python 等语言，而只懂机器码。<br>用机器语言或汇编语言编写企业级代码是不可行的，因此我们需要像 Java，Python 这样配带一个解释器或者编译器用于将其转换为机器码的高级语言。</p><h4 id="1-1编译器和解释器"><a href="#1-1编译器和解释器" class="headerlink" title="1.1编译器和解释器"></a>1.1编译器和解释器</h4><p>编译器/解释器可以用它处理的语言或任何其他语言来编写。</p><p><strong>解释器：</strong> 一行一行地快速读取和翻译文件。这就是 JavaScript 最初的工作原理。</p><p><strong>编译器：</strong> 编译器提前运行并创建一个文件，其中包含了输入文件的机器码转换。</p><p>有两种途径可以将 JavaScript 代码转换为机器码。编译代码时，机器对代码开始运行前将要发生的事情有更好的理解，这将加快稍后的执行速度。不过，在这个过程之前需要花费时间。</p><p>另一方面，解释代码时，执行是立即的，因此要更快，但是缺乏优化导致它在大型应用程序下运行缓慢。</p><p>创建 ECMAScript 引擎的人很聪明，他们集二者之长开发了 JIT(Just-in-time) 编译器。JavaScript 同时被编译和解释，但实际实现和顺序取决于引擎。我们将会看到 V8 团队采用的是什么策略。</p><h3 id="2-从-JavaScript-到机器码"><a href="#2-从-JavaScript-到机器码" class="headerlink" title="2.从 JavaScript 到机器码"></a>2.从 JavaScript 到机器码</h3><p>就 JavaScript 而言，有一个引擎将其转换为机器码。和其他语言类似，引擎可以用任何语言来开发，因此这样的引擎不止一个。</p><ul><li>V8 是谷歌针对 Chorme 浏览器的引擎实现。</li><li>SpiderMonkey 是第一个引擎，针对网景浏览器开发，现用于驱动 FireFox。</li><li>JavaScriptCore 是苹果针对 Safari 浏览器使用的引擎。</li></ul><p>还有很多，如果你想知道 Internet Explorer 背后的引擎，查看<a href="https://en.wikipedia.org/wiki/JavaScript_engine" target="_blank" rel="noopener">这个维基百科页面</a>.</p><h4 id="2-1-ECMAScript"><a href="#2-1-ECMAScript" class="headerlink" title="2.1 ECMAScript"></a>2.1 ECMAScript</h4><p>面对这么多的引擎，你可能会问：我可以开发自己的引擎吗？可以，只要遵循 ECMAScript 标准。</p><p>如果我们打算做一个翻译器，那么就必须知道这两门语言的有效字。我们已经知道机器语言中什么是有效的了，但是对于 JavaScript，这是需要进行标准化的。</p><p>JavaScript 的标准化工作是由 Ecma 国际组织负责的，相关规范被称为 ECMAScript 或者 ES。因此，当你看到一篇文章/视频提到“ES7 有什么新特性？”时，你就知道它代表的是 ECMAScript 标准中新增的 JS 特性。</p><h3 id="3-V8-引擎"><a href="#3-V8-引擎" class="headerlink" title="3.V8 引擎"></a>3.V8 引擎</h3><h4 id="3-1-部分历史"><a href="#3-1-部分历史" class="headerlink" title="3.1 部分历史"></a>3.1 部分历史</h4><p>谷歌针对浏览器开发了谷歌地图，而这对浏览器的处理能力提出了很高的要求。那时的 JavaScript 实现尚不足以快速地运行地图。谷歌想要吸引更多的用户使用这项服务，从而进行广告销售并牟利。基于这个原因，这项服务必须快速且稳定。因此谷歌自己用 C++ 开发了 V8 引擎并在 2008 年启用，它的速度很快，或者就像一些人说的，它的速度是最快的。</p><p><img src="https://raw.githubusercontent.com/Chorer/MyBlog-Pic/master/Myblogs/3.jpg" alt=""></p><h4 id="3-2-解析和构建树"><a href="#3-2-解析和构建树" class="headerlink" title="3.2 解析和构建树"></a>3.2 解析和构建树</h4><p>JavaScript 文件进入引擎后，解析器进行词法解析，它将代码分解成 token 以确定它们的含义。这些 token 组成了<strong>AST(抽象语法树)。</strong></p><p><img src="https://raw.githubusercontent.com/Chorer/MyBlog-Pic/master/Myblogs/4.jpg" alt=""></p><p>编译器在语义分析中验证语言元素和关键词的正确用法，而 ASTs 在这个过程中扮演着重要的角色。之后，ASTs 被用于生成实际的字节码或者机器码。</p><p><img src="https://raw.githubusercontent.com/Chorer/MyBlog-Pic/master/Myblogs/5.jpg" alt=""></p><h4 id="3-3-引擎的核心"><a href="#3-3-引擎的核心" class="headerlink" title="3.3 引擎的核心"></a>3.3 引擎的核心</h4><p><img src="https://raw.githubusercontent.com/Chorer/MyBlog-Pic/master/Myblogs/6.jpg" alt=""></p><ul><li>我们之前谈到，JavaScript 是由 <strong>Ignition</strong> 这个解释器解释的，同时由 <strong>TurboFan</strong> 这个 JIT 优化编译器进行编译。</li><li>首先，前面步骤生成的 ASTs 传递给解释器，该解释器迅速生成未经过优化的机器码，并且其执行是无延迟的。</li><li><strong>Profiler</strong> 在代码运行时进行观察，找出可以进行优化的地方。例如，一个‘for’循环跑了 100 次，但是每次迭代产生的结果都是一样的。</li><li>使用这个分析器后，任何未优化的代码都将传递给编译器以进行优化，同时生成机器码，它最终会替换掉之前由解释器生成的未优化代码中的对应部分。</li><li>随着分析器和编译器不断地更改字节码，JavaScript 的执行性能逐渐提高。</li></ul><h4 id="3-4-更多历史"><a href="#3-4-更多历史" class="headerlink" title="3.4 更多历史"></a>3.4 更多历史</h4><p>在V8 的 5.9 版本推出之前，它使用两个优化编译器和一个基线编译器。</p><ul><li>基线编译器 full-codegen 迅速生成未优化的机器码。</li><li>两个优化编译器 Crankshaft 和 TurboFan 用于优化代码。</li></ul><p>JavaScript 增加了新的特性后，架构的复杂度上升，维护相同的管道对 V8 团队来说变得更加困难了。如果你想阅读更多相关的旧方法以及转向新管道的原因，可以访问<a href="https://v8.dev/blog" target="_blank" rel="noopener">他们的网站</a>。</p><h4 id="3-5-放眼未来"><a href="#3-5-放眼未来" class="headerlink" title="3.5 放眼未来"></a>3.5 放眼未来</h4><p>随着更多进一步提升性能的研究的进行，V8 引擎的工作机制在未来还可能发生变化。此外，随着 <a href="https://webassembly.org" target="_blank" rel="noopener">Webassembly</a> 逐渐成形，可能会向管道添加额外步骤。</p><h3 id="4-结论"><a href="#4-结论" class="headerlink" title="4.结论"></a>4.结论</h3><p>ECMAScript 引擎的实现有很多，其中以谷歌的 V8 最为出名。希望这篇文章的简述不仅可以帮助你理解 JavaScript 的工作原理，还能从大体上了解一门编程语言的工作原理。如果你想了解 V8 团队的未来计划或者引擎的细节，这里有一篇很不错的<a href="https://v8.dev/blog" target="_blank" rel="noopener">博客</a>。</p><p>本文的第二部分将会在不久后发布，其中将谈到内存堆，栈，事件循环以及更多与 JavaScript 代码执行相关的概念。敬请关注！</p><p>如果你不清楚 Node.js 在其中的作用，我这里碰巧写了一篇不错的文章：<br><a href="https://medium.freecodecamp.org/what-exactly-is-node-js-ae36e97449f5" target="_blank" rel="noopener">What exactly is Node.js?</a></p></div><div class="post-nav"><div class="post-nav-prev"><a href="/2019/05/17/F-CSS 基础系列：从浮动和margin塌陷谈BFC/" rel="prev" title="CSS 基础系列：从清除浮动和margin塌陷问题谈BFC"><i class="fa fa-angle-double-left"></i>&nbspCSS 基础系列：从清除浮动和margin塌陷问题谈BFC</a></div><div class="post-nav-next"><a href="/2019/05/03/Trs-翻译术语表/" rel="next" title="翻译术语表">翻译术语表&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top"><i class="fa fa-th-large"></i>Catalog</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-编程语言是如何工作的？"><span class="toc-text">1.编程语言是如何工作的？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1编译器和解释器"><span class="toc-text">1.1编译器和解释器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-从-JavaScript-到机器码"><span class="toc-text">2.从 JavaScript 到机器码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-ECMAScript"><span class="toc-text">2.1 ECMAScript</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-V8-引擎"><span class="toc-text">3.V8 引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-部分历史"><span class="toc-text">3.1 部分历史</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-解析和构建树"><span class="toc-text">3.2 解析和构建树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-引擎的核心"><span class="toc-text">3.3 引擎的核心</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-更多历史"><span class="toc-text">3.4 更多历史</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-放眼未来"><span class="toc-text">3.5 放眼未来</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-结论"><span class="toc-text">4.结论</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/search.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"left","width":150,"height":300,"vOffset":-120,"hOffset":-5},"mobile":{"show":false},"react":{"opacityDefault":1000,"opacityOnHover":1000},"log":false});</script></body></html><!-- rebuild by neat -->