<!-- build time:Fri Oct 11 2019 21:27:44 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scaleable=0" name="viewport"><title>Chor&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/third party/jquery.fancybox.css"><link rel="stylesheet" href="/css/third party/pace-theme-flash.css"><link rel="icon" href="/images/me.gif"><link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"><link rel="stylesheet" href="/css/prism-atom-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><header class="header"><div class="header_top"><span class="theme"><i class="fa fa-bars"></i> <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></span><nav class="navbar"><ul class="menu"><li class="menu-item"><i class="fa fa-home"></i> <a href="/" class="menu-item-link">HOME</a></li><li class="menu-item"><i class="fa fa-folder-open"></i> <a href="/categories" class="menu-item-link">CATEGORIES</a></li><li class="menu-item"><i class="fa fa-archive"></i> <a href="/archives" class="menu-item-link">ARCHIVES</a></li><li class="menu-item"><i class="fa fa-tags"></i> <a href="/tags" class="menu-item-link">TAGS</a></li><li class="menu-item"><i class="fa fa-user"></i> <a href="/about" class="menu-item-link">ABOUT</a></li></ul></nav></div><i id="homelink" data-link="https://chorer.github.io/"></i><div class="header_bottom"><div class="blog-title"><a href="/" class="logo">Chor&#39;s Blog</a><div class="descrs"><div class="descr">个人博客</div><div class="descr">" Do what you love,Love what you do "</div></div></div></div></header><main class="main"><section class="posts"><article class="post_full"><h1 class="post-title"><div class="post-title-link">「译」使用 Vue.js 的作用域插槽抽象功能</div></h1><div class="post-info"><div class="post-date"><i class="fa fa-calendar"></i>&nbsp2019-10-10&nbsp&nbsp&nbsp</div><span class="post-words"><i class="fa fa-pencil-square-o"></i>&nbsp2.5k&nbspwords&nbsp&nbsp </span><span class="post-time"><i class="fa fa-clock-o"></i>&nbsp11 mins&nbsp&nbsp&nbsp</span><div class="post-tags"></div></div><div class="post-content"><blockquote><ul><li>原文地址：<a href="https://css-tricks.com/using-scoped-slots-in-vue-js-to-abstract-functionality/" target="_blank" rel="noopener">Using Scoped Slots in Vue.js to Abstract Functionality</a></li><li>原文作者：Mateusz Rybczonek</li><li>译者：Chor<a id="more"></a></li></ul></blockquote><p>先简单介绍下 Vue.js 中<a href="https://vuejs.org/v2/guide/components-slots.html" target="_blank" rel="noopener">插槽</a> 的概念。当你想要<strong>向组件中的特定位置注入内容</strong>时，就得用插槽了，而这些<strong>特定的</strong>可以自定义的地方就叫做插槽。</p><p>例如，你想要创建一个包装组件，它有特定的样式，但你可以向它传递任何待渲染的内容（可以是一个字符串，一个计算属性，或者甚至是另一个组件）。</p><p>有三种类型的插槽：</p><ul><li><strong><a href="https://vuejs.org/v2/guide/components-slots.html#Slot-Content" target="_blank" rel="noopener">默认 / 匿名插槽</a>:</strong> 组件中只有单个插槽时使用。在模板中希望注入内容的地方添加 <code>&lt;slot&gt;</code> ，这样一来就算是创建一个插槽了。 <code>&lt;slot&gt;</code> 标签最终会被任何传递给组件模板的内容替换掉。</li><li><strong><a href="https://vuejs.org/v2/guide/components-slots.html#Named-Slots" target="_blank" rel="noopener">具名插槽</a>:</strong> 当你的组件有多个插槽，并且想要往不同的地方（插槽）注入不同的内容时，使用具名插槽。只需要给 <code>&lt;slot&gt;</code> 添加一个 <code>name</code> 属性即可（例如，<code>&lt;slot name=&quot;header&quot;&gt;&lt;/slot&gt;</code>）。渲染组件的时候，我们通过添加 <code>slot</code> 属性并赋值为插槽名，从而为每个具名插槽提供对应的内容。</li></ul><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base-layout</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>My awsome header<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>My awsome footer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>base-layout</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这之后，组件中的 <code>&lt;slot&gt;</code> 标签将被传入组件的内容替换掉。</p><ul><li><strong><a href="https://vuejs.org/v2/guide/components-slots.html#Scoped-Slots" target="_blank" rel="noopener">作用域插槽</a>:</strong> 如果想让插槽中的模板访问到子组件的数据（数据用于渲染插槽内容），可以使用作用域插槽。其主要应用就是创建使用子组件数据的自定义模板。</li></ul><p><img src="" alt="scoped slots diagram"></p><h3 id="实际应用：创建一个谷歌地图加载器组件"><a href="#实际应用：创建一个谷歌地图加载器组件" class="headerlink" title="实际应用：创建一个谷歌地图加载器组件"></a>实际应用：创建一个谷歌地图加载器组件</h3><p>想象一下，有这样的一个组件，它配置了一个可在其它组件中使用的外部 api，但是本身没有与任何特定的模板紧密耦合。这样的组件可以在多个地方重用，渲染不同的模板，但使用的是具有特定 api 的同一基本对象。</p><p>我创建了一个有如下特点的组件 (<code>GoogleMapLoader.vue</code>)：</p><ol><li>初始化 <a href="https://developers.google.com/maps/documentation/javascript/reference/" target="_blank" rel="noopener">谷歌地图 API</a></li><li>创建 <code>google</code> 和 <code>map</code> 对象</li><li>将上述对象暴露给父组件，也就是使用 <code>GoogleMapLoader</code> 的地方</li></ol><p>下面是具体实现。我将会逐步分析代码，然后我们来看看后面会发生什么事。</p><p>首先创建 <code>GoogleMapLoader.vue</code> 模板：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google-map<span class="token punctuation">"</span></span> <span class="token attr-name">data-google-map</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Boolean(this.google) &amp;&amp; Boolean(this.map)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:google</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google<span class="token punctuation">"</span></span> <span class="token attr-name">:map</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在，我们的脚本需要传递一些属性给组件，以方便我们设置<a href="https://developers.google.com/maps/documentation/javascript/reference/" target="_blank" rel="noopener">谷歌地图 API</a> 和 <a href="https://developers.google.com/maps/documentation/javascript/reference/map#Map" target="_blank" rel="noopener">Map</a> 对象：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">import</span> GoogleMapsApiLoader <span class="token keyword">from</span> <span class="token string">"google-maps-api-loader"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    mapConfig<span class="token punctuation">:</span> Object<span class="token punctuation">,</span>
    apiKey<span class="token punctuation">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      google<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      map<span class="token punctuation">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> googleMapApi <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">GoogleMapsApiLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      apiKey<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>apiKey
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>google <span class="token operator">=</span> googleMapApi<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> mapContainer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"[data-google-map]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span>mapContainer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这只是部分代码，完整代码请看<a href="https://codesandbox.io/s/1o45zvxk0q" target="_blank" rel="noopener">这里</a>。</p><p>基本代码写好了，现在我们来一步步分析这段代码的功能。</p><h4 id="1-创建一个初始化地图的组件"><a href="#1-创建一个初始化地图的组件" class="headerlink" title="1.创建一个初始化地图的组件"></a>1.创建一个初始化地图的组件</h4><p>在模板中，我们为地图创建了一个容器，用来挂载从谷歌地图 api 中导出的 <a href="https://developers.google.com/maps/documentation/javascript/reference/map#Map" target="_blank" rel="noopener">Map</a> 对象。</p><pre class="line-numbers language-html"><code class="language-html">// GoogleMapLoader.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google-map<span class="token punctuation">"</span></span> <span class="token attr-name">data-google-map</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来，我们的脚本需要接受来自父组件的属性，用以设置谷歌地图。这些属性包括：</p><ul><li><a href="https://developers.google.com/maps/documentation/javascript/style-reference" target="_blank" rel="noopener"><code>mapConfig</code></a>: 谷歌地图配置对象</li><li><a href="https://developers.google.com/maps/documentation/javascript/get-api-key" target="_blank" rel="noopener"><code>apiKey</code></a>: 谷歌地图所需的个人 api key<br><code>`</code>js<br>// GoogleMapLoader.vue<br>import GoogleMapsApiLoader from “google-maps-api-loader”;</li></ul><p>export default {<br>props: {<br>mapConfig: Object,<br>apiKey: String<br>},</p><pre><code>
接着，把 `google` 和 `map` 的初始值设置为 `null`：

```js
data() {
  return {
    google: null,
    map: null
  };
},
</code></pre><p>在 mounted 钩子函数中，我们创建了 <code>googleMapApi</code> 的实例和来自于这个实例的 <code>map</code> 对象。同时还要把 <code>google</code> 和 <code>map</code> 的值设为已创建好的实例。</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">async</span> <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> googleMapApi <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">GoogleMapsApiLoader</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    apiKey<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>apiKey
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>google <span class="token operator">=</span> googleMapApi<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">initializeMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> mapContainer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"[data-google-map]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">this<span class="token punctuation">.</span>google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span>mapContainer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>迄今为止，一切顺利。在上面的工作完成之后，我们还可以继续往 map 中添加其它对象（Markers，Polylines 等），并把它当作一个普通的地图组件使用。</p><p>但是，我们只想将 <code>GoogleMapLoader</code> 组件当作一个提供地图的加载器使用，不想在上面渲染任何东西。</p><p>为此，我们需要让使用 <code>GoogleMapLoader</code> 的父组件能够访问这个组件中设置的 <code>this.google</code> 和 <code>this.map</code>。这里， <a href="https://vuejs.org/v2/guide/components-slots.html#Scoped-Slots" target="_blank" rel="noopener">作用域插槽</a> 就大放异彩了。作用域插槽允许我们将子组件中设置的属性暴露给父组件。我们还是像之前一样边分析边给出代码。</p><h4 id="2-创建使用最初组件的一个组件"><a href="#2-创建使用最初组件的一个组件" class="headerlink" title="2.创建使用最初组件的一个组件"></a>2.创建使用最初组件的一个组件</h4><p>在新组件的模板中，我们渲染原先的 <code>GoogleMapLoader</code> 组件并传递必需的属性来初始化地图。</p><pre class="line-numbers language-html"><code class="language-html">// TravelMap.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GoogleMapLoader</span>
    <span class="token attr-name">:mapConfig</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mapConfig<span class="token punctuation">"</span></span>
    <span class="token attr-name">apiKey</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>yourApiKey<span class="token punctuation">"</span></span>
  <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>脚本标签大概如下：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token keyword">import</span> GoogleMapLoader <span class="token keyword">from</span> <span class="token string">"./GoogleMapLoader"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> mapSettings <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@/constants/mapSettings"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    GoogleMapLoader<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">mapConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>mapSettings<span class="token punctuation">,</span>
        center<span class="token punctuation">:</span> <span class="token punctuation">{</span> lat<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> lng<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里还没有使用作用域插槽，所以我们给它加一个。</p><h4 id="3-通过添加作用域插槽，暴露-google-和-map-属性给父组件"><a href="#3-通过添加作用域插槽，暴露-google-和-map-属性给父组件" class="headerlink" title="3.通过添加作用域插槽，暴露 google 和 map 属性给父组件"></a>3.通过添加作用域插槽，暴露 google 和 map 属性给父组件</h4><p>最关键的一步来了，我们加上作用域插槽，之后就可以在父组件中访问子组件数据了。具体做法是，在子组件中添加 <code>&lt;slot&gt;</code> 标签，并传递（使用 <code>v-bind</code> 或者 <code>:propName</code>）想要暴露的属性。这和父组件通过 <code>props</code> 向子组件传递数据没有区别，只不过我们是在 <code>&lt;slot&gt;</code> 标签中完成这个操作的，这相当于将之前的数据流反向了。</p><pre class="line-numbers language-html"><code class="language-html">// GoogleMapLoader.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google-map<span class="token punctuation">"</span></span> <span class="token attr-name">data-google-map</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Boolean(this.google) &amp;&amp; Boolean(this.map)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span>
        <span class="token attr-name">:google</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>google<span class="token punctuation">"</span></span>
        <span class="token attr-name">:map</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span>
      <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>子组件中有了插槽之后，我们就需要在父组件中接受并使用暴露出来的属性。</p><h4 id="4-在父组件中使用-slot-scope-属性接受暴露的属性"><a href="#4-在父组件中使用-slot-scope-属性接受暴露的属性" class="headerlink" title="4.在父组件中使用 slot-scope 属性接受暴露的属性"></a>4.在父组件中使用 <code>slot-scope</code> 属性接受暴露的属性</h4><p>为了在父组件中接受属性，我们声明了一个模板元素并使用了 <code>slot-scope</code> 属性。这个属性可以让我们访问携带所有暴露属性（来自子组件）的对象。我们可以直接拿到整个对象，或者是<a href="https://vuejs.org/v2/guide/components-slots.html#Destructuring-slot-scope" target="_blank" rel="noopener">解构这个对象</a>来拿到个别数据。</p><p>这里我们选择后者。</p><pre class="line-numbers language-html"><code class="language-html">// TravelMap.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GoogleMapLoader</span>
    <span class="token attr-name">:mapConfig</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mapConfig<span class="token punctuation">"</span></span>
    <span class="token attr-name">apiKey</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>yourApiKey<span class="token punctuation">"</span></span>
  <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">slot-scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{ google, map }<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      {{ map }}
      {{ google }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GoogleMapLoader</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>尽管 <code>google</code> 和 <code>map</code> 属性并不存在于 <code>TravelMap</code> 的作用域中，组件依然能够访问并在模板中使用它们。</p><p>嗯，好吧。但我为什么要这样做呢？意义何在？</p><p>问得好！作用域插槽允许我们传递一个模板而不是已经渲染好的元素给插槽。之所以叫<strong>作用域</strong>插槽，是因为它可以抛开”模板在父组件作用域中渲染“这一点，确切地访问到子组件数据。这使得我们可以自由地往模板中填充来自父组件的自定义内容。</p><h4 id="5-Create-factory-components-for-Markers-and-Polylines"><a href="#5-Create-factory-components-for-Markers-and-Polylines" class="headerlink" title="5. Create factory components for Markers and Polylines"></a>5. Create factory components for Markers and Polylines</h4><p>Now, when we have our map ready, we will create two factory components that will be used to add elements to the <code>TravelMap</code>.</p><pre><code>// GoogleMapMarker.vue
import { POINT_MARKER_ICON_CONFIG } from &quot;@/constants/mapSettings&quot;;

export default {
  props: {
    google: {
      type: Object,
      required: true
    },
    map: {
      type: Object,
      required: true
    },
    marker: {
      type: Object,
      required: true
    }
  },
  mounted() {
    new this.google.maps.Marker({
      position: this.marker.position,
      marker: this.marker,
      map: this.map,
      icon: POINT_MARKER_ICON_CONFIG
    });
  },
};

// GoogleMapLine.vue
import { LINE_PATH_CONFIG } from &quot;@/constants/mapSettings&quot;;

export default {
  props: {
    google: {
      type: Object,
      required: true
    },
    map: {
      type: Object,
      required: true
    },
    path: {
      type: Array,
      required: true
    }
  },
  mounted() {
    new this.google.maps.Polyline({
      path: this.path,
      map: this.map,
      ...LINE_PATH_CONFIG
    });
  },
};
</code></pre><p>Both of these receive <code>google</code> that we use to extract the required object (Marker or Polyline) as well as <code>map</code> which gives as a reference to the map on which we want to place our element.</p><p>Each component also expects an extra prop to create a corresponding element. In this case, we have <code>marker</code> and <code>path</code>, respectively.</p><p>On the mounted hook, we create an element (Marker/Polyline) and attach it to our map by passing the <code>map</code> property to the object constructor.</p><p>There’s still one more step to go…</p><h4 id="6-Add-elements-to-the-map"><a href="#6-Add-elements-to-the-map" class="headerlink" title="6. Add elements to the map"></a>6. Add elements to the map</h4><p>Let’s use our factory components to add elements to our map. We must render the factory component and pass the <code>google</code> and <code>map</code> objects so data flows to the right places.</p><p>We also need to provide the data that’s required by the element itself. In our case, that’s the <code>marker</code> object with the position of the marker and the <code>path</code> object with Polyline coordinates.</p><p>Here we go, integrating the data points directly into the template:</p><pre><code>// TravelMap.vue
&lt;template&gt;
  &lt;GoogleMapLoader
    :mapConfig=&quot;mapConfig&quot;
    apiKey=&quot;yourApiKey&quot;
  &gt;
    &lt;template slot-scope=&quot;{ google, map }&quot;&gt;
      &lt;GoogleMapMarker
        v-for=&quot;marker in markers&quot;
        :key=&quot;marker.id&quot;
        :marker=&quot;marker&quot;
        :google=&quot;google&quot;
        :map=&quot;map&quot;
      /&gt;
      &lt;GoogleMapLine
        v-for=&quot;line in lines&quot;
        :key=&quot;line.id&quot;
        :path.sync=&quot;line.path&quot;
        :google=&quot;google&quot;
        :map=&quot;map&quot;
      /&gt;
    &lt;/template&gt;
  &lt;/GoogleMapLoader&gt;
&lt;/template&gt;
</code></pre><p>We need to import the required factory components in our script and set the data that will be passed to the markers and lines:</p><pre><code>import { mapSettings } from &quot;@/constants/mapSettings&quot;;

export default {
  components: {
    GoogleMapLoader,
    GoogleMapMarker,
    GoogleMapLine
  },
  data() {
    return {
      markers: [
        { id: &quot;a&quot;, position: { lat: 3, lng: 101 } },
        { id: &quot;b&quot;, position: { lat: 5, lng: 99 } },
        { id: &quot;c&quot;, position: { lat: 6, lng: 97 } }
      ],
      lines: [
        { id: &quot;1&quot;, path: [{ lat: 3, lng: 101 }, { lat: 5, lng: 99 }] },
        { id: &quot;2&quot;, path: [{ lat: 5, lng: 99 }, { lat: 6, lng: 97 }] }
      ]
    };
  },
  computed: {
    mapConfig() {
      return {
        ...mapSettings,
        center: this.mapCenter
      };
    },
    mapCenter() {
      return this.markers[1].position;
    }
  }
};
</code></pre><h3 id="And-we’re-done"><a href="#And-we’re-done" class="headerlink" title="#And we’re done!"></a><a href="#article-header-id-1">#</a>And we’re done!</h3><p>With all those bits and pieces completed, we can now re-use the <code>GoogleMapLoader</code> component as a base for all our maps by passing different templates to each one of them. Imagine that you need to create another map with different Markers or just Markers without Polylines. By using a pattern of scoped slots, it becomes very easy since all we need to pass now is different content to the <code>GoogleMapLoader</code> component.</p><p>This pattern is not strictly connected to Google Maps; it can be used with any library to set the base component and expose the library’s API that might then be used in the component that summoned the base component.</p><p>It might be tempting to create a more complex or robust solution, but this gets us the abstraction we need and it becomes an independent piece of our codebase. If we get to that point, then it might be worth considering extraction to an add-on.</p></div><div class="post-nav"><div class="post-nav-prev"></div><div class="post-nav-next"><a href="/2019/10/10/Trs-一个案例搞懂 Vue.js 的作用域插槽/" rel="next" title="「译」一个案例搞懂 Vue.js 的作用域插槽">「译」一个案例搞懂 Vue.js 的作用域插槽&nbsp<i class="fa fa-angle-double-right"></i></a></div><div class="clear"></div></div></article><div class="post-toc"><div class="toc-top"><i class="fa fa-th-large"></i>Catalog</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#实际应用：创建一个谷歌地图加载器组件"><span class="toc-text">实际应用：创建一个谷歌地图加载器组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建一个初始化地图的组件"><span class="toc-text">1.创建一个初始化地图的组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-创建使用最初组件的一个组件"><span class="toc-text">2.创建使用最初组件的一个组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-通过添加作用域插槽，暴露-google-和-map-属性给父组件"><span class="toc-text">3.通过添加作用域插槽，暴露 google 和 map 属性给父组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-在父组件中使用-slot-scope-属性接受暴露的属性"><span class="toc-text">4.在父组件中使用 slot-scope 属性接受暴露的属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Create-factory-components-for-Markers-and-Polylines"><span class="toc-text">5. Create factory components for Markers and Polylines</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-Add-elements-to-the-map"><span class="toc-text">6. Add elements to the map</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#And-we’re-done"><span class="toc-text">#And we’re done!</span></a></li></ol></div><div id="vcomments"></div><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({el:"#vcomments",appId:"c9Ume1Givsusy6VyqV87iT2z-gzGzoHsz",appKey:"5F7jhJfENet59xDteaKqobSK",notify:!1,verify:!1,placeholder:"Just talk here......",avatar:"mm",pageSize:10,visitor:!0})</script></section></main><footer class="footer"><div class="footer-info"><p>Copyright © 2018 - 2019 My Blog</p><p class="a">Powered by <a href="https://hexo.io/zh-cn/">Hexo</a> | Theme - <a href="https://github.com/Chorer/hexo-theme-PureBlue">PureBlue</a></p></div></footer><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="/js/navbar.js"></script><script src="/js/pace.min.js"></script><script src="/js/code.js"></script><script src="/js/load.js"></script><script src="/js/jquery.fancybox.js"></script><script src="/js/jquery.fancyboxStart.js"></script><script src="/js/search.js"></script><script src="/js/toc.js"></script><script src="/js/jquery.toTop.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script><script src="/js/IndexToTop.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cd8f8959eacf92e"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/tororo.model.json"},display:{position:"left",width:150,height:300,vOffset:-120,hOffset:-5},mobile:{show:!1},react:{opacityDefault:1e3,opacityOnHover:1e3},log:!1})</script></body></html><!-- rebuild by neat -->